|image1|

ITA_利用手順マニュアル

ホストグループ機能

*－*\ 第1.9版\ *－*

Copyright © NEC Corporation 2019. All rights reserved.

免責事項

本書の内容はすべて日本電気株式会社が所有する著作権に保護されています。

本書の内容の一部または全部を無断で転載および複写することは禁止されています。

本書の内容は将来予告なしに変更することがあります。

日本電気株式会社は、本書の技術的もしくは編集上の間違い、欠落について、一切責任を負いません。

日本電気株式会社は、本書の内容に関し、その正確性、有用性、確実性その他いかなる保証もいたしません。

商標

-  LinuxはLinus
      Torvalds氏の米国およびその他の国における登録商標または商標です。

-  Red Hatは、Red Hat,
      Inc.の米国およびその他の国における登録商標または商標です。

-  Apache、Apache Tomcat、Tomcatは、Apache Software
      Foundationの登録商標または商標です。

-  Ansibleは、Red Hat, Inc.の登録商標または商標です。

その他、本書に記載のシステム名、会社名、製品名は、各社の登録商標もしくは商標です。

なお、® マーク、TMマークは本書に明記しておりません。

※本書では「Exastro IT Automation」を「ITA」として記載します。

目次
====

`目次 2 <#目次>`__

`はじめに 3 <#はじめに>`__

`1 ホストグループの概要と利点 4 <#ホストグループの概要と利点>`__

`1.1 ホストグループの概要 4 <#ホストグループの概要>`__

`1.2 ホストグループの利点 5 <#ホストグループの利点>`__

`1.2.1 ホストグループ間のパラメータの継承
5 <#ホストグループ間のパラメータの継承>`__

`2 ホストグループ機能の主要機能 8 <#ホストグループ機能の主要機能>`__

`3 ホストグループ機能のメニューグループ
9 <#ホストグループ機能のメニューグループ>`__

`3.1 メニューグループ「ホストグループ管理コンソール」について
9 <#メニューグループホストグループ管理コンソールについて>`__

`4 ホスト単位に情報を設定 10 <#ホスト単位に情報を設定>`__

`4.1 パラメータシート作成 13 <#パラメータシート作成>`__

`4.2 ホストグループの登録 13 <#ホストグループの登録>`__

`4.3 ホストグループ親子関係の定義 14 <#ホストグループ親子関係の定義>`__

`4.4 ホストグループとオペレーションと作業対象ホストの紐付け
15 <#ホストグループとオペレーションと作業対象ホストの紐付け>`__

`4.5 パラメータシートメニューへの登録
19 <#パラメータシートメニューへの登録>`__

`4.6 ホスト化 20 <#ホスト化>`__

`4.7 オペレーションと作業対象ホストごとの項目の設定値を紐付け
22 <#オペレーションと作業対象ホストごとの項目の設定値を紐付け>`__

`4.8 オペレーションに紐付く作業対象ホストの反映
22 <#オペレーションに紐付く作業対象ホストの反映>`__

`4.9 代入値の反映 22 <#代入値の反映>`__

`5 運用操作 23 <#運用操作>`__

`5.1 メンテナンス 23 <#メンテナンス>`__

`5.2 ログレベルの変更 24 <#ログレベルの変更>`__

はじめに
========

本書では、ITAホストグループ機能
（以降、ホストグループと略）システムの機能および操作方法について説明します。

ホストグループの概要と利点
==========================

ホストグループの概要
--------------------

   ホストグループとは、ホスト群を論理的な単位（機能・役割）でまとめたグループのことを指します。

   ホストグループの概念図は下のようになります。

   上図は、以下の要素で構成されています。

   ■ホストグループ

   図中の単線枠の四角形で記載。all、dc1、dc3、zabbix1、zabbix3が該当。

   ■作業対象ホスト

   物理機器を示すホスト。

   図中の丸角の四角形で記載。hostname11、hostname12、hostname31、hostname32が該当。

   上位のホストグループを親ホストグループ、下位のホストグループを子ホストグループと呼び、それらは親子関係にあります。更に下位となる末端のホストグループは作業対象ホストと紐付きます。上図の例では、dc1から見た子ホストグループはzabbix1となり、zabbix1から見た親ホストグループはdc1となります。

   階層の数え方はホストグループ1つで1階層、1組の親子で2階層となり、頂点となるホストグループから末端のホストグループまでは最大15階層まで定義できます。

   上図の例では、allからzabbix1まで辿ると3階層となります。

ホストグループの利点
--------------------

ホストグループ間のパラメータの継承
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

   親ホストグループに設定したパラメータは子ホストグループに継承されます。

   下図の例では、dc1に設定したパラメータ（例えばユーザのパスワードなど）がzabbix1にも同じパラメータの設定が継承されます。

   ただし、具体値がない場合は継承されません。

   このように設定箇所を局所化することで、設定の付与/変更作業の簡略化ができます。

   子ホストグループを追加した場合にもパラメータの設定は自動で継承されます。

   下図の例では、zabbixサーバを1台追加した際に、zabbix12をzabbix1に紐付けています。

   これにより、zabbix12には、zabbix11と同じように、zabbix1の設定が継承されます。

　　　　　　

　　　　　

   子ホストグループは複数の親ホストグループに紐付けることができ、親ホストグループが複数ある場合のパラメータの継承について説明します。

   下図の例では、zabbix11、zabbix12はzabbix1とvirtualserverに属しています。

   ホストグループ間でパラメータが重複していた場合は最も下位のホストグループから適用されます。

   上図の例では、dcxとzabbix1に同じパラメータを設定していた場合に、zabbix11、zabbix12に継承されるのはdcxからではなく、下位のzabbix1のパラメータとなります。

　　　　　

　　　　　

   同じ階層でパラメータが重複していた場合は優先順位が高い親ホストグループから継承されます。

   上図の例ではvirtualserverとzabbix1に同じパラメータを設定していた場合にvirtualserverの優先順位が1で、zabbix1の優先順位が2であれば、zabbix1の優先順位が大きいため、子ホストグループに継承されるのはzabbix1のパラメータとなります。

   優先順位の設定方法は「 *4.2ホストグループの登録*\ 」で説明します。

ホストグループ機能の主要機能
============================

   ホストグループ機能の主要機能は次のカテゴリーに分類されます。

#. Web

..

   Webコンテンツ。ブラウザで提供されるホストグループ機能を使用できる画面。

2. BackYard

..

   Webコンテンツとは独立してサーバ上で動作する常駐プロセス。

ホストグループ機能のメニューグループ
====================================

   ホストグループ機能のメニューグループと、それに所属するメニューは以下となります。

+------------------+------------------+----------+------------------+
| **メニュー**     | **所             | **段落** | **説明**         |
|                  | 属するメニュー** |          |                  |
| **グループ**     |                  |          |                  |
+==================+==================+==========+==================+
| ホストグルー     | ホ               | 4.2      | ホス             |
| プ管理コンソール | ストグループ一覧 |          | トグループの登録 |
+------------------+------------------+----------+------------------+
|                  | ホスト           | 4.3      | ホストグルー     |
|                  | グループ親子紐付 |          | プ親子関係の定義 |
+------------------+------------------+----------+------------------+
|                  | ホスト紐付管理   | 4.4      | ホスト           |
|                  |                  |          | グループとオペレ |
|                  |                  |          | ーションと作業対 |
|                  |                  |          | 象ホストの紐付け |
+------------------+------------------+----------+------------------+

メニューグループ「ホストグループ管理コンソール」について
--------------------------------------------------------

   ホストグループ一覧、ホストグループ親子紐付、ホスト紐付管理は、ホストグループを登録し、どのオペレーションでどのホストを作業対象とするかを定義するために必要なメニューとなります。

   操作の詳細は「\ *4ホスト単位に情報を設定*\ 」で説明します。

ホスト単位に情報を設定
======================

   Webコンテンツを使用して、ホストグループを登録しホスト単位に情報を設定する作業のフローは以下表のようになります。

   作業の詳細は各段落で説明します。

+----------+----------+----------+----------+----------+----------+
| **段落** | **作     | **ユー   | **使     | **使     | **備考** |
|          | 業内容** | ザ操作** | 用する** | 用するメ |          |
|          |          |          |          | ニュー** |          |
|          |          |          | **メ     |          |          |
|          |          |          | ニューグ |          |          |
|          |          |          | ループ** |          |          |
+==========+==========+==========+==========+==========+==========+
| 4.1      | *パラメ  | あり     | パラ     | メニュー | ―        |
|          | ータシー |          | メータシ | 作成情報 |          |
|          | ト作成*  |          | ート作成 |          |          |
|          |          |          |          | メニ     |          |
|          |          |          |          | ュー項目 |          |
|          |          |          |          | 作成情報 |          |
|          |          |          |          |          |          |
|          |          |          |          | メニュー |          |
|          |          |          |          | 作成実行 |          |
|          |          |          |          |          |          |
|          |          |          |          | メニュー |          |
|          |          |          |          | 作成管理 |          |
+----------+----------+----------+----------+----------+----------+
| 4.2      | *ホスト  | あり     | ホ       | ホ       | ―        |
|          | グループ |          | ストグル | ストグル |          |
|          | の登録*  |          | ープ管理 | ープ一覧 |          |
+----------+----------+----------+----------+----------+----------+
| 4.3      | ホス     | あり     | ホ       | ホスト   | ―        |
|          | トグルー |          | ストグル | グループ |          |
|          | プ親子関 |          | ープ管理 | 親子紐付 |          |
|          | 係の定義 |          |          |          |          |
+----------+----------+----------+----------+----------+----------+
| 4.4      | *        | あり     | ホ       | ホスト   | ―        |
|          | ホストグ |          | ストグル | 紐付管理 |          |
|          | ループと |          | ープ管理 |          |          |
|          | オペレー |          |          |          |          |
|          | ションと |          |          |          |          |
|          | 作業対象 |          |          |          |          |
|          | ホストの |          |          |          |          |
|          | 紐付け*  |          |          |          |          |
+----------+----------+----------+----------+----------+----------+
| 4.5      | *パ      | あり     | ※2       | *「*     | ―        |
|          | ラメータ |          |          | *4.1パラ |          |
|          | シートメ |          |          | メータシ |          |
|          | ニューへ |          |          | ート作成 |          |
|          | の登録*  |          |          | *\ 」で  |          |
|          |          |          |          | 作成した |          |
|          |          |          |          | メニュー |          |
+----------+----------+----------+----------+----------+----------+
| 4.6      | *ホ      | なし     | ※2       | 「       | 手動での |
|          | スト化*  |          |          | *4.1パラ | 登録/更  |
|          |          | ※1       |          | メータシ | 新不可。 |
|          |          |          |          | ート作成 |          |
|          |          |          |          | *\ 」で  |          |
|          |          |          |          | 作成した |          |
|          |          |          |          | メニュー |          |
+----------+----------+----------+----------+----------+----------+
| 4.7      | *オ      | あり     | ※2       | 代       | 代入     |
|          | ペレーシ |          |          | 入値自動 | 値自動登 |
|          | ョンと作 |          |          | 登録設定 | 録設定に |
|          | 業対象ホ |          |          |          | ついては |
|          | ストごと |          |          |          | 「パラメ |
|          | の項目の |          |          |          | ータ管理 |
|          | 設定値を |          |          |          | メニュー |
|          | 紐付け*  |          |          |          | ガイド」 |
|          |          |          |          |          | を参照。 |
+----------+----------+----------+----------+----------+----------+
| 4.8      | *オペ    | なし     | 　※3     | 作業対   | 代入     |
|          | レーショ |          |          | 象ホスト | 値自動登 |
|          | ンに紐付 | ※1       |          |          | 録設定に |
|          | く作業対 |          |          |          | ついては |
|          | 象ホスト |          |          |          | 「パラメ |
|          | の反映*  |          |          |          | ータ管理 |
|          |          |          |          |          | メニュー |
|          |          |          |          |          | ガイド」 |
|          |          |          |          |          | を参照。 |
+----------+----------+----------+----------+----------+----------+
| 4.9      | *代入値  | なし     | ※3       | 代       | 代入     |
|          | の反映*  |          |          | 入値管理 | 値自動登 |
|          |          | ※1       |          |          | 録設定に |
|          |          |          |          |          | ついては |
|          |          |          |          |          | 「パラメ |
|          |          |          |          |          | ータ管理 |
|          |          |          |          |          | メニュー |
|          |          |          |          |          | ガイド」 |
|          |          |          |          |          | を参照。 |
+----------+----------+----------+----------+----------+----------+

..

   ※1

   内部の処理で実行するのでユーザ操作は不要。

   処理結果はメニュー画面で確認可能。

   ※2

   「4.1 パラメータシート作成」で作成先に指定したメニューグループ。

　　　

   ※3

   代入値自動登録設定が行えるメニューグループ。

   各作業により、レコードのイメージは以下表のようになります。

+----------+----------------------------+----------------------------+
| **段落** | **作業内容**               | **レコードのイメージ**     |
+==========+============================+============================+
| 4.2      | *ホストグループの登録*     | +--------------------+     |
|          |                            | | **ホストグループ** |     |
|          |                            | +====================+     |
|          |                            | | HG_1               |     |
|          |                            | +--------------------+     |
|          |                            | | HG_2               |     |
|          |                            | +--------------------+     |
|          |                            | | hg_1a              |     |
|          |                            | +--------------------+     |
|          |                            | | hg_1b              |     |
|          |                            | +--------------------+     |
|          |                            | | hg_2a              |     |
|          |                            | +--------------------+     |
|          |                            | | hg_2b              |     |
|          |                            | +--------------------+     |
|          |                            |                            |
|          |                            | 　                         |
+----------+----------------------------+----------------------------+
| 4.3      | *ホス                      | +----------+----------+    |
|          | トグループ親子関係の定義*  | | **親     | **子     |    |
|          |                            | | ホストグ | ホストグ |    |
|          |                            | | ループ** | ループ** |    |
|          |                            | +==========+==========+    |
|          |                            | | HG_1     | hg_1a    |    |
|          |                            | +----------+----------+    |
|          |                            | | HG_1     | hg_1b    |    |
|          |                            | +----------+----------+    |
|          |                            | | HG_2     | hg_2a    |    |
|          |                            | +----------+----------+    |
|          |                            | | HG_2     | hg_2b    |    |
|          |                            | +----------+----------+    |
|          |                            |                            |
|          |                            | 　                         |
+----------+----------------------------+----------------------------+
| 4.4      | *ホス                      | +-------+-------+-------+  |
|          | トグループとオペレーション | | *     | *     | *     |  |
|          | と作業対象ホストの紐付け*  | | *ホス | *オペ | *作業 |  |
|          |                            | | トグ  | レー  | 対象  |  |
|          |                            | | ルー  | ショ  | ホス  |  |
|          |                            | | プ**  | ン**  | ト**  |  |
|          |                            | +=======+=======+=======+  |
|          |                            | | hg_1a | 2017  | ho    |  |
|          |                            | |       | /10/3 | st_1a |  |
|          |                            | |       | 1_100 |       |  |
|          |                            | |       | 1_OP1 |       |  |
|          |                            | +-------+-------+-------+  |
|          |                            | | hg_1b | 2017  | ho    |  |
|          |                            | |       | /10/3 | st_1b |  |
|          |                            | |       | 1_100 |       |  |
|          |                            | |       | 1_OP1 |       |  |
|          |                            | +-------+-------+-------+  |
|          |                            | | hg_2a | 2017  | ho    |  |
|          |                            | |       | /10/3 | st_2a |  |
|          |                            | |       | 1_100 |       |  |
|          |                            | |       | 1_OP1 |       |  |
|          |                            | +-------+-------+-------+  |
|          |                            | | hg_2b | 2017  | ho    |  |
|          |                            | |       | /10/3 | st_2b |  |
|          |                            | |       | 1_100 |       |  |
|          |                            | |       | 1_OP1 |       |  |
|          |                            | +-------+-------+-------+  |
|          |                            |                            |
|          |                            | 　                         |
+----------+----------------------------+----------------------------+
| 4.5      | *パラメー                  | +------                    |
|          | タシートメニューへの登録*  | -+-------+-------+-------+ |
|          |                            | | *                        |
|          |                            |  | *     | **項  | **項  | |
|          |                            | | *作業                    |
|          |                            |  | *オペ | 目1** | 目2** | |
|          |                            | | 対象                     |
|          |                            |  | レー  |       |       | |
|          |                            | | ホス                     |
|          |                            |  | ショ  |       |       | |
|          |                            | | ト**                     |
|          |                            |  | ン**  |       |       | |
|          |                            | |                          |
|          |                            |  |       |       |       | |
|          |                            | | **　                     |
|          |                            |  |       |       |       | |
|          |                            | | or　                     |
|          |                            |  |       |       |       | |
|          |                            | | ホス                     |
|          |                            |  |       |       |       | |
|          |                            | | トグ                     |
|          |                            |  |       |       |       | |
|          |                            | | ルー                     |
|          |                            |  |       |       |       | |
|          |                            | | プ**                     |
|          |                            |  |       |       |       | |
|          |                            | +======                    |
|          |                            | =+=======+=======+=======+ |
|          |                            | | HG_1                     |
|          |                            |  | 2017  | 111   | AAA   | |
|          |                            | |                          |
|          |                            |  | /10/3 |       |       | |
|          |                            | |                          |
|          |                            |  | 1_100 |       |       | |
|          |                            | |                          |
|          |                            |  | 1_OP1 |       |       | |
|          |                            | +------                    |
|          |                            | -+-------+-------+-------+ |
|          |                            | | HG_2                     |
|          |                            |  | 2017  | ―     | BBB   | |
|          |                            | |                          |
|          |                            |  | /10/3 |       |       | |
|          |                            | |                          |
|          |                            |  | 1_100 |       |       | |
|          |                            | |                          |
|          |                            |  | 1_OP1 |       |       | |
|          |                            | +------                    |
|          |                            | -+-------+-------+-------+ |
|          |                            |                            |
|          |                            | 　                         |
+----------+----------------------------+----------------------------+
| 4.6      | *ホスト化*                 | +--------+--------+----    |
|          |                            | ----+--------+-----+-----+ |
|          |                            | | **作業 | **オペ | **項   |
|          |                            |    | **項   |     |     |  |
|          |                            | | 対象** | レーシ | 目1    |
|          |                            | **  | 目2**  |     |     | |
|          |                            | |        | ョン** |        |
|          |                            |     |        |     |     | |
|          |                            | | **ホ   |        |        |
|          |                            |     |        |     |     | |
|          |                            | | スト** |        |        |
|          |                            |     |        |     |     | |
|          |                            | +========+========+====    |
|          |                            | ====+========+=====+=====+ |
|          |                            | |        | **     | **I    |
|          |                            | D** | **     |     |     | |
|          |                            | |        | 実施予 |        |
|          |                            |     | オペレ |     |     | |
|          |                            | |        | 定日** |        |
|          |                            |     | ーショ |     |     | |
|          |                            | |        |        |        |
|          |                            |     | ン名** |     |     | |
|          |                            | +--------+--------+----    |
|          |                            | ----+--------+-----+-----+ |
|          |                            | | h      | 2017   | 100    |
|          |                            | 1   | OP1    | 111 | AAA | |
|          |                            | | ost_1a | /10/31 |        |
|          |                            |     |        |     |     | |
|          |                            | +--------+--------+----    |
|          |                            | ----+--------+-----+-----+ |
|          |                            | | h      | 2017   | 100    |
|          |                            | 1   | OP1    | 111 | AAA | |
|          |                            | | ost_1b | /10/31 |        |
|          |                            |     |        |     |     | |
|          |                            | +--------+--------+----    |
|          |                            | ----+--------+-----+-----+ |
|          |                            | | h      | 2017   | 100    |
|          |                            | 1   | OP1    | ―   | BBB | |
|          |                            | | ost_2a | /10/31 |        |
|          |                            |     |        |     |     | |
|          |                            | +--------+--------+----    |
|          |                            | ----+--------+-----+-----+ |
|          |                            | | h      | 2017   | 100    |
|          |                            | 1   | OP1    | ―   | BBB | |
|          |                            | | ost_2b | /10/31 |        |
|          |                            |     |        |     |     | |
|          |                            | +--------+--------+----    |
|          |                            | ----+--------+-----+-----+ |
|          |                            |                            |
|          |                            | 　                         |
+----------+----------------------------+----------------------------+
| 4.7      | *オペレ                    | +------                    |
|          | ーションと作業対象ホストご | -+-------+-------+-------+ |
|          | との項目の設定値を紐付け*  | | *                        |
|          |                            |  | **項  | **    | *     | |
|          |                            | | *メニ                    |
|          |                            |  | 目**  | Movem | *変数 | |
|          |                            | | ュー                     |
|          |                            |  |       | ent** | 名**  | |
|          |                            | | グル                     |
|          |                            |  |       |       |       | |
|          |                            | | ープ                     |
|          |                            |  |       |       |       | |
|          |                            | | 名：                     |
|          |                            |  |       |       |       | |
|          |                            | | メニ                     |
|          |                            |  |       |       |       | |
|          |                            | | ュー                     |
|          |                            |  |       |       |       | |
|          |                            | | 名**                     |
|          |                            |  |       |       |       | |
|          |                            | +======                    |
|          |                            | =+=======+=======+=======+ |
|          |                            | | パ                       |
|          |                            |  | 項目1 | Move  | VAR_  | |
|          |                            | | ラメ                     |
|          |                            |  |       | ment1 | 変数1 | |
|          |                            | | ータ                     |
|          |                            |  |       |       |       | |
|          |                            | | 管理                     |
|          |                            |  |       |       |       | |
|          |                            | | (ホス                    |
|          |                            |  |       |       |       | |
|          |                            | | ト化                     |
|          |                            |  |       |       |       | |
|          |                            | | )：作                    |
|          |                            |  |       |       |       | |
|          |                            | | 成し                     |
|          |                            |  |       |       |       | |
|          |                            | | たメ                     |
|          |                            |  |       |       |       | |
|          |                            | | ニュ                     |
|          |                            |  |       |       |       | |
|          |                            | | ー名                     |
|          |                            |  |       |       |       | |
|          |                            | +------                    |
|          |                            | -+-------+-------+-------+ |
|          |                            | | パ                       |
|          |                            |  | 項目2 | Move  | VAR_  | |
|          |                            | | ラメ                     |
|          |                            |  |       | ment2 | 変数2 | |
|          |                            | | ータ                     |
|          |                            |  |       |       |       | |
|          |                            | | 管理                     |
|          |                            |  |       |       |       | |
|          |                            | | (ホス                    |
|          |                            |  |       |       |       | |
|          |                            | | ト化                     |
|          |                            |  |       |       |       | |
|          |                            | | )：作                    |
|          |                            |  |       |       |       | |
|          |                            | | 成し                     |
|          |                            |  |       |       |       | |
|          |                            | | たメ                     |
|          |                            |  |       |       |       | |
|          |                            | | ニュ                     |
|          |                            |  |       |       |       | |
|          |                            | | ー名                     |
|          |                            |  |       |       |       | |
|          |                            | +------                    |
|          |                            | -+-------+-------+-------+ |
|          |                            |                            |
|          |                            | 　                         |
+----------+----------------------------+----------------------------+

+----------+----------------------------+----------------------------+
| **段落** | **作業内容**               | **レコードのイメージ**     |
+==========+============================+============================+
| 4.8      | *オペレーションに紐        | +-------+-------+-------+  |
|          | 付く作業対象ホストの反映*  | | *     | **    | *     |  |
|          |                            | | *オペ | Movem | *作業 |  |
|          |                            | | レー  | ent** | 対象  |  |
|          |                            | | ショ  |       | ホス  |  |
|          |                            | | ン**  |       | ト**  |  |
|          |                            | +=======+=======+=======+  |
|          |                            | | 100   | Move  | ho    |  |
|          |                            | | 1_OP1 | ment1 | st_1a |  |
|          |                            | +-------+-------+-------+  |
|          |                            | | 100   | Move  | ho    |  |
|          |                            | | 1_OP1 | ment1 | st_1b |  |
|          |                            | +-------+-------+-------+  |
|          |                            | | 100   | Move  | ho    |  |
|          |                            | | 1_OP1 | ment2 | st_1a |  |
|          |                            | +-------+-------+-------+  |
|          |                            | | 100   | Move  | ho    |  |
|          |                            | | 1_OP1 | ment2 | st_1b |  |
|          |                            | +-------+-------+-------+  |
|          |                            | | 100   | Move  | ho    |  |
|          |                            | | 1_OP1 | ment2 | st_2a |  |
|          |                            | +-------+-------+-------+  |
|          |                            | | 100   | Move  | ho    |  |
|          |                            | | 1_OP1 | ment2 | st_2b |  |
|          |                            | +-------+-------+-------+  |
|          |                            |                            |
|          |                            | 　                         |
+----------+----------------------------+----------------------------+
| 4.9      | *代入値の反映*             | +-------+------            |
|          |                            | -+-------+-------+-------+ |
|          |                            | | *     | **               |
|          |                            |  | *     | *     | *     | |
|          |                            | | *オペ | Movem            |
|          |                            |  | *作業 | *変数 | *具体 | |
|          |                            | | レー  | ent**            |
|          |                            |  | 対象  | 名**  | 値**  | |
|          |                            | | ショ  |                  |
|          |                            |  | ホス  |       |       | |
|          |                            | | ン**  |                  |
|          |                            |  | ト**  |       |       | |
|          |                            | +=======+======            |
|          |                            | =+=======+=======+=======+ |
|          |                            | | 100   | Move             |
|          |                            |  | ho    | VAR_  | 111   | |
|          |                            | | 1_OP1 | ment1            |
|          |                            |  | st_1a | 変数1 |       | |
|          |                            | +-------+------            |
|          |                            | -+-------+-------+-------+ |
|          |                            | | 100   | Move             |
|          |                            |  | ho    | VAR_  | 111   | |
|          |                            | | 1_OP1 | ment1            |
|          |                            |  | st_1b | 変数1 |       | |
|          |                            | +-------+------            |
|          |                            | -+-------+-------+-------+ |
|          |                            | | 100   | Move             |
|          |                            |  | ho    | VAR_  | AAA   | |
|          |                            | | 1_OP1 | ment2            |
|          |                            |  | st_1a | 変数2 |       | |
|          |                            | +-------+------            |
|          |                            | -+-------+-------+-------+ |
|          |                            | | 100   | Move             |
|          |                            |  | ho    | VAR_  | AAA   | |
|          |                            | | 1_OP1 | ment2            |
|          |                            |  | st_1b | 変数2 |       | |
|          |                            | +-------+------            |
|          |                            | -+-------+-------+-------+ |
|          |                            | | 100   | Move             |
|          |                            |  | ho    | VAR_  | BBB   | |
|          |                            | | 1_OP1 | ment2            |
|          |                            |  | st_2a | 変数2 |       | |
|          |                            | +-------+------            |
|          |                            | -+-------+-------+-------+ |
|          |                            | | 100   | Move             |
|          |                            |  | ho    | VAR_  | BBB   | |
|          |                            | | 1_OP1 | ment2            |
|          |                            |  | st_2b | 変数2 |       | |
|          |                            | +-------+------            |
|          |                            | -+-------+-------+-------+ |
|          |                            |                            |
|          |                            | 　                         |
+----------+----------------------------+----------------------------+

パラメータシート作成
--------------------

   パラメータシート作成機能を利用してパラメータシートメニューを作成します。

   パラメータシート作成機能の詳細については「利用手順マニュアル_パラメータシート作成機能」を参照してください。

ホストグループの登録
--------------------

   ホストグループ一覧メニューを使用してホストグループを登録します。

|image2|

================ ========================================
**カラム名**     **説明**
================ ========================================
ホストグループ名 ホストグループの名称を入力します。
優先順位         優先順位を入力します。
                 
                 入力範囲は\ **1**\ ～2,147,483,647です。
================ ========================================

ホストグループ親子関係の定義
----------------------------

   ホストグループ親子紐付メニューを使用してホストグループの親子関係を定義します。

   |image3|

+----------------+----------+----------------------------------------+
| **カラム名**   | **説明** |                                        |
+================+==========+========================================+
| ホストグループ | 親       | 親となるホストグループ名を選択します。 |
+----------------+----------+----------------------------------------+
|                | 子       | 親ホストグループに                     |
|                |          | 紐付く子ホストグループ名を選択します。 |
+----------------+----------+----------------------------------------+

..

   親子関係がループしているホストグループがあれば、表示フィルタの表示結果のループアラーム欄に「●」が表示されます。

   下記の例では、zabbix1（親）とzabbix11(子)の親子関係が既に定義されているにも関わらず、更にzabbix11（親）とzabbix1(子)という逆の親子関係を定義しており、親子関係がループとなっています。

   ループがある場合は後述する内部の処理「ホストグループ分解機能」が動作しないため、ループが発生しないように注意してください。

   |image4|　

ホストグループとオペレーションと作業対象ホストの紐付け
------------------------------------------------------

   ホスト紐付管理メニューを使用してホストグループとオペレーションに紐付く作業対象ホストを登録します。

   |image5|

================ ==============================
**カラム名**     **説明**
================ ==============================
ホストグループ名 ホストグループを選択します。
オペレーション   オペレーションを選択します。※1
ホスト名         作業対象ホストを選択します。
================ ==============================

..

   ホストグループとオペレーションと作業対象ホストを紐付けることで、下図のように、ホストグループ内で作業対象ホストの選択操作が可能となります。

　　　

※1

ホスト紐付管理メニューでは、オペレーションはNULL登録も可能です。NULL登録した場合は、すべてのオペレーションで紐付が有効になります。

　|image6|

|image7|

|image8|\ 上記の例ではオペレーションをNULL登録したホストグループzabbix1、zabbix2の紐付はすべてのオペレーションで有効になります。

一方、オペレーション登録したホストグループzabbix3は、登録したオペレーション「作業者①」でのみ有効となります。

オペレーション「作業者①」でのホストグループ紐付

オペレーション「作業者①」以外でのホストグループ紐付

パラメータシートメニューへの登録
--------------------------------

   「
   *4.1パラメータシート作成*\ 」で作成したホストグループ用のパラメータシートメニューで、作業対象ホストまたはホストグループがもつ項目に、オペレーションごとの具体値を登録します。登録後は参照/更新/廃止/復活が可能です。

   |image9|

+----------------------------------+----------------------------------+
| **カラム名**                     | **説明**                         |
+==================================+==================================+
| ホスト名/ホストグループ名        | 作業対象ホストま                 |
|                                  | たはホストグループを選択します。 |
|                                  |                                  |
|                                  | 接頭辞[H]が作業対象ホ            |
|                                  | スト、[HG]がホストグループです。 |
+----------------------------------+----------------------------------+
| オペレーション                   | オペレーションを選択します。     |
+----------------------------------+----------------------------------+
| 項目名                           | 項目の具体値を入力します。       |
|                                  |                                  |
| （「                             | 入力した具体値は、「             |
| *4.1パラメータシ                 | *4.9代入値の                     |
| ート作成*\ 」で定義した項目名）  | 反映*\ 」でオペレーションとMove  |
|                                  | mentおよび作業対象ホストに紐付く |
|                                  | 変数の具体値として反映されます。 |
+----------------------------------+----------------------------------+

..

   「ホスト名/ホストグループ」と「オペレーション」の組み合わせは一意で登録します。

   同じホストでも異なるオペレーションと組み合わせれば登録が可能です。

　　　　　　　　　　　　　　　　　　　　　

ホスト化
--------

   「
   *4.5パラメータシートメニューへの登録*\ 」で登録した情報は、内部の処理「ホストグループ分解機能」により、オペレーション毎にまとめ、更にホストグループの紐付けに従い作業対象ホスト単位まで継承が行われます。

   作業対象ホスト単位に継承された情報は、「
   *4.1パラメータシート作成*\ 」で作成したホスト用のパラメータシートメニューで参照することができます。

   参照のみ可能で、登録/更新/廃止/復活は不可です。

|image10|

   ホスト化の流れの例を以下で説明します。

（1） パラメータシートメニューへ登録した項目は以下とします。

   （「 *4.5パラメータシートメニューへの登録*\ 」で登録する情報）

======================== =================== ========= =========
**作業対象ホスト**       **オペレーション**  **項目1** **項目2**
                                                       
**　or　ホストグループ**                               
======================== =================== ========= =========
HG_1                     2017/10/31_1001_OP1 111       AAA
HG_2                     2017/10/31_1001_OP1 ―         BBB
host_1a                  2017/10/31_1001_OP1 222       ―
======================== =================== ========= =========

..

   　

   （2） ホストグループの親子関係は以下とします。

   （「 *4.3ホストグループ親子関係の定義*\ 」で登録する情報）

==================== ====================
**親ホストグループ** **子ホストグループ**
==================== ====================
HG_1                 hg_1a
HG_1                 hg_1b
HG_2                 hg_2a
HG_2                 hg_2b
==================== ====================

（3）ホストグループ、オペレーション、作業対象ホストの紐付情報は以下とします。

   （「
   *4.4ホストグループとオペレーションと作業対象ホストの紐付け*\ 」で登録する情報）

================== =================== ==================
**ホストグループ** **オペレーション**  **作業対象ホスト**
================== =================== ==================
hg_1a              2017/10/31_1001_OP1 host_1a
hg_1b              2017/10/31_1001_OP1 host_1b
hg_2a              2017/10/31_1001_OP1 host_2a
hg_2b              2017/10/31_1001_OP1 host_2b
================== =================== ==================

..

   （4）　（1）～（3）に情報が登録されている状態でホスト化が行われると、レコードは以下の内容となり、ホストグループに所属している作業対象ホスト単位に情報が設定されていることがわかります。

+----------+----------+----------+----------+----------+----------+
| **       | **       | *        | *        |          |          |
| 作業対象 | オペレー | *項目1** | *項目2** |          |          |
| ホスト** | ション** |          |          |          |          |
+==========+==========+==========+==========+==========+==========+
|          | **実施   | **ID**   | **オ     |          |          |
|          | 予定日** |          | ペレーシ |          |          |
|          |          |          | ョン名** |          |          |
+----------+----------+----------+----------+----------+----------+
| host_1a  | 20       | 1001     | OP1      | 222      | AAA      |
|          | 17/10/31 |          |          | 　（※1） | 　（※2） |
+----------+----------+----------+----------+----------+----------+
| host_1b  | 20       | 1001     | OP1      | 111      | AAA      |
|          | 17/10/31 |          |          |          |          |
+----------+----------+----------+----------+----------+----------+
| host_2a  | 20       | 1001     | OP1      | ―        | BBB      |
|          | 17/10/31 |          |          | 　（※3） |          |
+----------+----------+----------+----------+----------+----------+
| host_2b  | 20       | 1001     | OP1      | ―        | BBB      |
|          | 17/10/31 |          |          | 　（※3） |          |
+----------+----------+----------+----------+----------+----------+

..

   （※1）　ホストグループと作業対象ホストで項目を登録すると、作業対象ホストの項目が優先されます。従って、host_1aに登録した「222」が適用されています。

   （※2）　作業対象ホストの項目が優先されますが、空の場合は上位から継承されます。host1_aの項目2は空だったので、親ホストグループであるHG_1の「AAA」が継承されています。

   （※3）　host_2aとhost_2bの項目1は空になっていますが、これはHG_2の項目1が空のためです。

   （※4）　「機器一覧」メニューの管理システム項番が10,000,000以上のホストは、ホストグループ機能が正常に動作しません。

   ホストグループ機能を使用する場合は、管理システム項番を10,000,000未満になるようにしてください。

オペレーションと作業対象ホストごとの項目の設定値を紐付け
--------------------------------------------------------

   「代入値自動登録設定」メニュー画面で連携対象としたメニューと項目を、Movementの変数に紐付けます。登録/更新/廃止/復活が可能です。

   登録した情報は内部の処理により「代入値管理」メニュー画面と「作業対象ホスト」メニュー画面に反映されます。

   詳細については、「パラメータ管理メニューガイド」を参照してください。

オペレーションに紐付く作業対象ホストの反映
------------------------------------------

   オペレーションに関連付く作業対象ホストが自動で反映されます。

   反映結果は「作業対象ホスト」メニュー画面で確認できます。

   詳細については、「パラメータ管理メニューガイド」を参照してください。

代入値の反映
------------

   オペレーションごとに、対象のMovement で利用されるPlaybook
   やテンプレートファイル内の変数「VAR_」に代入する具体値が自動で反映されます。

   ここでの具体値は「
   *4.5パラメータシートメニューへの登録*\ 」で入力した具体値となります。

   反映結果は「代入値管理」メニュー画面で確認できます。

   詳細については、「パラメータ管理メニューガイド」を参照してください。

運用操作
========

   ホストグループ機能を活用する操作はクライアントPCのブラウザ画面からのユーザ利用による入力だけでなく、システム運用・保守による操作もあります。用意している運用・保守の操作は次の通りです。

   ■　メンテナンス

   ■　ログレベルの変更

メンテナンス
------------

   ホストグループ機能のプロセスの開始/停止/再起動に必要なファイルは以下となります。

+-----------------------------------+---------------------------------+
| **説明**                          | **対象ファイル名**              |
+===================================+=================================+
| ホストグループ分解機能。          | ky_hostgroup_split.service      |
|                                   |                                 |
| ホ                                |                                 |
| ストグループ単位に入力されている  |                                 |
| 設計情報をホスト単位に分解する。  |                                 |
+-----------------------------------+---------------------------------+
| ループチェック機能。              | ky_hostgroup_check_loop.service |
|                                   |                                 |
| ホストグ                          |                                 |
| ループの親子関係がループ状態にあ  |                                 |
| るかどうかチェックする機能です。  |                                 |
+-----------------------------------+---------------------------------+

..

   対象ファイルは「/usr/lib/systemd/system」に格納されています。

   プロセス起動/停止/再起動の方法は次の通りです。

   root権限でコマンドを実行してください。

①　プロセス起動

   ②　プロセス停止

   ③　プロセス再起動

   同様に、各対象ファイル名に置き換えて起動/停止/再起動を行ってください。

ログレベルの変更
----------------

   | ①　NORMALレベルへの変更
   | 以下のファイルの8行目「DEBUG」を「NORMAL」に書き換えます。
   | ログレベル設定ファイル：
     *<インストールディレクトリ>/ita-root/confs/backyardconfs/ita_env*

   | ②　DEBUGレベルへの変更
   | 以下のファイルの8行目「NORMAL」を「DEBUG」に書き換えます。
   | ログレベル設定ファイル：
     *<インストールディレクトリ>/ita-root/confs/backyardconfs/ita_env*

書き換え後、\ **プロセス再起動(restart)後に有効になります。**

再起動については「 *5.1* *メンテナンス*\ 」を参照してください。

ログファイルの出力先：
*<インストールディレクトリ>/ita-root/logs/backyardlogs*

.. |image1| image:: host_group/image1.png
   :width: 3.35903in
   :height: 0.78681in
.. |image2| image:: host_group/image2.png
   :width: 6.4939in
   :height: 4.56706in
.. |image3| image:: host_group/image3.png
   :width: 6.33388in
   :height: 4.82042in
.. |image4| image:: host_group/image4.png
   :width: 5.22863in
   :height: 0.99251in
.. |image5| image:: host_group/image5.png
   :width: 5.92051in
   :height: 4.22037in
.. |image6| image:: host_group/image6.png
   :width: 6.22721in
   :height: 4.6604in
.. |image7| image:: host_group/image7.png
   :width: 6.29388in
   :height: 2.78024in
.. |image8| image:: host_group/image8.png
   :width: 0.76181in
   :height: 0.19167in
.. |image9| image:: host_group/image9.png
   :width: 5.36046in
   :height: 4.67374in
.. |image10| image:: host_group/image10.png
   :width: 6.45389in
   :height: 4.55373in
