
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <title>4. Ansible Automation Controller &#8212; Documentation  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/option.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/exastro_documents.css?v=2" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/swagger/swagger-ui.css" />
    
    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/translations.js"></script>
    <script src="../../../../_static/jquery-3.6.3.min.js"></script>
    <script src="../../../../_static/exastro_documents.js?v=1"></script>
    <script src="../../../../_static/swagger/swagger-ui-bundle.js"></script>
    <script src="../../../../_static/swagger/swagger-ui-standalone-preset.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../../../../genindex.html" />
    <link rel="search" title="検索" href="../../../../search.html" /> 
  </head>
<body id="page" class="ja">


<div id="container">

<div id="header">
  <header class="divInner">
    <!-- Exastro logo -->
    <div id="logo"><img src="../../../../_static/img/exastro.svg" alt="Exastro"></div>
    <!-- Project name -->
    <div id="projectName"><a href="../../../../index.html">Documentation</a></div>
    <!-- Heaedr navigation -->
    <div id="headerSearch">
      <form class="search" action="../../../../search.html" method="get">
        <input type="text" name="q" aria-labelledby="searchlabel">
        <button type="submit" value="検索"><img src="../../../../_static/img/search.png" alt="検索"></button>
      </form>
    </div>
  </header>
</div><!-- End #header -->


<div id="toolbar">
  <div class="divInner">
    
    <div id="documentVersion">
      <dl>
        <dt>Document version</dt>
        <dd>
          <div>
            <select name="version" onchange="location.href=value;">
                file_path: v2.0/ja/manuals/organization_management/aac
                  <option value="#"
                  selected
                  >current</option>
                file_path: v2.0/ja/manuals/organization_management/aac
                  <option value="#"
                  selected
                  >v2.0 (current)</option>
            </select>
          </div>
        </dd>
      </dl>
    </div>

    <div id="documentLanguage">
      <dl>
        <dt>Language</dt>
        <dd>
          <div>
            <select name="lang" onchange="location.href=value;">
                file_path: v2.0/ja/manuals/organization_management/aac
                hasdoc: True
                  <option value="#"
                  selected
                  >日本語</option>
                file_path: v2.0/en/manuals/organization_management/aac
                hasdoc: False
            </select>
          </div>
        </dd>
      </dl>
    </div>
    <div id="toolbarNavigation">
      <ul>
      </ul>
    </div>
  </div>
</div><!-- End #toolbar -->

<div id="sideMenu">

  <div id="menuButton"></div>
  
  <aside class="divInner">
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Exastro IT Automation Documentation</a></li>
</ul>

    <!-- <ul>
      <li class="toctree-l1"><a class="reference internal" href="../../../../genindex.html">索引</a></li>
    </ul> -->
    
  </aside>
</div><!-- End #sideMenu -->


<div id="tableOfContents">
  <div id="tocButton"></div>
  <ul>
<li><a class="reference internal" href="#">4. Ansible Automation Controller</a><ul>
<li><a class="reference internal" href="#id1">4.1. はじめに</a></li>
<li><a class="reference internal" href="#id2">4.2. Ansible Automation Controllerとは</a></li>
<li><a class="reference internal" href="#id3">4.3. Ansible Automation Controllerの登録</a><ul>
<li><a class="reference internal" href="#id4">4.3.1. 前提条件</a></li>
<li><a class="reference internal" href="#id5">4.3.2. Ansible Automation Controllerの一括登録</a><ul>
<li><a class="reference internal" href="#aac-create-method-1">方法1: 設定ファイルを使った作成方法</a></li>
<li><a class="reference internal" href="#rest-api">方法2: Rest API による作成方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id7">4.3.3. オーガナイゼーションへのアクセス</a></li>
<li><a class="reference internal" href="#id8">4.3.4. その他制約事項・備考</a><ul>
<li><a class="reference internal" href="#id9">Ansible Automation Controller登録を再実行する場合</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

</div>


<div id="contents">
<main class="divInner">

 <div id="breadcrumbs">
  <ul>
    <li><a href="../../../../index.html">HOME</a></li>
    
    <li><span class="section-number">4. </span>Ansible Automation Controller</li>
  </ul>
</div>

<div id="article">
<article class="divInner">
<div class="body" role="main">

  <section id="ansible-automation-controller">
<h1><span class="section-number">4. </span>Ansible Automation Controller<a class="headerlink" href="#ansible-automation-controller" title="この見出しへのパーマリンク">¶</a></h1>
<section id="id1">
<h2><span class="section-number">4.1. </span>はじめに<a class="headerlink" href="#id1" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本章では、Exastro Suite における Ansible Automation Controller について説明します。</div>
</div>
</section>
<section id="id2">
<h2><span class="section-number">4.2. </span>Ansible Automation Controllerとは<a class="headerlink" href="#id2" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">Ansible Automation Controllerとは、PF構築自動化ツールであるAnsibleにアクセスコントロール、ジョブスケジューリング、タスクの可視化などの機能を拡張した管理プラットフォームです。</div>
</div>
</section>
<section id="id3">
<h2><span class="section-number">4.3. </span>Ansible Automation Controllerの登録<a class="headerlink" href="#id3" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">Ansible Automation Controllerの登録をすることで、“プロジェクト”、”インベントリ”、”認証情報”の組合せで”ジョブテンプレート”を作成しAnsibleを実行できます。</div>
<div class="line">複数の“ジョブテンプレート”を組み合せて”ワークフロージョブテンプレート”を作成することによって、より多彩な作業フローを表現することができます。</div>
</div>
<section id="id4">
<h3><span class="section-number">4.3.1. </span>前提条件<a class="headerlink" href="#id4" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">本作業には下記のコマンドが必要となるため、事前にインストールをしてください。</div>
</div>
<ul class="simple">
<li><p>作業クライアントに必要なアプリケーション</p>
<ul>
<li><p><kbd class="kbd docutils literal notranslate">curl</kbd></p></li>
<li><p><kbd class="kbd docutils literal notranslate">git</kbd></p></li>
<li><p><kbd class="kbd docutils literal notranslate">jq</kbd></p></li>
</ul>
</li>
</ul>
</section>
<section id="id5">
<h3><span class="section-number">4.3.2. </span>Ansible Automation Controllerの一括登録<a class="headerlink" href="#id5" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible Automation Controllerの一括登録には、下記の3通りの方法があります。</div>
</div>
<ul class="simple">
<li><p><a class="reference internal" href="#aac-create-method-1"><span class="std std-ref">方法1: 設定ファイルを使った作成方法</span></a></p></li>
<li><p><a class="reference internal" href="#aac-create-method-2"><span class="std std-ref">方法2: Rest API による作成方法</span></a></p></li>
</ul>
<section id="aac-create-method-1">
<span id="id6"></span><h4>方法1: 設定ファイルを使った作成方法<a class="headerlink" href="#aac-create-method-1" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">GitHub リポジトリから取得した資材の中にある、シェルスクリプトを実行し Ansible Automation Controller を登録します。</div>
</div>
<ol class="arabic">
<li><p>Ansible Automation Controller登録用シェルスクリプトを、リポジトリから <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">git</kbd> <kbd class="kbd docutils literal notranslate">clone</kbd></kbd> により取得します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exastro Platform の資材を入手</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/exastro-suite/exastro-platform.git
</pre></div>
</div>
</li>
<li><p>設定ファイルの <kbd class="kbd docutils literal notranslate">CONF_BASE_URL</kbd> に Exastro Suite の管理用エンドポイント URL を設定します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exastro Platform への接続のための設定情報を登録</span>
vi<span class="w"> </span>./exastro-platform/test/tools/initial-settings-ansible.conf
</pre></div>
</div>
<div class="line-block">
<div class="line">例えば、<a class="reference internal" href="../../installation/installation_kubernetes.html#ingress-setting"><span class="std std-ref">サービス公開の設定 (Ingress の設定)</span></a> をした場合は下記のようになります。</div>
</div>
<ul>
<li><p>initial-settings-ansible.conf</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">- CONF_BASE_URL=http://platform-auth:8001</span>
<span class="gi">+ CONF_BASE_URL=http://exastro-suite-mng.xxxxxxxxxxxxxxxxxx.japaneast.aksapp.io</span>
<span class="w"> </span> CURL_OPT=-sv
</pre></div>
</div>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line">自己証明書を利用している場合、証明書エラーが発生します。</div>
<div class="line">設定ファイル内の <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">CURL_OPT=</kbd>-<kbd class="kbd docutils literal notranslate">sv</kbd></kbd> を <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">CURL_OPT=</kbd>-<kbd class="kbd docutils literal notranslate">svk</kbd></kbd> に変更することで証明書エラーを回避できますが、認証機関から発行された正しい証明書をインストールすることを推奨します。</div>
</div>
</div>
</li>
<li><p>Ansible Automation Controller情報の設定</p>
<div class="line-block">
<div class="line">Ansible Automation Controllerの登録情報として下記の項目を設定できます。</div>
</div>
<table class="docutils align-left">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 40.0%" />
<col style="width: 26.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>項目の内容</p></th>
<th class="head"><p>形式</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>input_limit_setting</p></td>
<td><div class="line-block">
<div class="line">Ansible共通の「インターフェース情報(一部※)」と「Ansible AUtomation Controllerホスト一覧」の入力制限</div>
<div class="line">true に設定することで、Ansible共通の「インターフェース情報(一部※)」と「Ansible AUtomation Controllerホスト一覧」をITAの画面上から編集できないようにする。</div>
<div class="line"><br /></div>
<div class="line">※「インターフェース情報」の入力制限がかかる項目について</div>
<div class="line-block">
<div class="line">「実行エンジン」、「Ansible AUtomation Controller インターフェース」、「Proxy」</div>
</div>
</div>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>exection_engine_list</p></td>
<td><div class="line-block">
<div class="line">Ansible共通の「インターフェース情報」の「実行エンジン」で選択可能な項目</div>
<div class="line">Ansible-Core または Ansible Automation Controllerの指定可能</div>
</div>
</td>
<td><p>Ansible-Core と Ansible AUtomation Controllerの２つ指定することで、双方選択可能になる</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-left" id="id10">
<caption><span class="caption-text">Ansible共通「Ansible Automation Controllerホスト一覧」の初期設定データ</span><a class="headerlink" href="#id10" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 40.0%" />
<col style="width: 26.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>項目の内容</p></th>
<th class="head"><p>形式</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ssh_private_key_file</p></td>
<td><p>ssh秘密鍵ファイルをbase64エンコードした値を入力</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>host</p></td>
<td><p>実行エンジンのホスト名</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>authentication_method</p></td>
<td><div class="line-block">
<div class="line">認証方式の選択</div>
<div class="line">Ansible・Ansible Automation Controller から機器へ接続する際の認証方式を選択します。</div>
<div class="line">●パスワード認証</div>
<div class="line">ログインパスワードの管理で●の選択と、ログインパスワードの入力が必須です。</div>
<div class="line">●鍵認証（パスフレーズなし）</div>
<div class="line">ssh 秘密鍵ファイル(id_ras)のアップロードが必須です。</div>
<div class="line">●鍵認証（パスフレーズあり）</div>
<div class="line">ssh 秘密鍵ファイル(id_ras)のアップロードと、パスフレーズの入力が必須です。</div>
<div class="line">●鍵認証（鍵交換済み）※</div>
<div class="line">ssh 秘密鍵ファイル(id_ras)のアップロードは必要ありません。</div>
</div>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>user</p></td>
<td><p>sshで Ansible Automation Controller に接続する場合のユーザ名</p></td>
<td><p>プロジェクトパス(/var/lib/aws/projects)への書き込み制限が必要</p></td>
</tr>
<tr class="row-even"><td><p>password</p></td>
<td><div class="line-block">
<div class="line">パスワード入力</div>
<div class="line">パスワード認証する場合のパスワード</div>
</div>
</td>
<td><p>最大長128バイト</p></td>
</tr>
<tr class="row-odd"><td><p>passphrase</p></td>
<td><p>ssh秘密鍵ファイルにパスフレーズが設定されている場合、パスフレーズを入力します。</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-even"><td><p>isolated_tower</p></td>
<td><p>対象ノードが Ansible Automation Controller のexecution nodeの場合に「True」を入力します。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>remarks</p></td>
<td><p>備考</p></td>
<td></td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line">※ 認証方式が鍵認証（鍵交換済み）に設定する為に必要な公開鍵ファイルの配布</div>
<div class="line">・Ansible Core の場合</div>
<div class="line">ansible がインストールされているサーバーの実行ユーザー「Ansible 共通コンソール=&gt;インターフェース情報に設定されている実行ユーザー」から作業対象ホストに ssh 接続します。</div>
<div class="line">実行ユーザーの公開鍵ファイルをログイン先ユーザーの authorized_keys にコピーして下さい。</div>
<div class="line"><br /></div>
<div class="line">・Ansible Automation Controller の場合</div>
<div class="line">Ansible Automation Controller の awx ユーザーから作業対象ホストに ssh 接続しています。</div>
<div class="line">awx ユーザーの公開鍵ファイルをログイン先ユーザーの authorized_keys にコピーして下さい。ブラウザより Ansible Automation Controller にログインし、「設定」→「ジョブ」→「分離されたジョブに公開するパス」に「/var/lib/awx/.ssh/」を設定します。</div>
</div>
</div>
<table class="docutils align-left" id="id11">
<caption><span class="caption-text">Ansible共通「インターフェース情報」用の初期設定データ</span><a class="headerlink" href="#id11" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 40.0%" />
<col style="width: 26.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>項目の内容</p></th>
<th class="head"><p>形式</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>execution_engine</p></td>
<td><div class="line-block">
<div class="line">実行エンジンの指定</div>
<div class="line">Ansible-Core または Ansible Automation Controller の指定可能</div>
</div>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>representative_server</p></td>
<td><div class="line-block">
<div class="line">代表ホスト</div>
<div class="line">「Ansible Automation Controller ホスト一覧」に登録されいるホストの一覧より、ITA と通信する Ansible Automation Controller のホストを選択します。</div>
</div>
</td>
<td><p>実行エンジンがAnsible Core 以外の場合に入力必須</p></td>
</tr>
<tr class="row-even"><td><p>ansible_automation_controller_protocol</p></td>
<td><div class="line-block">
<div class="line">プロトコル入力</div>
<div class="line">Ansible Automation Controller サーバとのプロトコルをhttp / https のどちらかを入力します。 通常は https です。</div>
</div>
</td>
<td><p>実行エンジンがAnsible Core 以外の場合に入力必須</p></td>
</tr>
<tr class="row-odd"><td><p>ansible_automation_controller_port</p></td>
<td><div class="line-block">
<div class="line">ポート入力</div>
<div class="line">Ansible Automation Controller サーバの接続ポート(80/443)を入力します。通常は HTTPS(443)です。</div>
</div>
</td>
<td><p>実行エンジンがAnsible Core 以外の場合に入力必須</p></td>
</tr>
<tr class="row-even"><td><p>organization_name</p></td>
<td><div class="line-block">
<div class="line">組織名</div>
<div class="line">Ansible Automation Controller サーバに登録されている組織名を選択します。</div>
</div>
</td>
<td><p>実行エンジンがAnsible Core 以外の場合に入力必須</p></td>
</tr>
<tr class="row-odd"><td><p>authentication_token</p></td>
<td><div class="line-block">
<div class="line">認証トークン入力</div>
<div class="line">ITA から Ansible Automation Controller サーバに接続するユーザーの認証トークンを入力します。</div>
</div>
</td>
<td><p>実行エンジンがAnsible Core 以外の場合に入力必須</p></td>
</tr>
<tr class="row-even"><td><p>delete_runtime_data</p></td>
<td><div class="line-block">
<div class="line">実行時データ削除</div>
<div class="line">作業実行時にITAとAnsible Automation Controller 内に一時的に生成されるデータリソースを作業終了後に削除するかを選択します。</div>
</div>
</td>
<td><p>実行エンジンがAnsible Core 以外の場合に入力必須</p></td>
</tr>
<tr class="row-odd"><td><p>proxy_address</p></td>
<td><div class="line-block">
<div class="line">プロキシサーバのアドレスを入力</div>
<div class="line">ITAがプロキシ環境下にある場合、Ansible/ Ansible Automation Controllerサーバまでの疎通のために設定が必要な場合があります。</div>
<div class="line">プロキシサーバのURLが <a class="reference external" href="http://procy.gate.co.jp:8080">http://procy.gate.co.jp:8080</a> の場合、Addressには <a class="reference external" href="http://procy.gate.co.jp">http://procy.gate.co.jp</a> を入力します。</div>
<div class="line">Portには 8080を入力します。</div>
</div>
</td>
<td><p>最大128バイト</p></td>
</tr>
<tr class="row-even"><td><p>proxy_port</p></td>
<td><div class="line-block">
<div class="line">プロキシサーバのポートを入力</div>
<div class="line">ITAがプロキシ環境下にある場合、Ansible/ Ansible Automation Controllerサーバまでの疎通のために設定が必要な場合があります。</div>
</div>
</td>
<td></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">設定ファイルの作成は、<code class="file docutils literal notranslate"><span class="pre">./exastro-platform/test/tools/initial-settings-ansible.sample.json</span></code> を基に、作成する Ansible Automation Controller の情報を指定した JSON ファイルを基に作成します。</div>
</div>
<details>
  <summary>initial-settings-ansible.sample.json</summary><div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;input_limit_setting&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;execution_engine_list&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;string&quot;</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;initial_data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;ansible_automation_controller_host_list&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;ssh_private_key_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;parameter&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;authentication_method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;ssh_private_key_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;passphrase&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;isolated_tower&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;remarks&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;interface_info_ansible&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;parameter&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;execution_engine&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;representative_server&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;ansible_automation_controller_protocol&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;ansible_automation_controller_port&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;organization_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;authentication_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;delete_runtime_data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;proxy_address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;proxy_port&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</details><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>exastro-platform/test/tools/

cp<span class="w"> </span>-pi<span class="w"> </span>./exastro-platform/test/tools/initial-settings-ansible<span class="o">{</span>.sample,<span class="o">}</span>.json

vi<span class="w"> </span>./exastro-platform/test/tools/initial-settings-ansible.json
</pre></div>
</div>
</li>
</ol>
<ol class="arabic">
<li><p>Ansible Automation Controller作成実行</p>
<p>Platform管理者アカウントを登録していない場合は、<a class="reference external" href="http://10.197.17.190:30400/631aac9174a18b0047bb938c">Platform管理者アカウントの追加</a></p>
<ul>
<li><p>コマンド</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./exastro-platform/test/tools/initial-settings-ansible.sh<span class="w"> </span>initial-settings-ansible.json

your<span class="w"> </span>username<span class="w"> </span>:<span class="w"> </span>INPUT-YOUR-USERNAME<span class="w"> </span><span class="c1"># Platform管理者のユーザ名を入力します</span>
your<span class="w"> </span>password<span class="w"> </span>:<span class="w"> </span>INPUT-USER-PASSWORD<span class="w"> </span><span class="c1"># Platform管理者のパスワードを入力します</span>

Create<span class="w"> </span>an<span class="w"> </span>organization,<span class="w"> </span>are<span class="w"> </span>you<span class="w"> </span>sure?<span class="w"> </span><span class="o">(</span>Y/other<span class="o">)</span><span class="w"> </span>:<span class="w"> </span>Y<span class="w"> </span><span class="c1"># Y を入力するとAnsible Automation Controllerの登録処理が開始します</span>
</pre></div>
</div>
</li>
<li><p>成功時の結果表示
resultが”000-00000”が、 Ansible Automation Controller の作成に成功したことを示しています。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>...
&lt;<span class="w"> </span>HTTP/1.1<span class="w"> </span><span class="m">200</span><span class="w"> </span>OK
&lt;<span class="w"> </span>Date:<span class="w"> </span>Thu,<span class="w"> </span><span class="m">18</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">2022</span><span class="w"> </span><span class="m">01</span>:49:13<span class="w"> </span>GMT
&lt;<span class="w"> </span>Server:<span class="w"> </span>Apache/2.4.37<span class="w"> </span><span class="o">(</span>Red<span class="w"> </span>Hat<span class="w"> </span>Enterprise<span class="w"> </span>Linux<span class="o">)</span><span class="w"> </span>mod_wsgi/4.7.1<span class="w"> </span>Python/3.9
&lt;<span class="w"> </span>Content-Length:<span class="w"> </span><span class="m">107</span>
&lt;<span class="w"> </span>Content-Type:<span class="w"> </span>application/json
&lt;
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;data&quot;</span>:<span class="w"> </span>null,
<span class="w">  </span><span class="s2">&quot;message&quot;</span>:<span class="w"> </span><span class="s2">&quot;SUCCESS&quot;</span>,
<span class="w">  </span><span class="s2">&quot;result&quot;</span>:<span class="w"> </span><span class="s2">&quot;000-00000&quot;</span>,
<span class="w">  </span><span class="s2">&quot;ts&quot;</span>:<span class="w"> </span><span class="s2">&quot;2022-08-18T01:49:17.251Z&quot;</span>
<span class="o">}</span>
*<span class="w"> </span>Connection<span class="w"> </span><span class="c1">#0 to host platform-auth left intact</span>
</pre></div>
</div>
</li>
<li><p>失敗時の結果表示イメージ</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>...
&lt;<span class="w"> </span>HTTP/1.1<span class="w"> </span><span class="m">400</span><span class="w"> </span>BAD<span class="w"> </span>REQUEST
&lt;<span class="w"> </span>Date:<span class="w"> </span>Thu,<span class="w"> </span><span class="m">18</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">2022</span><span class="w"> </span><span class="m">05</span>:29:35<span class="w"> </span>GMT
&lt;<span class="w"> </span>Server:<span class="w"> </span>Apache/2.4.37<span class="w"> </span><span class="o">(</span>Red<span class="w"> </span>Hat<span class="w"> </span>Enterprise<span class="w"> </span>Linux<span class="o">)</span><span class="w"> </span>mod_wsgi/4.7.1<span class="w"> </span>Python/3.9
&lt;<span class="w"> </span>Content-Length:<span class="w"> </span><span class="m">252</span>
&lt;<span class="w"> </span>Connection:<span class="w"> </span>close
&lt;<span class="w"> </span>Content-Type:<span class="w"> </span>application/json
&lt;
<span class="o">{</span><span class="w"> </span><span class="o">[</span><span class="m">252</span><span class="w"> </span>bytes<span class="w"> </span>data<span class="o">]</span>
*<span class="w"> </span>Closing<span class="w"> </span>connection<span class="w"> </span><span class="m">0</span>
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;data&quot;</span>:<span class="w"> </span>null,
<span class="w">  </span><span class="s2">&quot;message&quot;</span>:<span class="w"> </span><span class="s2">&quot;指定されたorganization(org002)は作成済みのため、作成できません。&quot;</span>,
<span class="w">  </span><span class="s2">&quot;result&quot;</span>:<span class="w"> </span><span class="s2">&quot;400-23001&quot;</span>,
<span class="w">  </span><span class="s2">&quot;ts&quot;</span>:<span class="w"> </span><span class="s2">&quot;2022-08-18T05:29:35.643Z&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</section>
<section id="rest-api">
<span id="aac-create-method-2"></span><h4>方法2: Rest API による作成方法<a class="headerlink" href="#rest-api" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">Rest API を使って Ansible Automation Controller を登録します。</div>
</div>
<table class="docutils align-left">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 40.0%" />
<col style="width: 26.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>項目の内容</p></th>
<th class="head"><p>形式</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>input_limit_setting</p></td>
<td><div class="line-block">
<div class="line">Ansible共通の「インターフェース情報(一部※)」と「Ansible AUtomation Controllerホスト一覧」の入力制限</div>
<div class="line">true に設定することで、Ansible共通の「インターフェース情報(一部※)」と「Ansible AUtomation Controllerホスト一覧」をITAの画面上から編集できないようにする。</div>
<div class="line"><br /></div>
<div class="line">※「インターフェース情報」の入力制限がかかる項目について</div>
<div class="line-block">
<div class="line">「実行エンジン」、「Ansible AUtomation Controller インターフェース」、「Proxy」</div>
</div>
</div>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>exection_engine_list</p></td>
<td><div class="line-block">
<div class="line">実行エンジンの指定</div>
<div class="line">Ansible-Core または Ansible Automation Controllerの指定可能</div>
</div>
</td>
<td><p>Ansible-Core と Ansible AUtomation Controllerの２つ指定することで、双方選択可能になる</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-left" id="id12">
<caption><span class="caption-text">Ansible共通「Ansible Automation Controllerホスト一覧」の初期設定データ</span><a class="headerlink" href="#id12" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 40.0%" />
<col style="width: 26.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>項目の内容</p></th>
<th class="head"><p>形式</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ssh_private_key_file</p></td>
<td><p>ssh秘密鍵ファイルをbase64エンコードした値を入力</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>host</p></td>
<td><p>実行エンジンのホスト名</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>authentication_method</p></td>
<td><div class="line-block">
<div class="line">認証方式の選択</div>
<div class="line">Ansible・Ansible Automation Controller から機器へ接続する際の認証方式を選択します。</div>
<div class="line">●パスワード認証</div>
<div class="line">ログインパスワードの管理で●の選択と、ログインパスワードの入力が必須です。</div>
<div class="line">●鍵認証（パスフレーズなし）</div>
<div class="line">ssh 秘密鍵ファイル(id_ras)のアップロードが必須です。</div>
<div class="line">●鍵認証（パスフレーズあり）</div>
<div class="line">ssh 秘密鍵ファイル(id_ras)のアップロードと、パスフレーズの入力が必須です。</div>
<div class="line">●鍵認証（鍵交換済み）</div>
<div class="line">ssh 秘密鍵ファイル(id_ras)のアップロードは必要ありません。</div>
</div>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>user</p></td>
<td><p>sshで Ansible Automation Controller に接続する場合のユーザ名</p></td>
<td><p>プロジェクトパス(/var/lib/aws/projects)への書き込み制限が必要</p></td>
</tr>
<tr class="row-even"><td><p>password</p></td>
<td><div class="line-block">
<div class="line">パスワード入力</div>
<div class="line">パスワード認証する場合のパスワード</div>
</div>
</td>
<td><p>最大長128バイト</p></td>
</tr>
<tr class="row-odd"><td><p>passphrase</p></td>
<td><p>ssh秘密鍵ファイルにパスフレーズが設定されている場合、パスフレーズを入力します。</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-even"><td><p>isolated_tower</p></td>
<td><p>対象ノードが Ansible Automation Controller のexecution nodeの場合に「True」を入力します。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>remarks</p></td>
<td><p>備考</p></td>
<td></td>
</tr>
</tbody>
</table>
<table class="docutils align-left" id="id13">
<caption><span class="caption-text">Ansible共通「インターフェース情報」用の初期設定データ</span><a class="headerlink" href="#id13" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 40.0%" />
<col style="width: 26.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>項目の内容</p></th>
<th class="head"><p>形式</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>execution_engine</p></td>
<td><div class="line-block">
<div class="line">実行エンジンの指定</div>
<div class="line">Ansible-Core または Ansible Automation Controller の指定可能</div>
</div>
</td>
<td></td>
</tr>
<tr class="row-odd"><td><p>representative_server</p></td>
<td><div class="line-block">
<div class="line">代表ホスト</div>
<div class="line">「Ansible Automation Controller ホスト一覧」に登録されいるホストの一覧より、ITA と通信する Ansible Automation Controller のホストを選択します。</div>
</div>
</td>
<td><p>実行エンジンがAnsible Core 以外の場合に入力必須</p></td>
</tr>
<tr class="row-even"><td><p>ansible_automation_controller_protocol</p></td>
<td><div class="line-block">
<div class="line">プロトコル入力</div>
<div class="line">Ansible Automation Controller サーバとのプロトコルをhttp / https のどちらかを入力します。 通常は https です。</div>
</div>
</td>
<td><p>実行エンジンがAnsible Core 以外の場合に入力必須</p></td>
</tr>
<tr class="row-odd"><td><p>ansible_automation_controller_port</p></td>
<td><div class="line-block">
<div class="line">ポート入力</div>
<div class="line">Ansible Automation Controller サーバの接続ポート(80/443)を入力します。通常は HTTPS(443)です。</div>
</div>
</td>
<td><p>実行エンジンがAnsible Core 以外の場合に入力必須</p></td>
</tr>
<tr class="row-even"><td><p>organization_name</p></td>
<td><div class="line-block">
<div class="line">組織名</div>
<div class="line">Ansible Automation Controller サーバに登録されている組織名を選択します。</div>
</div>
</td>
<td><p>実行エンジンがAnsible Core 以外の場合に入力必須</p></td>
</tr>
<tr class="row-odd"><td><p>authentication_token</p></td>
<td><div class="line-block">
<div class="line">認証トークン入力</div>
<div class="line">ITA から Ansible Automation Controller サーバに接続するユーザーの認証トークンを入力します。</div>
</div>
</td>
<td><p>実行エンジンがAnsible Core 以外の場合に入力必須</p></td>
</tr>
<tr class="row-even"><td><p>delete_runtime_data</p></td>
<td><div class="line-block">
<div class="line">実行時データ削除</div>
<div class="line">作業実行時にITAとAnsible Automation Controller 内に一時的に生成されるデータリソースを作業終了後に削除するかを選択します。</div>
</div>
</td>
<td><p>実行エンジンがAnsible Core 以外の場合に入力必須</p></td>
</tr>
<tr class="row-odd"><td><p>proxy_address</p></td>
<td><div class="line-block">
<div class="line">プロキシサーバのアドレスを入力</div>
<div class="line">ITAがプロキシ環境下にある場合、Ansible/ Ansible Automation Controllerサーバまでの疎通のために設定が必要な場合があります。</div>
<div class="line">プロキシサーバのURLが <a class="reference external" href="http://procy.gate.co.jp:8080">http://procy.gate.co.jp:8080</a> の場合、Addressには <a class="reference external" href="http://procy.gate.co.jp">http://procy.gate.co.jp</a> を入力します。</div>
<div class="line">Portには 8080を入力します。</div>
</div>
</td>
<td><p>最大128バイト</p></td>
</tr>
<tr class="row-even"><td><p>proxy_port</p></td>
<td><div class="line-block">
<div class="line">プロキシサーバのポートを入力</div>
<div class="line">ITAがプロキシ環境下にある場合、Ansible/ Ansible Automation Controllerサーバまでの疎通のために設定が必要な場合があります。</div>
</div>
</td>
<td></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">シェルスクリプトを介さずに、APIを直接実行する場合は、以下の様なコマンドを実行してください。</div>
<div class="line">BASIC 認証を行うために、Exastro Platform 管理者の認証情報を <kbd class="kbd docutils literal notranslate">BASE64_BASIC</kbd> に設定する必要があります。</div>
<div class="line">認証情報に関して、<a class="reference internal" href="../../installation/installation_kubernetes.html#database-setup"><span class="std std-ref">インストール時に登録した認証情報</span></a> で登録した内容となります。</div>
</div>
<div class="line-block">
<div class="line">また、Exastro Platform の管理用 URL 情報を <kbd class="kbd docutils literal notranslate">BASE_URL</kbd> に設定する必要があります。</div>
<div class="line">例えば、<a class="reference internal" href="../../installation/installation_kubernetes.html#ingress-setting"><span class="std std-ref">サービス公開の設定 (Ingress の設定)</span></a> をした場合は下記のようになります。</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">BASE64_BASIC</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;KEYCLOAK_USER:KEYCLOAK_PASSWORD&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="k">)</span>
<span class="nv">BASE_URL</span><span class="o">=</span>http://exastro-suite-mng.xxxxxxxxxxxxxxxxxx.japaneast.aksapp.io

curl<span class="w"> </span>-k<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: basic </span><span class="si">${</span><span class="nv">BASE64_BASIC</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-d<span class="w">  </span>@-<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASE_URL</span><span class="si">}</span><span class="s2">/api/platform/organizations?retry=1&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s">&lt;&lt; EOF</span>
<span class="s">{</span>
<span class="s">    &quot;input_limit_setting&quot;: true,</span>
<span class="s">    &quot;execution_engine_list&quot;: [</span>
<span class="s">        &quot;string&quot;</span>
<span class="s">    ],</span>
<span class="s">    &quot;initial_data&quot;: {</span>
<span class="s">        &quot;ansible_automation_controller_host_list&quot;: [</span>
<span class="s">            {</span>
<span class="s">                &quot;file&quot;: {</span>
<span class="s">                    &quot;ssh_private_key_file&quot;: &quot;string&quot;</span>
<span class="s">                },</span>
<span class="s">                &quot;parameter&quot;: {</span>
<span class="s">                    &quot;host&quot;: &quot;string&quot;,</span>
<span class="s">                    &quot;authentication_method&quot;: &quot;string&quot;,</span>
<span class="s">                    &quot;user&quot;: &quot;string&quot;,</span>
<span class="s">                    &quot;password&quot;: &quot;string&quot;,</span>
<span class="s">                    &quot;ssh_private_key_file&quot;: &quot;string&quot;,</span>
<span class="s">                    &quot;passphrase&quot;: &quot;string&quot;,</span>
<span class="s">                    &quot;isolated_tower&quot;: &quot;string&quot;,</span>
<span class="s">                    &quot;remarks&quot;: &quot;string&quot;</span>
<span class="s">                }</span>
<span class="s">            }</span>
<span class="s">        ],</span>
<span class="s">        &quot;interface_info_ansible&quot;: {</span>
<span class="s">            &quot;parameter&quot;: {</span>
<span class="s">                &quot;execution_engine&quot;: &quot;string&quot;,</span>
<span class="s">                &quot;representative_server&quot;: &quot;string&quot;,</span>
<span class="s">                &quot;ansible_automation_controller_protocol&quot;: &quot;string&quot;,</span>
<span class="s">                &quot;ansible_automation_controller_port&quot;: &quot;string&quot;,</span>
<span class="s">                &quot;organization_name&quot;: &quot;string&quot;,</span>
<span class="s">                &quot;authentication_token&quot;: &quot;string&quot;,</span>
<span class="s">                &quot;delete_runtime_data&quot;: &quot;string&quot;,</span>
<span class="s">                &quot;proxy_address&quot;: &quot;string&quot;,</span>
<span class="s">                &quot;proxy_port&quot;: &quot;string&quot;</span>
<span class="s">            }</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">EOF</span>
</pre></div>
</div>
</section>
</section>
<section id="id7">
<h3><span class="section-number">4.3.3. </span>オーガナイゼーションへのアクセス<a class="headerlink" href="#id7" title="この見出しへのパーマリンク">¶</a></h3>
<ol class="arabic">
<li><p>オーガナイゼーション用サイトが表示できるかWebブラウザから確認します。</p>
<div class="line-block">
<div class="line">http[s]://{Exastro Platform の管理用 URL}/{オーガナイゼーションID}/platform/</div>
<div class="line">例: <a class="reference external" href="http://exastro-suite-mng.xxxxxxxxxxxxxxxxxx.japaneast.aksapp.io/org002/platform/">http://exastro-suite-mng.xxxxxxxxxxxxxxxxxx.japaneast.aksapp.io/org002/platform/</a></div>
</div>
</li>
</ol>
</section>
<section id="id8">
<h3><span class="section-number">4.3.4. </span>その他制約事項・備考<a class="headerlink" href="#id8" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id9">
<h4>Ansible Automation Controller登録を再実行する場合<a class="headerlink" href="#id9" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">Ansible Automation Controller登録の再実行する場合は、設定ファイルを再度編集してシェルスクリプトを実行して下さい。</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>./exastro-platform/test/tools/initial-settings-ansible.json
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./exastro-platform/test/tools/initial-settings-ansible.sh<span class="w"> </span>./exastro-platform/test/tools/initial-settings-ansible.sample.json
</pre></div>
</div>
</section>
</section>
</section>
</section>


</div>


<div id="articleNavigation">
  <ul>
  </ul>
</div>


<div id="pageTopLink">
  <a href="#container"><i>↑</i> Page Top</a>
</div>

</article>
</div>
</main>
</div><!-- End #contents -->
<div id="footer">
  <footer class="divInner">
    <small>Copyright © 2023 NEC Corporation</small>
  </footer>
</div><!-- End #footer -->

<div id="overlay"></div>
<div id="grayBack"></div>

</div><!-- End #container -->
  </body>
</html>