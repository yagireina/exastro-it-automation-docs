
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <title>1. Ansible-driver &#8212; Documentation  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/option.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/exastro_documents.css?v=2" />
    <link rel="stylesheet" type="text/css" href="../../../_static/swagger/swagger-ui.css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/translations.js"></script>
    <script src="../../../_static/jquery-3.6.3.min.js"></script>
    <script src="../../../_static/exastro_documents.js?v=1"></script>
    <script src="../../../_static/swagger/swagger-ui-bundle.js"></script>
    <script src="../../../_static/swagger/swagger-ui-standalone-preset.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="検索" href="../../../search.html" /> 
  </head>
<body id="page" class="ja">


<div id="container">

<div id="header">
  <header class="divInner">
    <!-- Exastro logo -->
    <div id="logo"><img src="../../../_static/img/exastro.svg" alt="Exastro"></div>
    <!-- Project name -->
    <div id="projectName"><a href="../../../index.html">Documentation</a></div>
    <!-- Heaedr navigation -->
    <div id="headerSearch">
      <form class="search" action="../../../search.html" method="get">
        <input type="text" name="q" aria-labelledby="searchlabel">
        <button type="submit" value="検索"><img src="../../../_static/img/search.png" alt="検索"></button>
      </form>
    </div>
  </header>
</div><!-- End #header -->


<div id="toolbar">
  <div class="divInner">
    
    <div id="documentVersion">
      <dl>
        <dt>Document version</dt>
        <dd>
          <div>
            <select name="version" onchange="location.href=value;">
                file_path: v2.0/ja/ansible-driver/general_operations
                  <option value="#"
                  selected
                  >current</option>
                file_path: v2.0/ja/ansible-driver/general_operations
                  <option value="#"
                  selected
                  >v2.0 (current)</option>
            </select>
          </div>
        </dd>
      </dl>
    </div>

    <div id="documentLanguage">
      <dl>
        <dt>Language</dt>
        <dd>
          <div>
            <select name="lang" onchange="location.href=value;">
                file_path: v2.0/ja/ansible-driver/general_operations
                hasdoc: True
                  <option value="#"
                  selected
                  >日本語</option>
                file_path: v2.0/en/ansible-driver/general_operations
                hasdoc: False
            </select>
          </div>
        </dd>
      </dl>
    </div>
    <div id="toolbarNavigation">
      <ul>
      </ul>
    </div>
  </div>
</div><!-- End #toolbar -->

<div id="sideMenu">

  <div id="menuButton"></div>
  
  <aside class="divInner">
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Exastro IT Automation Documentation</a></li>
</ul>

    <!-- <ul>
      <li class="toctree-l1"><a class="reference internal" href="../../../../genindex.html">索引</a></li>
    </ul> -->
    
  </aside>
</div><!-- End #sideMenu -->


<div id="tableOfContents">
  <div id="tocButton"></div>
  <ul>
<li><a class="reference internal" href="#">1. Ansible-driver</a><ul>
<li><a class="reference internal" href="#id1">1.1. はじめに</a></li>
<li><a class="reference internal" href="#id2">1.2. Ansible driver概要</a><ul>
<li><a class="reference internal" href="#ansible-core">Ansible Coreについて</a></li>
<li><a class="reference internal" href="#ansible-automation-controller">Ansible Automation Controllerについて</a></li>
<li><a class="reference internal" href="#id3">Ansible driverについて</a></li>
</ul>
</li>
<li><a class="reference internal" href="#general-operations-variable-handling-in-ansible-driver">1.3. Ansible driverでの変数取り扱い</a><ul>
<li><a class="reference internal" href="#id5">変数の種類</a></li>
<li><a class="reference internal" href="#id6">通常変数</a><ul>
<li><a class="reference internal" href="#id7">概要</a></li>
<li><a class="reference internal" href="#playbook">playbookにおける表記</a><ul>
<li><a class="reference internal" href="#id8">書式</a></li>
<li><a class="reference internal" href="#id9">正しい記述例</a></li>
<li><a class="reference internal" href="#wrong-description-example">誤った記述例</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id11">複数具体値変数</a><ul>
<li><a class="reference internal" href="#id12">概要</a></li>
<li><a class="reference internal" href="#id13">playbookにおける表記</a><ul>
<li><a class="reference internal" href="#id14">書式</a></li>
<li><a class="reference internal" href="#id15">正しい記述例</a></li>
<li><a class="reference internal" href="#id16">誤った記述例</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id17">多段変数</a><ul>
<li><a class="reference internal" href="#id18">概要</a></li>
<li><a class="reference internal" href="#id19">playbookにおける表記</a><ul>
<li><a class="reference internal" href="#id20">書式</a></li>
<li><a class="reference internal" href="#id21">正しい記述例</a></li>
<li><a class="reference internal" href="#id22">誤った記述例</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id23">グローバル変数</a><ul>
<li><a class="reference internal" href="#id24">概要</a></li>
<li><a class="reference internal" href="#id25">playbookにおける表記</a><ul>
<li><a class="reference internal" href="#id26">書式</a></li>
<li><a class="reference internal" href="#id27">正しい記述例</a></li>
<li><a class="reference internal" href="#id28">誤った記述例</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id29">テンプレート埋込変数</a><ul>
<li><a class="reference internal" href="#id30">概要</a></li>
<li><a class="reference internal" href="#id31">playbookにおける表記</a><ul>
<li><a class="reference internal" href="#id32">書式</a></li>
<li><a class="reference internal" href="#id33">正しい記述例</a></li>
<li><a class="reference internal" href="#id34">誤った記述例</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id35">ファイル埋込変数</a><ul>
<li><a class="reference internal" href="#id36">概要</a></li>
<li><a class="reference internal" href="#id37">playbookにおける表記</a><ul>
<li><a class="reference internal" href="#id38">書式</a></li>
<li><a class="reference internal" href="#id39">正しい記述例</a></li>
<li><a class="reference internal" href="#id40">誤った記述例</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#ita">ITA独自変数</a><ul>
<li><a class="reference internal" href="#id41">概要</a></li>
<li><a class="reference internal" href="#id42">機器一覧</a></li>
<li><a class="reference internal" href="#id43">オペレーション</a></li>
<li><a class="reference internal" href="#id44">データ連携</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id45">読替変数</a><ul>
<li><a class="reference internal" href="#id46">概要</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id47">変数の抜出および具体値登録</a></li>
<li><a class="reference internal" href="#id48">代入値登録による変数の扱い</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id49">1.4. Ansible driver コンソールメニュー構成</a><ul>
<li><a class="reference internal" href="#id50">メニュー/画面一覧</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id51">1.5. Ansible driver利用手順</a><ul>
<li><a class="reference internal" href="#ansible-legacyrole">Ansible-LegacyRole作業フロー</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id52">1.6. Ansible driver機能・操作方法説明</a><ul>
<li><a class="reference internal" href="#id53">基本コンソール</a><ul>
<li><a class="reference internal" href="#general-operations-input-operation-list">オペレーション一覧</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ansible">Ansible共通コンソール</a><ul>
<li><a class="reference internal" href="#general-operations-device-list">機器一覧</a></li>
<li><a class="reference internal" href="#general-operations-interface-information">インターフェース情報</a></li>
<li><a class="reference internal" href="#id57">Ansible Automation Controller ホスト一覧</a></li>
<li><a class="reference internal" href="#general-operations-global-variable-list">グローバル変数管理</a></li>
<li><a class="reference internal" href="#general-operations-file-list">ファイル管理</a></li>
<li><a class="reference internal" href="#general-operations-template-list">テンプレート管理</a></li>
<li><a class="reference internal" href="#general-operations-unmanaged-var-list">管理対象外変数リスト</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id62">Ansible-LegacyRoleコンソール</a><ul>
<li><a class="reference internal" href="#movement">Movement一覧</a></li>
<li><a class="reference internal" href="#general-operations-role-package-list-ansible-legacy-role-only">ロールパッケージ管理</a></li>
<li><a class="reference internal" href="#general-operations-movement-details">Movement-ロール紐付</a></li>
<li><a class="reference internal" href="#general-operations-nested-variable-list-ansible-legacy-role-only">変数ネスト管理</a></li>
<li><a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting">代入値自動登録設定</a></li>
<li><a class="reference internal" href="#general-operations-execution">作業実行</a></li>
<li><a class="reference internal" href="#general-operations-check-operation-status">作業状態確認</a></li>
<li><a class="reference internal" href="#general-operations-execution-list">作業管理</a></li>
<li><a class="reference internal" href="#general-operations-target-host">作業対象ホスト</a></li>
<li><a class="reference internal" href="#general-operations-substitution-value-list">代入値管理</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id72">1.7. 構築コード記述方法</a><ul>
<li><a class="reference internal" href="#ansible-legacy-role">ロールパッケージ（Ansible-Legacy Role）の記述</a><ul>
<li><a class="reference internal" href="#id74">マスターPlaybook</a><ul>
<li><a class="reference internal" href="#id75">① へッダーセクション</a></li>
<li><a class="reference internal" href="#roles">② rolesセクション</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id76">変数名の一意管理</a></li>
<li><a class="reference internal" href="#defaults-main-yml-ita">デフォルト変数定義ファイル(defaults-&gt;main.yml)のITA独自仕様</a></li>
<li><a class="reference internal" href="#ansible-role-directory-structure">Ansible Role Directory Structureにおける所定ディクレトリのサブディレクトリについて注意事項</a></li>
<li><a class="reference internal" href="#id77">ロールパッケージ内のロール名をディレクトリ階層にした場合の留意点</a></li>
</ul>
</li>
<li><a class="reference internal" href="#itareadme-ansible-legacy-role">ITAreadme（Ansible-Legacy Role）の記述</a><ul>
<li><a class="reference internal" href="#ita-readme">ITA readmeのファイル名の命名規則</a></li>
<li><a class="reference internal" href="#id78">ITA readmeのフォーマット</a></li>
</ul>
</li>
<li><a class="reference internal" href="#general-operations-write-translation-table-ansible-legacy-role-only">読替表（Ansible-Legacy Role）の記述</a><ul>
<li><a class="reference internal" href="#id80">読替表のファイル名は以下の命名規則</a></li>
<li><a class="reference internal" href="#id81">読替表のフォーマット</a></li>
<li><a class="reference internal" href="#id82">注意事項</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ita-readme-ansible-legacy-role">「ita_readme」と「読替表」の活用例（Ansible-Legacy Role）</a></li>
<li><a class="reference internal" href="#backyard">BackYardコンテンツ</a><ul>
<li><a class="reference internal" href="#id83">変数自動登録</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ansibleita">Ansible利用ガイドラインITA追加ルール</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id84">1.8. 運用操作</a><ul>
<li><a class="reference internal" href="#id85">メンテナンス</a></li>
<li><a class="reference internal" href="#general-operations-about-the-maintenance-method">メンテナンス方法について</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id87">1.9. 付録</a><ul>
<li><a class="reference internal" href="#general-operations-the-linkage-between-the-input-data-used-during-ansible-execution-and-ita-menu">Ansible実行時に使用される投入データとITAメニューの紐づけ</a><ul>
<li><a class="reference internal" href="#id89">Ansible-LegacyRole投入データ</a></li>
<li><a class="reference internal" href="#id90">投入データを直接実行する方法</a><ul>
<li><a class="reference internal" href="#id91">① 投入データの解凍先ディレクトリの作成</a></li>
<li><a class="reference internal" href="#id92">② 投入データを直接実行するコマンド</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id93">Ansible実行時に作成される結果データ</a><ul>
<li><a class="reference internal" href="#legacy-role">Legacy-Role 結果データに保存されるファイル一覧</a></li>
</ul>
</li>
<li><a class="reference internal" href="#general-operations-option-parameter-list">オプションパラメータ一覧</a></li>
<li><a class="reference internal" href="#ansible-automation-controllerita">Ansible Automation ControllerでITA独自変数を利用する場合の留意事項</a><ul>
<li><a class="reference internal" href="#ita-1">ITA独自変数を利用して作成したファイルの取り扱い {{#:1 こちらの修正をお願い致します。}}</a></li>
<li><a class="reference internal" href="#id95">留意事項</a></li>
</ul>
</li>
<li><a class="reference internal" href="#general-operations-data-resources-deleted-when-executing">実行時データ削除で削除されるデータリソース</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>


<div id="contents">
<main class="divInner">

 
 <div id="breadcrumbs">
  <ul>
    <li><a href="../../../index.html">HOME</a></li>
    
    <li><span class="section-number">1. </span>Ansible-driver</li>
  </ul>
</div>


<div id="article">
<article class="divInner">
<div class="body" role="main">

  <section id="ansible-driver">
<h1><span class="section-number">1. </span>Ansible-driver<a class="headerlink" href="#ansible-driver" title="この見出しへのパーマリンク">¶</a></h1>
<section id="id1">
<h2><span class="section-number">1.1. </span>はじめに<a class="headerlink" href="#id1" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本書では、ITAの機能および操作方法について説明します。</div>
</div>
</section>
<section id="id2">
<h2><span class="section-number">1.2. </span>Ansible driver概要<a class="headerlink" href="#id2" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本章ではAnsible、Ansible Automation ControllerおよびAnsible driverについて説明します。</div>
</div>
<section id="ansible-core">
<h3>Ansible Coreについて<a class="headerlink" href="#ansible-core" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible Coreとは、多数の構築管理対象に対して、アプリーケーション/システムのデプロイ作業を容易にするPF構築自動化ツールです。</div>
<div class="line">Ansible Coreは、PlaybookというYAML形式のテキストファイルに定型処理をタスクとして記述し、それをAnsible Coreに実行させることにより、さまざまな処理を実現できます。</div>
<div class="line">タスクはモジュールと呼ばれる処理プログラムと紐付いており、さまざまな機器に対する制御を行うことができます。</div>
<div class="line">Ansible Coreの詳細情報については、Ansible Coreのマニュアルを参照してください。</div>
</div>
</section>
<section id="ansible-automation-controller">
<h3>Ansible Automation Controllerについて<a class="headerlink" href="#ansible-automation-controller" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible Automation Controllerとは、PF構築自動化ツールであるAnsibleにアクセスコントロール、ジョブスケジューリング、タスクの可視化などの機能を拡張した管理プラットフォームです。</div>
<div class="line">“プロジェクト”、”インベントリ”、”認証情報”の組合せで”ジョブテンプレート”を作成しAnsibleを実行できます。</div>
<div class="line">複数の“ジョブテンプレート”を組み合せて”ワークフロージョブテンプレート”を作成することによって、より多彩な作業フローを表現することができます。</div>
<div class="line">Ansible Automation Controllerの詳細情報については、Ansible Automation Controllerのマニュアルを参照してください。</div>
<div class="line">ITAで対応可能なAnsible Automation Controllerのバージョンは、 <a class="reference internal" href="architecture.html"><span class="doc">目次</span></a> を参照してください。</div>
<div class="line">最新のバージョンに対応した記法は使えないことがありますので、ご注意ください。</div>
</div>
</section>
<section id="id3">
<h3>Ansible driverについて<a class="headerlink" href="#id3" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible driverは、ITAシステムのオプションとして機能し、ITAシステムで登録した構築対象のサーバ・ストレージ・ネットワーク各機器に対し、Ansible Core、Ansible Automation Controllerのどちらを経由するかを選択し、実際の運用設定を自動的に行います。</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image41.png"><img alt="Exastro概要" class="align-center" src="../../../_images/image41.png" style="width: 6.68819in; height: 3.35972in;" /></a>
<div class="line-block">
<div class="line">Ansible driverには以下のモードを用意しています。</div>
</div>
<ul>
<li><div class="line-block">
<div class="line"><strong>Legacy Role モード</strong></div>
<div class="line">Ansible標準の機能を用いて各種ホストへ設定を投入します。</div>
<div class="line">構築コードをパッケージとして登録し、作業パターンをRoleの組み合わせで構成します。</div>
<div class="line">製品部門などが提供するRoleパッケージを用いて、製品のインストール、環境構築などを行う際に使われることを想定します。</div>
</div>
</li>
</ul>
<div class="line-block">
<div class="line">また、Ansible driverは、Playbook中の変数を画面から設定することができます。詳細は本書「 <a class="reference internal" href="#general-operations-variable-handling-in-ansible-driver"><span class="std std-ref">Ansible driverでの変数取り扱い</span></a> 」をご参照ください。</div>
</div>
</section>
</section>
<section id="general-operations-variable-handling-in-ansible-driver">
<span id="id4"></span><h2><span class="section-number">1.3. </span>Ansible driverでの変数取り扱い<a class="headerlink" href="#general-operations-variable-handling-in-ansible-driver" title="この見出しへのパーマリンク">¶</a></h2>
<section id="id5">
<h3>変数の種類<a class="headerlink" href="#id5" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible driverでは、Playbook中の変数の具体値をITAの設定画面から設定することができます。</div>
<div class="line"><strong>※設定方法の詳細は、本書「</strong> <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> <strong>」を参照してください。</strong></div>
<div class="line">Playbook中の変数で、ITAの変数として扱える変数は以下の8種類があります。</div>
</div>
</section>
<section id="id6">
<h3>通常変数<a class="headerlink" href="#id6" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id7">
<h4>概要<a class="headerlink" href="#id7" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">変数名に対して具体値を1つ定義できる変数です。</div>
</div>
</section>
<section id="playbook">
<h4>playbookにおける表記<a class="headerlink" href="#playbook" title="この見出しへのパーマリンク">¶</a></h4>
<section id="id8">
<h5>書式<a class="headerlink" href="#id8" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">変数を使用する際、playbook内の変数を以下とする。</div>
<div class="line">※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">VAR_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>
<span class="c1">#xxx: 半角英数字とアンダースコア（ _ ）</span>
</pre></div>
</div>
</section>
<section id="id9">
<h5>正しい記述例<a class="headerlink" href="#id9" title="この見出しへのパーマリンク">¶</a></h5>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_users</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ファイル内容確認</span>
<span class="w">  </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{ VAR_SAMPLE }}</span>
</pre></div>
</div>
</section>
<section id="wrong-description-example">
<span id="id10"></span><h5>誤った記述例<a class="headerlink" href="#wrong-description-example" title="この見出しへのパーマリンク">¶</a></h5>
<ul>
<li><div class="line-block">
<div class="line">&quot;{{&quot;または&quot;}}&quot; と変数名の間に「半角スペース」がない</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{VAR_SAMPLE }}</span>
<span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{ VAR_SAMPLE}}</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">&quot;{{&quot;または&quot;}}&quot; と変数名の間の「半角スペース」が2個以上ある</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{  VAR_SAMPLE }}</span>
<span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{ VAR_SAMPLE  }}</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">接頭文字(VAR_)が小文字になっている</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{ var_SAMPLE }}</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">接頭文字(VAR_)の「_」がない</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{ VARSAMPLE }}</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">変数名が129文字以上ある</div>
</div>
</li>
</ul>
<div class="line-block">
<div class="line">ルールに準拠しない記述をした場合、<span class="menuselection">代入値管理</span> 機能に下記の影響を及ぼします。</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">登録の場合</div>
<div class="line">Movementを選択しても変数名に候補として表示しません。</div>
<div class="line">作業実行時に変数未定義のエラーとなります。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">更新の場合 (代入値管理登録後にITA追加ルール外の記載のplaybookに更新した場合)</div>
<div class="line">変数名に「ID変換失敗(n)」(※nは登録時の管理番号)と表示します。</div>
<div class="line">作業実行時に変数未定義のエラーとなります。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">エラーの例(実行ログ)</div>
<div class="line"><strong class="command">&quot;msg&quot;: &quot;The task includes an option with an undefined variable. The error was: 'VAR_PAUSE_time' is undefined</strong></div>
</div>
</li>
</ul>
</section>
</section>
</section>
<section id="id11">
<h3>複数具体値変数<a class="headerlink" href="#id11" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id12">
<h4>概要<a class="headerlink" href="#id12" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">変数名に対して具体値を複数定義できる変数です。</div>
</div>
</section>
<section id="id13">
<h4>playbookにおける表記<a class="headerlink" href="#id13" title="この見出しへのパーマリンク">¶</a></h4>
<section id="id14">
<h5>書式<a class="headerlink" href="#id14" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">変数を使用する際、playbook内の変数を以下とする。</div>
<div class="line">※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">VAR_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>
<span class="c1">#xxx: 半角英数字とアンダースコア（ _ ）</span>
</pre></div>
</div>
</section>
<section id="id15">
<h5>正しい記述例<a class="headerlink" href="#id15" title="この見出しへのパーマリンク">¶</a></h5>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_users</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
</pre></div>
</div>
</section>
<section id="id16">
<h5>誤った記述例<a class="headerlink" href="#id16" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">通常変数の <a class="reference internal" href="#wrong-description-example"><span class="std std-ref">誤った記述例</span></a> を参照して下さい。</div>
</div>
</section>
</section>
</section>
<section id="id17">
<h3>多段変数<a class="headerlink" href="#id17" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id18">
<h4>概要<a class="headerlink" href="#id18" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">階層化された変数です。</div>
</div>
</section>
<section id="id19">
<h4>playbookにおける表記<a class="headerlink" href="#id19" title="この見出しへのパーマリンク">¶</a></h4>
<section id="id20">
<h5>書式<a class="headerlink" href="#id20" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">変数を使用する際、playbook内の変数を以下とする。</div>
<div class="line">※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">VAR_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>
<span class="c1">#xxx: 半角英数字とアンダースコア（ _ ）</span>
</pre></div>
</div>
</section>
<section id="id21">
<h5>正しい記述例<a class="headerlink" href="#id21" title="この見出しへのパーマリンク">¶</a></h5>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_users</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">user-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alice</span>
<span class="w">      </span><span class="nt">authorized</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">メンバー変数名は、下記の7文字を除くascii文字(0x20～0x7e)が使用出来ます。</div>
<div class="line">&quot; . [ ] ' \ :</div>
<div class="line">尚、コーテーションで囲まないと変数名の先頭に使用出来ない文字がいくつかあります。</div>
<div class="line">詳しくは、Ansibleドキュメント <a class="reference external" href="https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html">Yaml syntax</a> を参照下さい。</div>
</div>
</section>
<section id="id22">
<h5>誤った記述例<a class="headerlink" href="#id22" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">通常変数の <a class="reference internal" href="#wrong-description-example"><span class="std std-ref">誤った記述例</span></a> を参照して下さい。</div>
</div>
</section>
</section>
</section>
<section id="id23">
<h3>グローバル変数<a class="headerlink" href="#id23" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id24">
<h4>概要<a class="headerlink" href="#id24" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line"><span class="menuselection">グローバル変数</span> メニューから登録された変数です。</div>
<div class="line">ITAWebUI上のグローバル変数管理メニューでグローバル変数を登録する際、</div>
<div class="line">グローバル変数名の接頭文字をGBL_とし、GBL_を含め128Byte以内とする。</div>
</div>
</section>
<section id="id25">
<h4>playbookにおける表記<a class="headerlink" href="#id25" title="この見出しへのパーマリンク">¶</a></h4>
<section id="id26">
<h5>書式<a class="headerlink" href="#id26" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">変数を使用する際、playbook内の変数を以下とする。</div>
<div class="line">※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">GBL_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>
<span class="c1">#xxx: 半角英数字とアンダースコア（ _ ）</span>
</pre></div>
</div>
</section>
<section id="id27">
<h5>正しい記述例<a class="headerlink" href="#id27" title="この見出しへのパーマリンク">¶</a></h5>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ファイル内容確認</span>
<span class="w">  </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{ GBL_SAMPLE }}</span>
</pre></div>
</div>
</section>
<section id="id28">
<h5>誤った記述例<a class="headerlink" href="#id28" title="この見出しへのパーマリンク">¶</a></h5>
<ul>
<li><div class="line-block">
<div class="line">接頭文字(GBL_)が小文字になっている</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{ gbl_SAMPLE }}</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">接頭文字(GBL_)の「_」がない</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{ GBLSAMPLE }}</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">変数名が129文字以上ある</div>
</div>
</li>
</ul>
<div class="line-block">
<div class="line">ルールに準拠しない記述をした場合、<span class="menuselection">グローバル変数管理</span> 機能に下記の影響を及ぼします。</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">作業実行時にグローバル変数の置換が行われないためエラーとなります。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">エラーの例(実行ログ)</div>
<div class="line"><strong class="command">&quot;msg&quot;: &quot;'gbl_wait_for_delay' is undefined&quot;</strong></div>
</div>
</li>
</ul>
</section>
</section>
</section>
<section id="id29">
<h3>テンプレート埋込変数<a class="headerlink" href="#id29" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id30">
<h4>概要<a class="headerlink" href="#id30" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line"><span class="menuselection">テンプレート管理</span> メニューから登録された変数です。</div>
<div class="line">ITAWebUI上のテンプレート管理メニューでテンプレート素材を登録をする際、</div>
<div class="line">テンプレート埋込変数名の接頭文字をTPF_とし、TPF_を含め256Byte以内とする。</div>
</div>
</section>
<section id="id31">
<h4>playbookにおける表記<a class="headerlink" href="#id31" title="この見出しへのパーマリンク">¶</a></h4>
<section id="id32">
<h5>書式<a class="headerlink" href="#id32" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">変数を使用する際、playbook内の変数を以下とする。</div>
<div class="line">※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">TPF_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>
<span class="c1">#xxx: 半角英数字とアンダースコア（ _ ）</span>
</pre></div>
</div>
</section>
<section id="id33">
<h5>正しい記述例<a class="headerlink" href="#id33" title="この見出しへのパーマリンク">¶</a></h5>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ファイル内容確認</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ TPF_SAMPLE }} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
</section>
<section id="id34">
<h5>誤った記述例<a class="headerlink" href="#id34" title="この見出しへのパーマリンク">¶</a></h5>
<ul>
<li><div class="line-block">
<div class="line">&quot;{{&quot;または&quot;}}&quot; と変数名の間に「半角スペース」がない</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{TPF_SAMPLE }} dest=/tmp/SAMPLE.txt</span>
<span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ TPF_SAMPLE}} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">&quot;{{&quot;または&quot;}}&quot; と変数名の間の「半角スペース」が2個以上ある</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{   TPF_SAMPLE }} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">接頭文字(TPF_)が小文字になっている</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ tpf_SAMPLE }} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">接頭文字(TPF_)の「_」がない</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ TPFSAMPLE }} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">変数名が129文字以上ある</div>
</div>
</li>
</ul>
<div class="line-block">
<div class="line">ルールに準拠しない記述をした場合、<span class="menuselection">テンプレート管理</span> 機能に下記の影響を及ぼします。</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">登録したテンプレート素材への置換が行われません。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">エラーの例(実行ログ)</div>
<div class="line"><strong class="command">&quot;msg&quot;: &quot;'TPFSAMPLE' is undefined&quot;</strong></div>
</div>
</li>
</ul>
</section>
</section>
</section>
<section id="id35">
<h3>ファイル埋込変数<a class="headerlink" href="#id35" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id36">
<h4>概要<a class="headerlink" href="#id36" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line"><span class="menuselection">ファイル管理</span> メニューから登録された変数です。</div>
<div class="line">ITAWebUI上のファイル管理メニューでファイル埋込変数を登録する際、</div>
<div class="line">ファイル埋込変数名の接頭文字をCPF_とし、CPF_を含め256Byte以内とする。</div>
</div>
</section>
<section id="id37">
<h4>playbookにおける表記<a class="headerlink" href="#id37" title="この見出しへのパーマリンク">¶</a></h4>
<section id="id38">
<h5>書式<a class="headerlink" href="#id38" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">変数を使用する際、playbook内の変数を以下とする。</div>
<div class="line">※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">CPF_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>
<span class="c1">#xxx: 半角英数字とアンダースコア（ _ ）</span>
</pre></div>
</div>
</section>
<section id="id39">
<h5>正しい記述例<a class="headerlink" href="#id39" title="この見出しへのパーマリンク">¶</a></h5>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ファイル内容確認</span>
<span class="w">  </span><span class="nt">copy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ CPF_SAMPLE }} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
</section>
<section id="id40">
<h5>誤った記述例<a class="headerlink" href="#id40" title="この見出しへのパーマリンク">¶</a></h5>
<ul>
<li><div class="line-block">
<div class="line">&quot;{{&quot;または&quot;}}&quot; と変数名の間に「半角スペース」がない</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">copy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{CPF_SAMPLE }} dest=/tmp/SAMPLE.txt</span>
<span class="nt">copy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ CPF_SAMPLE}} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">&quot;{{&quot;または&quot;}}&quot; と変数名の間の「半角スペース」が2個以上ある</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">copy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{   CPF_SAMPLE }} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">接頭文字(CPF_)が小文字になっている</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">copy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ cpf_SAMPLE }} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">接頭文字(CPF_)の「_」がない</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">copy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ CPFSAMPLE }} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">変数名が129文字以上ある</div>
</div>
</li>
</ul>
<div class="line-block">
<div class="line">ルールに準拠しない記述をした場合、<span class="menuselection">ファイル管理</span> 機能に下記の影響を及ぼします。</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">作業実行時にファイル埋込変数の置換が行われないためエラーとなります。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">エラーの例(実行ログ)</div>
<div class="line"><strong class="command">Template embedded variable is not registered in the template list. (Role:roles/echo PlayBook:roles/echo/tasks/main.yml line:3 Template embedded variable:TPF_aa)</strong></div>
</div>
</li>
</ul>
</section>
</section>
</section>
<section id="ita">
<h3>ITA独自変数<a class="headerlink" href="#ita" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id41">
<h4>概要<a class="headerlink" href="#id41" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">ITA 独自で定義された変数です。</div>
</div>
</section>
<section id="id42">
<h4>機器一覧<a class="headerlink" href="#id42" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">基本コンソールの機器一覧の下記項目を変数として扱えます。</div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ホスト名</p></td>
<td><p>__loginhostname__</p></td>
</tr>
<tr class="row-odd"><td><p>プロトコル</p></td>
<td><p>__loginprotocol__</p></td>
</tr>
<tr class="row-even"><td><p>ログインユーザID</p></td>
<td><p>__loginuser__</p></td>
</tr>
<tr class="row-odd"><td><p>ログインパスワード</p></td>
<td><p>__loginpassword__</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><strong>変数名の前後の「__」は半角アンダーバー2文字です。</strong></div>
<div class="line">機器一覧については、<a class="reference internal" href="../it_automation_base/basic_console.html"><span class="doc">基本コンソール</span></a> を参照してください。</div>
</div>
</section>
<section id="id43">
<h4>オペレーション<a class="headerlink" href="#id43" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">作業実行時のオペレーションを変数として扱えます。</div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>オペレーション</p></td>
<td><p>__operation__</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">設定値 : 実施予定日時「YYYY/MM/DD HH:MM」_オペレーションID:オペレーション名称</div>
</div>
</section>
<section id="id44">
<h4>データ連携<a class="headerlink" href="#id44" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">作業実行時のディレクトリパスを下記の変数として扱えます。</div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>作業ディレクトリパス</p></td>
<td><p>__workflowdir__</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">Playbook内で作業ディレクトリパス配下にファイルを作成することで、「<em>作業実行</em>」の結果データでファイルをダウンロードすることができます。</div>
<div class="line">Conductor実行時の各Movementで共有するディレクトリパスを下記の変数として扱えます。</div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Conductor</p>
<p>作業ディレクトリパス</p>
</td>
<td><p>__conductor_workflowdir__</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">Playbook内でConductor作業ディレクトリパス配下にファイルを作成することで、各Movement間でファイルを共有することが出来ます。また、ansible driverの作業実行から実行した場合は__workflowdir__と同じパスが設定されます。</div>
</div>
<div class="line-block">
<div class="line">Conductorの「Status file branch」ノードで参照するステータスファイルのファイルパスを下記の変数として扱えます。</div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ステータスファイルパス</p></td>
<td><p>__movement_status_filepath__</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">Playbook内で作業ディレクトリパス配下にステータスファイルを作成することでができます。</div>
</div>
<div class="line-block">
<div class="line">収集機能の各ファイルパスを下記の変数として扱えます。</div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>作業ディレクトリ（in）の「_parameters」のパス</p></td>
<td><p>__parameters_dir_for_epc__</p></td>
</tr>
<tr class="row-odd"><td><p>作業ディレクトリ（in）の「_parameters_file」のパス</p></td>
<td><p>__parameters_file_dir_for_epc__</p></td>
</tr>
<tr class="row-even"><td><p>作業結果ディレクトリ（out）の「_parameters」のパス</p></td>
<td><p>__parameter_dir__</p></td>
</tr>
<tr class="row-odd"><td><p>作業結果ディレクトリ（out）の「_parameters_file」のパス</p></td>
<td><p>__parameters_file_dir__</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">「_parameters」：ソースファイル（パラメータ）格納先用</div>
<div class="line">「_parameters_file」：収集したファイルの格納先用</div>
</div>
</section>
</section>
<section id="id45">
<h3>読替変数<a class="headerlink" href="#id45" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id46">
<h4>概要<a class="headerlink" href="#id46" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">Defaults変数定義ファイルまたはITA readmeに定義されている「VAR_×××」形式以外の変数をITAで扱う場合の変数「LCA_×××」です。</div>
<div class="line">詳細は「 <a class="reference internal" href="#general-operations-write-translation-table-ansible-legacy-role-only"><span class="std std-ref">読替表（Ansible-Legacy Role）の記述</span></a> 」を参照して下さい。</div>
</div>
</section>
</section>
<section id="id47">
<h3>変数の抜出および具体値登録<a class="headerlink" href="#id47" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">ITAにアップロードしたPlaybook等の資材から変数を抜出し、各メニューから具体値を登録できます。各メニューから登録した変数の具体値は、作業実行時にホスト変数ファイルに出力されます。</div>
<div class="line">変数の抜出方法は以下のとおりです。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>Ansible-Legacy Role</strong></div>
<div class="line">「ロールパッケージ管理 (本書： <a class="reference internal" href="#general-operations-role-package-list-ansible-legacy-role-only"><span class="std std-ref">ロールパッケージ管理</span></a> )」でアップロードしたロールパッケージ内のdefaults変数定義ファイルより変数定義の抜出を行います。</div>
<div class="line">詳しくは「ロールパッケージの記述(本書： <a class="reference internal" href="#general-operations-role-package-list-ansible-legacy-role-only"><span class="std std-ref">ロールパッケージ管理</span></a> )」を参照してください。</div>
<div class="line">また、読替表を作成することでdefaults変数定義ファイルまたはITA readmeに定義されている「VAR_xxx」以外の変数をITAで扱うことが出来ます。詳しくは「 <a class="reference internal" href="#general-operations-write-translation-table-ansible-legacy-role-only"><span class="std std-ref">読替表（Ansible-Legacy Role）の記述</span></a> 」を参照して下さい。</div>
<div class="line">また、アップロードしたロールパッケージ内のplaybookより、以下の書式の変数定義を抜出します。</div>
</div>
<table class="docutils align-left" id="id97">
<caption><span class="caption-text">変数の抜出および具体値登録（Ansible-Legacy Role）</span><a class="headerlink" href="#id97" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 11.1%" />
<col style="width: 22.2%" />
<col style="width: 11.1%" />
<col style="width: 11.1%" />
<col style="width: 44.4%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>変数名</p></th>
<th class="head" rowspan="2"><p>書式</p></th>
<th class="head" colspan="2"><p>ロールパッケージ内のディレクトリ</p></th>
<th class="head" rowspan="2"><p>具体値の設定</p></th>
</tr>
<tr class="row-even"><th class="head"><p><strong>tasks</strong></p>
<p><strong>templates</strong></p>
<p><strong>handlers</strong></p>
<p><strong>meta</strong></p>
</th>
<th class="head"><p><strong>その他</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>グローバル変数</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">GBL_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>

<span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">GBL_xxx | フィルタ</span><span class="w"> </span><span class="p p-Indicator">}}</span>
</pre></div>
</div>
</td>
<td rowspan="3"><p><strong>○</strong></p></td>
<td rowspan="3"><p><strong>×</strong></p></td>
<td><p>具体値の登録は「 <a class="reference internal" href="#general-operations-global-variable-list"><span class="std std-ref">グローバル変数管理</span></a> 」メニューより行います。</p></td>
</tr>
<tr class="row-even"><td><p>テンプレート埋込変数</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">TPF_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>

<span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">TPF_xxx | フィルタ</span><span class="w"> </span><span class="p p-Indicator">}}</span>
</pre></div>
</div>
</td>
<td><p>具体値の登録は「<a class="reference internal" href="#general-operations-template-list"><span class="std std-ref">テンプレート管理</span></a>」メニューより行います。</p></td>
</tr>
<tr class="row-odd"><td><p>ファイル埋込変数</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">CPF_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>

<span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">CPF_xxx | フィルタ</span><span class="w"> </span><span class="p p-Indicator">}}</span>
</pre></div>
</div>
</td>
<td><p>具体値の登録は「<a class="reference internal" href="#general-operations-file-list"><span class="std std-ref">ファイル管理</span></a>」メニューより行います。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">※ 〇：変数定義抜出対象のplaybook　 ×：変数定義抜出対象外のplaybook</div>
</div>
</li>
</ol>
</section>
<section id="id48">
<h3>代入値登録による変数の扱い<a class="headerlink" href="#id48" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Playbookで定義した変数の値は代入値登録機能により上書きすることができます。</div>
<div class="line">Playbook中の変数と、代入値管理機能で登録した変数の値の関係を、以下の図に示します。</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image_2a_1.png"><img alt="../../../_images/image_2a_1.png" class="align-center" src="../../../_images/image_2a_1.png" style="width: 6.68819in; height: 3.35972in;" /></a>
<div class="line-block">
<div class="line">代入値管理機能で登録した変数の値は、各ホスト用に変数定義ファイル(host_vars)に出力され、Ansibleで元のPlaybookと変数定義用ファイルを入力として各ホストに実行されます。</div>
</div>
<div class="line-block">
<div class="line">この結果、変数の値の優先順位は以下のようになります。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">代入値管理機能で登録した値</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Playbook中の変数に指定した値</div>
<div class="line">詳細は 「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」を参照してください。</div>
</div>
</li>
</ol>
</section>
</section>
<section id="id49">
<h2><span class="section-number">1.4. </span>Ansible driver コンソールメニュー構成<a class="headerlink" href="#id49" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本章では、ITAコンソールのメニュー構成について説明します。</div>
</div>
<section id="id50">
<h3>メニュー/画面一覧<a class="headerlink" href="#id50" title="この見出しへのパーマリンク">¶</a></h3>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>ITA 基本コンソールのメニュー</strong></div>
<div class="line">Ansible driverで利用するITA基本コンソールのメニュー一覧を以下に記述します。</div>
</div>
<table class="docutils align-left" id="id98">
<caption><span class="caption-text">基本コンソール メニュー/画面一覧</span><a class="headerlink" href="#id98" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 5.9%" />
<col style="width: 17.6%" />
<col style="width: 23.5%" />
<col style="width: 52.9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>No</strong></p></th>
<th class="head"><p><strong>メニューグループ</strong></p></th>
<th class="head"><p><strong>メニュー・画面</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>基本コンソール</p></td>
<td><p>オペレーション一覧</p></td>
<td><p>オペレーション一覧をメンテナンス(閲覧/登録/更新/廃止)できます</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line"><strong>Ansible共通コンソールのメニュー</strong></div>
<div class="line">Ansible共通コンソールのメニュー一覧を以下に記述します。</div>
</div>
<table class="docutils align-left" id="id99">
<caption><span class="caption-text">共通コンソール メニュー/画面一覧</span><a class="headerlink" href="#id99" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 5.9%" />
<col style="width: 17.6%" />
<col style="width: 17.6%" />
<col style="width: 58.8%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>No</strong></p></th>
<th class="head"><p><strong>メニューグループ</strong></p></th>
<th class="head"><p><strong>メニュー・画面</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td rowspan="8"><p>Ansible共通コンソール</p></td>
<td><p>機器一覧</p></td>
<td><p>作業対象ホストの情報をメンテナンス(閲覧/登録/更新/廃止)できます。</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>インターフェース情報</p></td>
<td><p>Ansible Core、Ansible Automation Controllerサーバのどちらを実行エンジンとし構築作業をするか選択をします。</p>
<p>ITAシステム・Ansibledriverサーバと実行エンジンのサーバが共有するディレクトリのパスおよび、実行エンジンのサーバへの接続インターフェース情報を管理します。</p>
</td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Ansible Automation Controllerホスト一覧</p></td>
<td><p>Ansible Automation ControllerのRestAPI実行に必要な情報、および構築資材をAnsible Automation
Controllerにファイル転送するために必要な情報を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>グローバル変数管理</p></td>
<td><p>Playbookや対話ファイルなどで共通利用する変数（以降、グローバル変数と称す）と具体値を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>ファイル管理</p></td>
<td><p>Playbook内の各モジュールで使用する素材ファイルと埋め込み変数を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>テンプレート管理</p></td>
<td><p>Playbook内のtemplateモジュールでなどで使用するテンプレートファイルと埋め込み変数を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>共通変数利用リスト</p>
<p>※非表示メニュー</p>
</td>
<td><p>テンプレート管理、ファイル管理、グローバル管理に登録されている変数をどの素材(ロール)で使用しているかを閲覧できます。</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>管理対象外変数リスト</p>
<p>※非表示メニュー</p>
</td>
<td><p>ロールパッケージ管理のデフォルト変数定義やテンプレート管理の変数定義で定義している変数で、代入値自動登録の変数一覧に表示したくない変数をメンテナンス(参照/更新/廃止/復活)できます。</p>
<p>変数名は正規表記で記載できます。</p>
<p>(例) ansible_* *:ワイルドカード</p>
<p>ansible_[0-9a-zA-Z_]*</p>
</td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line"><strong>Ansibleコンソールのメニュー</strong></div>
<div class="line">各Ansibleコンソールに対応するメニュー一覧を以下に記述します。</div>
</div>
<table class="docutils align-left" id="id100">
<caption><span class="caption-text">Ansible driverコンソール メニュー/画面一覧</span><a class="headerlink" href="#id100" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>No</strong></p></th>
<th class="head"><p><strong>メニュー・画面</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Movement一覧</p></td>
<td><p>Movementの一覧を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>ロールパッケージ管理</p></td>
<td><p>ロールパッケージを管理します。</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Movement-ロール紐付</p></td>
<td><p>Movementとロールパッケージの関連付けを管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>変数ネスト管理</p></td>
<td><p>多段変数が繰返配列で構成されている場合の最大繰返配列数を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>代入値自動登録設定</p></td>
<td><p>CMDBのメニューに登録されているオぺレーションとホスト毎の項目値を紐付けるMovementと変数を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>作業実行</p></td>
<td><p>作業実行するMovementとオペレーションを選択し実行を指示します。</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>作業状態確認</p></td>
<td><p>作業実行状態を表示します。</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>作業管理</p></td>
<td><p>作業実行履歴を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>作業対象ホスト</p></td>
<td><p>Movementで使用するホストを管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>代入値管理</p></td>
<td><p>変数の代入値を管理します。</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
</section>
<section id="id51">
<h2><span class="section-number">1.5. </span>Ansible driver利用手順<a class="headerlink" href="#id51" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">Ansibleコンソールの利用手順について説明します。</div>
</div>
<section id="ansible-legacyrole">
<h3>Ansible-LegacyRole作業フロー<a class="headerlink" href="#ansible-legacyrole" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">以下は、Ansible-LegacyRoleで作業を実行するまでの流れです。</div>
</div>
<ul>
<li><p><strong>作業フロー詳細と参照先</strong></p>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>機器情報にAnsible利用情報を設定</strong></div>
<div class="line">Ansible共通コンソールの機器一覧の画面から、各機器に対してAnsible利用情報を設定します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-device-list"><span class="std std-ref">機器一覧</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>投入オペレーション名の登録</strong></div>
<div class="line">ITA基本コンソールのオペレーション一覧の画面から、作業用の投入オペレーション名を登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-input-operation-list"><span class="std std-ref">オペレーション一覧</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>インターフェース情報の登録</strong></div>
<div class="line">Ansible共通コンソールのインターフェース情報の画面から、Ansible Core、Ansible Automation Controllerサーバのどちらを実行エンジンにするかを選択し、実行エンジンのサーバへの接続情報を登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-interface-information"><span class="std std-ref">インターフェース情報</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業パターン(Movement)の登録</strong></div>
<div class="line">Ansible-LegacyRoleコンソールのMovement一覧の画面から、作業用のMovementを登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-movement-list"><span class="std std-ref">Movement一覧</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>ロールパッケージの登録</strong></div>
<div class="line">Ansible-LegacyRoleコンソールのロールパッケージ管理の画面から、作業で使用するロールパッケージを登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-role-package-list-ansible-legacy-role-only"><span class="std std-ref">ロールパッケージ管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>グローバル変数の登録（必要に応じて実施）</strong></div>
<div class="line">Ansible共通コンソールのグローバル変数管理の画面から、Playbookで使用するグローバル変数を登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-global-variable-list"><span class="std std-ref">グローバル変数管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>素材ファイルの登録（必要に応じて実施）</strong></div>
<div class="line">Ansible共通コンソールのファイル管理の画面から、作業対象サーバに配置するファイルを登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-file-list"><span class="std std-ref">ファイル管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>テンプレートファイルの登録（必要に応じて実施）</strong></div>
<div class="line">Ansible共通コンソールのテンプレート管理の画面から、ロールパッケージのtemplateモジュールなどで使用しているテンプレートファイル(src: で指定する素材)とテンプレート埋込変数を登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-template-list"><span class="std std-ref">テンプレート管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>管理対象外変数の登録（必要に応じて実施）</strong></div>
<div class="line">Ansible共通コンソールの管理対象外変数リストの画面から、ロールパッケージ管理のデフォルト変数定義やテンプレート管理の変数定義で定義している変数で、代入値自動登録の変数一覧に表示したくない変数を登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-unmanaged-var-list"><span class="std std-ref">管理対象外変数リスト</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>Movementにロールパッケージを指定</strong></div>
<div class="line">Ansible-LegacyRoleコンソールのMovement-ロール紐付の画面から、登録したMovementにロールパッケージを指定します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-movement-details"><span class="std std-ref">Movement-ロール紐付</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>多段変数の最大繰返数を指定（必要に応じて実施）</strong></div>
<div class="line">Ansible-LegacyRoleコンソールの多段変数最大繰返管理の画面から、多段変数で配列定義されているメンバー変数の配列の最大繰返数を指定します。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-nested-variable-list-ansible-legacy-role-only"><span class="std std-ref">変数ネスト管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>パラメータシートの作成</strong></div>
<div class="line">メニュー作成コンソールのメニュー作成・定義の画面から、作業対象サーバの設定に使用するデータを登録するためのメニューを作成します。</div>
<div class="line">詳細は <a class="reference internal" href="../create_param/menu_creation.html"><span class="doc">メニュー作成機能</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>パラメータシートにデータを登録</strong></div>
<div class="line">入力用コンソールの前項で作成したパラメータシート画面から、作業対象サーバの設定に使用するデータを登録します。</div>
<div class="line">詳細は <a class="reference internal" href="../create_param/menu_creation.html"><span class="doc">メニュー作成機能</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>代入値自動登録設定</strong></div>
<div class="line">Ansible-LegacyRoleコンソールの代入値自動登録設定の画面から、パラメータシートに登録されているオペレーションとホスト毎の項目の設定値と、Movementの変数を紐付けます。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業実行</strong></div>
<div class="line">Ansible-LegacyRoleコンソールの作業実行の画面から、Movementと投入オペレーションを選択して処理の実行を行います。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-execution"><span class="std std-ref">作業実行</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業状態確認</strong></div>
<div class="line">Ansible-LegacyRoleコンソールの作業状態確認の画面から、実行した作業の状態がリアルタイムで表示されます。また、作業の緊急停止や、実行ログ、エラーログを監視することができます。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業履歴確認</strong></div>
<div class="line">Ansible-LegacyRoleコンソールの作業管理の画面から、実行した作業の一覧が表示され履歴が確認できます。</div>
<div class="line">詳細は <a class="reference internal" href="#general-operations-execution-list"><span class="std std-ref">作業管理</span></a> を参照してください。</div>
</div>
</li>
</ol>
</li>
</ul>
</section>
</section>
<section id="id52">
<h2><span class="section-number">1.6. </span>Ansible driver機能・操作方法説明<a class="headerlink" href="#id52" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本章では、Ansible driverで利用する各コンソールの機能について説明します。</div>
<div class="line">本章に記載の登録画面項目一覧表の内容について説明します。</div>
</div>
<table class="docutils align-left" id="id101">
<caption><span class="caption-text">登録画面項目一覧凡例</span><a class="headerlink" href="#id101" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目…①</strong></p></th>
<th class="head"><p><strong>説明…②</strong></p></th>
<th class="head"><p><strong>入力必須…③</strong></p></th>
<th class="head"><p><strong>入力形式…④</strong></p></th>
<th class="head"><p><strong>制約事項…⑤</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>項目</strong></div>
<div class="line">サブメニュー内の項目名です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>説明</strong></div>
<div class="line">項目に対する説明です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>入力必須</strong></div>
<div class="line">○：項目に対する内容の入力が必須の項目です。</div>
<div class="line">‐ ：項目に対する内容の入力が任意の項目です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>入力形式</strong></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">手動入力：手動での入力が必要な項目です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">自動入力：自動で内容が入力される項目です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">チェックボックス：チェックボックス形式の項目です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">ボタン：ラジオボタン形式の項目です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">リスト選択：リストボックス形式の項目です。</div>
</div>
</li>
</ul>
</li>
<li><div class="line-block">
<div class="line"><strong>制約事項</strong></div>
<div class="line">項目に対する制約事項(文字数制限など)です。</div>
</div>
</li>
</ol>
<section id="id53">
<h3>基本コンソール<a class="headerlink" href="#id53" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">本節では、ITA基本コンソールでの操作について記載します。</div>
</div>
<div class="line-block">
<div class="line">本作業は <a class="reference internal" href="../it_automation_base/basic_console.html"><span class="doc">基本コンソール</span></a> を参照して、ITA基本コンソール画面内で作業を実施してください。</div>
</div>
<section id="general-operations-input-operation-list">
<span id="id54"></span><h4>オペレーション一覧<a class="headerlink" href="#general-operations-input-operation-list" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line"><span class="menuselection">基本コンソール‣オペレーション一覧</span> では、オーケストレータで実行する作業対象ホストに対するオペレーションを管理します。作業はITA基本コンソール内メニューより選択します。</div>
<div class="line">登録方法の詳細は、関連マニュアルの <a class="reference internal" href="../it_automation_base/basic_console.html"><span class="doc">基本コンソール</span></a> をご参照下さい。</div>
</div>
<figure class="align-default" id="id102">
<a class="reference internal image-reference" href="../../../_images/submenu_screen_operation_list.png"><img alt="サブメニュー画面（オペレーション一覧）" src="../../../_images/submenu_screen_operation_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（オペレーション一覧）</span><a class="headerlink" href="#id102" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="ansible">
<h3>Ansible共通コンソール<a class="headerlink" href="#ansible" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">本節では、Ansible共通コンソールでの操作について記載します。</div>
</div>
<section id="general-operations-device-list">
<span id="id55"></span><h4>機器一覧<a class="headerlink" href="#general-operations-device-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible共通‣機器一覧</span> では、作業対象ホストの情報のメンテナンス(閲覧/登録/更新/廃止)を行います。</div>
</div>
<figure class="align-default" id="id103">
<a class="reference internal image-reference" href="../../../_images/submenu_screen_device_list.png"><img alt="サブメニュー画面（機器一覧）" src="../../../_images/submenu_screen_device_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（機器一覧）</span><a class="headerlink" href="#id103" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel"> 登録</span> ボタンより、機器情報の登録を行います。</div>
</div>
<figure class="align-default" id="id104">
<a class="reference internal image-reference" href="../../../_images/registration_screen_device_list.gif"><img alt="登録画面（機器一覧）" src="../../../_images/registration_screen_device_list.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（機器一覧）</span><a class="headerlink" href="#id104" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の共通項目一覧は以下のとおりです。</div>
</div>
<div class="line-block">
<div class="line">Ansible driverを利用する場合には、Ansible利用情報を入力して下さい。</div>
<div class="line">未入力で作業実行した場合、想定外エラーとなる場合があります。</div>
</div>
<table class="docutils align-left" id="id105">
<caption><span class="caption-text">登録画面項目一覧（機器一覧）</span><a class="headerlink" href="#id105" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 9.3%" />
<col style="width: 9.3%" />
<col style="width: 9.3%" />
<col style="width: 9.3%" />
<col style="width: 20.9%" />
<col style="width: 14.0%" />
<col style="width: 14.0%" />
<col style="width: 14.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="4"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力必須</strong></p></th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="4"><p>管理システム項番</p></td>
<td><p>登録情報を識別する一意のIDが自動入力されます。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="4"><p>HW機器種別</p></td>
<td><p>{{#:1 こちらに入る説明の記入をお願い致します。}}</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td colspan="4"><p>ホスト名</p></td>
<td><p>ホスト名を記入します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="4"><p>DNSホスト名</p></td>
<td><p>{{#:1 こちらに入る説明の記入をお願い致します。}}</p></td>
<td></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-even"><td colspan="4"><p>IPアドレス</p></td>
<td><p>IPアドレス(xxx.xxx.xxx.xxx形式)を記入します。</p></td>
<td></td>
<td><p>手動入力</p></td>
<td><p>最大長15バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2" rowspan="2"><p>ログインパスワード</p></td>
<td colspan="2"><p>ユーザ</p></td>
<td><p>ログインユーザを記入します。</p></td>
<td></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>パスワード</p></td>
<td><p>パスワードを指定します。</p></td>
<td></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2" rowspan="2"><p>ssh鍵認証情報</p></td>
<td colspan="2"><p>ssh秘密鍵ファイル</p></td>
<td><p>ssh秘密鍵ファイルを指定して鍵認証する場合の秘密鍵ファイルを入力します。アップロードしたファイルは暗号化されて保存されます。</p>
<p>※登録後はダウンロード不可となります。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>ファイル選択</p></td>
<td><p>最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>パスフレーズ</p></td>
<td><p>ssh秘密鍵ファイルにパスフレーズが設定されている場合、パスフレーズを入力します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-odd"><td rowspan="7"><p>Ansible利用情報</p></td>
<td rowspan="3"><p>Legacy/Role利用情報</p></td>
<td colspan="2"><p>認証方式</p></td>
<td><p>Ansible・Ansible Automation Controller から機器へ接続する際の認証方式を選択します。</p>
<p>●パスワード認証</p>
<p>ログインパスワードの管理で●の選択と、ログインパスワードの入力が必須です。</p>
<p>●鍵認証（パスフレーズなし）</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードが必須です。</p>
<p>●鍵認証（パスフレーズあり）</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードと、パスフレーズの入力が必須です。</p>
<p>●鍵認証（鍵交換済み）※1</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードは必要ありません。</p>
<p>●パスワード認証（winrm)</p>
<p>必要に応じてWinRM接続情報を入力します。</p>
<p>尚、パスワード認証（winrm)以外の認証方式の場合、機器側に以下の設定が必要です。</p>
<p>ログインユーザの sudo権限を NOPASSWD付で <code class="file docutils literal notranslate"><span class="pre">/etc/sudoers</span></code> に設定します。</p>
<p>Exp)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Demo_user</span> <span class="n">ALL</span><span class="o">=</span><span class="p">(</span><span class="n">ALL</span><span class="p">)</span> <span class="n">NOPASSWD</span><span class="p">:</span><span class="n">ALL</span>
</pre></div>
</div>
</td>
<td></td>
<td><p>リスト選択</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>WinRM接続情報</p></td>
<td><p>ポート番号</p></td>
<td><p>WindowsServerにWinRM接続する際のポート番号を入力します。</p>
<p>未入力の場合はデフォルト(5985)でのWinRM接続となります。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-odd"><td><p>サーバ証明書</p></td>
<td><p>WinRM接続ポートでhttpsのポート番号を指定した場合にサーバﾞ証明書を入力します。</p>
<p>アップロードしたファイルは暗号化されて保存されます。</p>
<p>※登録後はダウンロード不可となります。</p>
<p>サーバ証明書の認証を省く場合、インベントリファイル追加オプションに下記を追記して下さい。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_winrm_server_cert_validation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ignore</span>
</pre></div>
</div>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>ファイル選択</p></td>
<td><p>最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>接続オプション</p></td>
<td><p>（ssh接続の場合）</p>
<p><code class="file docutils literal notranslate"><span class="pre">/etc/ansible.cfg/ssh_args</span></code> に設定しているsshオプション以外のオプションを設定したい場合、設定したいオプションを入力します。</p>
<p>（telnet接続の場合）</p>
<p>telnet接続時のオプションを設定したい場合、設定したいオプションを入力します。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長512バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>インベントリファイル追加オプション</p></td>
<td><p>ITAが設定していないインベントリファイルのオプションパラメータをyaml形式で入力します。</p>
<p>Exp)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network_cli</span>
<span class="nt">ansible_network_os</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ios</span>
<span class="nt">ansible_become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="nt">ansible_become_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enable</span>
</pre></div>
</div>
<p>各パラメータ値を変数で記述することも出来ます。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_become_password</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_passwd</span><span class="nv"> </span><span class="s">}}&#39;</span>
</pre></div>
</div>
<p>具体値に変数を記述する場合</p>
<p>'{{ VAR_passwd }}'</p>
<p>':シングル・ダブルコーテーションで囲む「必須」</p>
<p>変数の具体値は「 <a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」や「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」メニューから登録します。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長512バイト</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>Ansible Automation Controller 利用情報</p></td>
<td colspan="2"><p>インスタンスグループ名※2</p></td>
<td><p>Ansible Automation Controller がクラスタ構成の場合、どのインスタンスグループで実行するかを選択します。ここで設定した、インスタンスグループはインベントリオブジェクトに設定されます。</p>
<p>未選択の場合はAnsible Automation Controller のデフォルトのインスタンスグループになります。</p>
<p>Ansible Automation Controller がクラスタ構成でない場合は、未選択で構いません。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><p>接続タイプ</p></td>
<td><p>Ansible Automation Controller認証情報の接続タイプを設定します。通常はmachineを選択します。</p>
<p>ansible_connectionをlocalに設定する必要があるNetwork OSの場合にNetworkを選択します。</p>
<p>Networkを選択した場合、インベントリファイル追加オプションにPlatform Options(ansible_connection以外)を設定する必要があります。</p>
<p>Exp)</p>
<p>インベントリファイル追加オプションの設定例</p>
<p>Network OSがiosの場合の設定値</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_network_os</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ios</span>
<span class="nt">ansible_become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="nt">ansible_become_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enable</span>
</pre></div>
</div>
<p>Ansible Automation Controllerの認証情報の接続タイプについては、ドキュメント <a class="reference external" href="https://docs.ansible.com/ansible-tower/3.6.4/html_ja/userguide/credentials.html">認証情報タイ
プ</a> を参照して下さい。</p>
<p>Network OSとansible_connectionの関連やPlatform Optionsについては、Ansibleドキュメント <a class="reference external" href="https://docs.ansible.com/ansible/devel/network/user_guide/platform_index.html">Platform Options</a> を参照ください。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td></td>
</tr>
<tr class="row-even"><td colspan="4"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">※1 認証方式が鍵認証（鍵交換済み）に設定する為に必要な公開鍵ファイルの配布</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">Ansible Coreの場合</div>
<div class="line">ansibleがインストールされているサーバーの実行ユーザー「Ansible共通コンソール=&gt;インターフェース情報に設定されている実行ユーザー」から作業対象ホストにssh接続します。</div>
<div class="line">実行ユーザーの公開鍵ファイルをログイン先ユーザーのauthorized_keysにコピーして下さい。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Ansible Automation Controllerの場合</div>
<div class="line">Ansible Automation Controllerのawxユーザーから作業対象ホストにssh接続しています。</div>
<div class="line">awxユーザーの公開鍵ファイルをログイン先ユーザーのauthorized_keysにコピーして下さい。ブラウザよりAnsible Automation Controllerにログインし、「設定」→「ジョブ」→「分離されたジョブに公開するパス」に <code class="file docutils literal notranslate"><span class="pre">/var/lib/awx/.ssh/</span></code> を設定します。</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image8.png"><img alt="../../../_images/image8.png" class="align-center" src="../../../_images/image8.png" style="width: 4.97986in; height: 1.51304in;" /></a>
<div class="line-block">
<div class="line">尚、AnsibleTower4.x以降、awxユーザーの.sshディレクトリが扱えない為、作業対象ホストと鍵認証（鍵交換済み）での接続は出来ません。</div>
</div>
</li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">※2 Ansible driverのバックヤード機能 「Ansible Automation Controllerデータ同期」により取得したデータから選択します。</div>
</div>
</div>
</li>
</ol>
</section>
<section id="general-operations-interface-information">
<span id="id56"></span><h4>インターフェース情報<a class="headerlink" href="#general-operations-interface-information" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible共通‣インターフェース情報</span> では、Ansible Core、AnsibleTower、Ansible Automation Controllerのいずれかを実行エンジンに選択し、ITAシステム・Ansible driverサーバと実行エンジンのサーバが共有するディレクトリのパスのおよび実行エンジンのサーバへの接続インターフェース情報のメンテナンス(閲覧/更新)を行います。</div>
</div>
<figure class="align-default" id="id106">
<a class="reference internal image-reference" href="../../../_images/submenu_screen_interface_information.png"><img alt="サブメニュー画面（インタフェース情報）" src="../../../_images/submenu_screen_interface_information.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（インタフェース情報）</span><a class="headerlink" href="#id106" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">編集</span> ボタンより、インターフェース情報の登録を行います。</div>
</div>
<figure class="align-default" id="id107">
<a class="reference internal image-reference" href="../../../_images/registration_screen_interface_information.gif"><img alt="登録画面（インタフェース情報）" src="../../../_images/registration_screen_interface_information.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（インタフェース情報）</span><a class="headerlink" href="#id107" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">インタフェース情報画面の項目一覧は以下のとおりです。</div>
<div class="line">インタフェース情報が未登録または、複数レコード登録されている状態で作業実行した場合、作業実行は想定外エラーとなります。</div>
</div>
<table class="docutils align-left" id="id108">
<caption><span class="caption-text">登録画面項目一覧（インタフェース情報）</span><a class="headerlink" href="#id108" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 10.8%" />
<col style="width: 10.8%" />
<col style="width: 10.8%" />
<col style="width: 32.4%" />
<col style="width: 10.8%" />
<col style="width: 10.8%" />
<col style="width: 13.5%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力必須</strong></p></th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p>実行エンジン</p></td>
<td><p>実行するエンジンを下記の2種類から選択します。</p>
<p>・Ansible Core</p>
<p>・Ansible Automation Controller</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td></td>
</tr>
<tr class="row-odd"><td rowspan="6"><p>Ansible</p>
<p>Automation</p>
<p>Controller</p>
<p>インターフェース</p>
</td>
<td colspan="2"><p>代表ホスト</p></td>
<td><p>Ansible Automation Controllerホスト一覧に登録されているホストの一覧より、ITAと通信するAnsible Automation Controllerを選択します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td><p>実行エンジンがAnsible Core以外の場合に入力必須</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>プロトコル</p></td>
<td><p>Ansible Automation Controllerサーバとのプロトコルを http / https のどちらかを入力します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>実行エンジンがAnsible Core以外の場合に入力必須</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>ポート</p></td>
<td><p>Ansible Automation Controllerサーバの接続ポート(80/443)を入力します。通常はHTTPS(443)です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>実行エンジンがAnsible Core以外の場合に入力必須</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>組織名</p></td>
<td><p>Ansible Automation Controllerサーバに登録されている組織名を選択します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td><p>実行エンジンがAnsible Core以外の場合に入力必須</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>認証トークン</p></td>
<td><p>ITAからAnsible Automation Controllerサーバに接続するユーザーの認証トークンを入力します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長128バイト</p>
<p>実行エンジンがAnsible Core以外の場合に入力必須</p>
</td>
</tr>
<tr class="row-even"><td colspan="2"><p>実行時データ削除</p></td>
<td><p>作業実行時にITAとAnsible Automation Controller 内に一時的に生成したデータリソースを作業終了後に削除するかを選択します。
「削除する」を選択した場合に削除されるデータリソースは「 <a class="reference internal" href="#general-operations-data-resources-deleted-when-executing"><span class="std std-ref">実行時データ削除で削除されるデータリソース</span></a> 」を参照して下さい。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td><p>実行エンジンがAnsible Core以外の場合に入力必須</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>Proxy</p></td>
<td colspan="2"><p>Adress</p></td>
<td><p>プロキシサーバのアドレスを入力します。</p>
<p>ITAがプロキシ環境下にある場合、Ansible/Ansible Automation Controllerサーバまでの疎通のために設定が必要な場合があります。</p>
<p>プロキシサーバのURLが</p>
<p>http://procy.gate.co.jp:8080の場合</p>
<p>Addressにはhttp://procy.gate.co.jpを入力します。</p>
<p>Portには 8080を入力します。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大128バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>Port</p></td>
<td><p>プロキシサーバのポートを入力します。</p>
<p>ITAがプロキシ環境下にある場合、Ansible/Ansible Automation Controllerサーバまでの疎通のために設定が必要な場合があります。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>Ansible-vaultパスワード</p></td>
<td><p>{{#:1 こちらに入る説明の記入をお願い致します。}}</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長64バイト</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>オプションパラメータ</p></td>
<td><p>Movement共通のオプションパラメータを入力します。</p>
<p>実行エンジンがAnsible Coreの場合はansible-playbookコマンドのオプションパラメータ、実行エンジンがAnsible Core以外の場合はジョブテンプレートのパラメータを入力します。</p>
<p>Movement固有のオプションパラメータはMovement一覧で入力します。</p>
<p>オプションパラメータの詳細については、「 <a class="reference internal" href="#general-operations-option-parameter-list"><span class="std std-ref">オプションパラメータ一覧</span></a> 」を参照してください。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長512バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>NULL連携</p></td>
<td><p>代入値自動登録設定でパラメータシートの具体値がNULL(空白)の場合に、代入値管理への登録をNULL(空白)の値で行うか設定します。</p>
<p>代入値自動登録設定メニューの「NULL連携」が空白の場合この値が適用されます。</p>
<p>・「有効」の場合、パラメータシートの値がどのような値でも代入値管理への登録が行われます。</p>
<p>・「無効」の場合、パラメータシートに値が入っている場合のみ代入値管理への登録が行われます。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td colspan="3"><p>状態監視周期(単位ミリ秒)</p></td>
<td><p>「<a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a>」で表示されるログのリフレッシュ間隔を入力します。通常は3000ミリ秒程度が推奨値です。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最小値1000ミリ秒</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>進行状態表示行数</p></td>
<td><p>「<a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a>」での進行ログ・エラーログの最大表示行数を入力します。</p>
<p>ステータスが[未実行]、[準備中]、[実行中]、[実行中(遅延)]の場合、指定した行数でログを出力します。</p>
<p>ステータスが[完了]、[完了(異常)]、[想定外エラー]、[緊急停止]、[未実行(予約)]、[予約取消]の場合、指定した行数ではなくすべてのログを出力します。</p>
<p>環境毎にチューニングを要しますが、通常は1000行程度が推奨値です。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td colspan="3"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
<section id="id57">
<h4>Ansible Automation Controller ホスト一覧<a class="headerlink" href="#id57" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible共通‣Ansible Automation Controller ホスト一覧</span> では、Ansible Automation ControllerのRestAPI実行に必要な情報、および構築資材をAnsible Automation Controllerにファイル転送するために必要な情報のメンテナンス(閲覧/登録/更新/廃止)を行います。</div>
<div class="line">クラスタ構成の場合は、構成している全てのサーバを登録して下さい。</div>
<div class="line">ただし、Ansible Automation Controllerのhop nodeの登録は不要です。</div>
</div>
<figure class="align-default" id="id109">
<a class="reference internal image-reference" href="../../../_images/submenu_screen_ansible_automation_controller_host_list.png"><img alt="サブメニュー画面（Ansible Automation Controller ホスト一覧）" src="../../../_images/submenu_screen_ansible_automation_controller_host_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（Ansible Automation Controller ホスト一覧）</span><a class="headerlink" href="#id109" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel"> 登録</span> ボタンより、Ansible Automation Controllerのホスト情報の登録を行います。</div>
</div>
<figure class="align-default" id="id110">
<a class="reference internal image-reference" href="../../../_images/registration_screen_ansible_automation_controller_host_list.gif"><img alt="登録画面（Ansible Automation Controller ホスト一覧）" src="../../../_images/registration_screen_ansible_automation_controller_host_list.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（Ansible Automation Controller ホスト一覧）</span><a class="headerlink" href="#id110" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">Ansible Automation Controller ホスト一覧画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id111">
<caption><span class="caption-text">登録画面項目一覧（Ansible Automation Controller ホスト一覧）</span><a class="headerlink" href="#id111" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><p>ホスト</p></td>
<td><p>Ansible Automation Controllerサーバのホスト名（またはIPアドレス）を入力します。</p>
<p>HTTPS通信の場合はホスト名が推奨です。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長128バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>認証方式</p></td>
<td><p>Ansible Automation Controllerサーバへファイル転送(scp)で接続する
際の認証方式を選択します。</p>
<p>●パスワード認証</p>
<p>ログインユーザとパスワードの入力が必須です。</p>
<p>●鍵認証（パスフレーズなし）</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードが必須です。</p>
<p>●鍵認証（パスフレーズあり）</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードと、パスフレーズの入力が必須です。</p>
<p>●鍵認証（鍵交換済み）※</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードは必要ありません。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長30バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>ユーザー</p></td>
<td><p>Ansible Automation Controllerサーバへファイル転送(scp)で接続する際のログインユーザを入力します。</p>
<p>ログインユーザは、Ansible Automation Controllerインストール時に生成されるawxユーザーにパスワードを設定し、使用することを強く推奨します。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長30バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>パスワード</p></td>
<td><p>認証方式でパスワード認証を選択した場合に必須入力となります。
ログインユーザのパスワードを指定します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長30バイト</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>ssh鍵認証情報</p></td>
<td><p>ssh秘密鍵ファイル</p></td>
<td><p>ssh秘密鍵ファイルを指定して鍵認証する場合の秘密鍵ファイルを入力します。
アップロードしたファイルは暗号化されて保存されます。※登録後はダウンロード不可となります。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>ファイル選択</p></td>
<td><p>最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-odd"><td><p>パスフレーズ</p></td>
<td><p>ssh秘密鍵ファイルにパスフレーズが設定されている場合、パスフレーズを入力します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>isolatedTower</p></td>
<td><p>クラスタ構成で構築されている場合で、対象ノードがAnsibleTowerのisolatednode/Ansible Automation Controllerのexecution node の場合、「●」を選択します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>選択方式</p></td>
<td></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">※ 認証方式が鍵認証（鍵交換済み）に設定する為に必要な公開鍵ファイルの配布</div>
<div class="line">ITAがインストールされているサーバーのrootからAnsible Automation Controllerのawxユーザーでssh接続します。</div>
<div class="line">rootの公開鍵ファイルをAnsible Automation Controllerのawxユーザーのauthorized_keysにコピーして下さい。</div>
</div>
</div>
</li>
</ol>
</section>
<section id="general-operations-global-variable-list">
<span id="id58"></span><h4>グローバル変数管理<a class="headerlink" href="#general-operations-global-variable-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible共通‣グローバル変数管理</span> では、Playbookで利用するグローバル変数名のメンテナンス(閲覧/登録/更新/廃止)を行います。</div>
</div>
<figure class="align-default" id="id112">
<a class="reference internal image-reference" href="../../../_images/submenu_screen_global_variable_list.png"><img alt="サブメニュー画面（グローバル変数管理）" src="../../../_images/submenu_screen_global_variable_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（グローバル変数管理）</span><a class="headerlink" href="#id112" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel"> 登録</span> ボタンより、グローバル変数管理情報の登録を行います。</div>
</div>
<figure class="align-default" id="id113">
<a class="reference internal image-reference" href="../../../_images/registration_screen_global_variable_list.gif"><img alt="登録画面（グローバル変数管理）" src="../../../_images/registration_screen_global_variable_list.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（グローバル変数管理）</span><a class="headerlink" href="#id113" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">グローバル変数管理画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id114">
<caption><span class="caption-text">登録画面項目一覧（グローバル変数管理）</span><a class="headerlink" href="#id114" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>グローバル変数名</p></td>
<td><p>変数名を入力します。</p>
<p>変数名は、「GBL_****」形式で入力します。</p>
<p>****
：半角英数字とアンダースコア（
_
）が利用可能です。(最小値:1バイト、最大値:128バイト)</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-odd"><td><p>具体値</p></td>
<td><p>具体値を入力します。複数行の具体値も入力できますが、Pioneerの対話ファイルで使用しているグローバル変数で複数行の具体値を設定すると、作業実行時にエラーとなります。</p>
<p>具体値にファイル埋込変数「CPF_」とテンプレート埋込変数「TPF_」が入力出来ます。変数を記述する場合、Playbookに変数を記述する場合と同様、変数名を{{}}で囲みます。</p>
<p>入力例)</p>
<p>具体値にTPF_sampleを入力する場合</p>
<p>'{{ TPF_sample }}'</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
<tr class="row-even"><td><p>変数名説明</p></td>
<td><p>変数に対する説明・コメントを入力します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
<section id="general-operations-file-list">
<span id="id59"></span><h4>ファイル管理<a class="headerlink" href="#general-operations-file-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible共通‣ファイル管理</span> では、Playbook内で定義している各モジュールで使用するファイルとファイル埋込変数のメンテナンス(閲覧/登録/更新/廃止)を行います。</div>
<div class="line">ファイル管理でファイル素材を登録しておくことで、Playbook内で定義している各モジュールで使用するファイルをファイル埋込変数名で指定することができます。</div>
</div>
<figure class="align-default" id="id115">
<a class="reference internal image-reference" href="../../../_images/submenu_screen_contents_list.png"><img alt="サブメニュー画面（ファイル管理）" src="../../../_images/submenu_screen_contents_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（ファイル管理）</span><a class="headerlink" href="#id115" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel"> 登録</span> ボタンより、ファイル管理情報の登録を行います。</div>
</div>
<figure class="align-default" id="id116">
<a class="reference internal image-reference" href="../../../_images/registration_screen_contents_list.gif"><img alt="登録画面（ファイル管理）" src="../../../_images/registration_screen_contents_list.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（ファイル管理）</span><a class="headerlink" href="#id116" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id117">
<caption><span class="caption-text">登録画面項目一覧（ファイル管理）</span><a class="headerlink" href="#id117" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ファイル埋込</p>
<p>変数名</p>
</td>
<td><p>各モジュールのパラメータに埋め込む変数名を入力します。</p>
<p>変数名は、「CPF_****」形式で入力します。</p>
<p>****：半角英数字とアンダースコア（ _ ）が利用可能です。(最小値:1バイト、最大値:128バイト)</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-odd"><td><p>ファイル素材</p></td>
<td><p>各モジュールで使用するファイルをアップロードします。</p></td>
<td><p>○</p></td>
<td><p>ファイル登録</p></td>
<td><p>最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-even"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line"><strong>ファイル埋込変数の使用例</strong></div>
</div>
<div class="line-block">
<div class="line">ファイル管理で登録したファイルをPlaybookに記述する場合、該当のパラメータにファイル埋込変数名を記述します。ファイル埋込変数名を使用しない場合、代入値自動登録設定で登録した変数や該当ファイルのパスを記述します。</div>
<div class="line">※ファイル名にスペースなどが含まれている場合、適切にクォーテーションで囲まないと、作業実行時にエラーになる場合があります。</div>
</div>
<div class="line-block">
<div class="line">Exp)</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">ファイル管理で登録したhostsファイルをファイル埋め込み変数を使用して作業対象サーバの/etc/配下にコピーする場合</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">ファイル管理メニューから下記のようにhostsファイルを登録します。</div>
</div>
<table class="docutils align-left" id="id118">
<caption><span class="caption-text">ファイル管理の登録内容</span><a class="headerlink" href="#id118" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>ファイル埋込変数名</strong></p></th>
<th class="head"><p><strong>ファイル素材</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CPF_hosts</p></td>
<td><p>hosts</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line">下記のようにPlaybookを記述します。</div>
<div class="line">※destはファイル名も記述してください。ファイル名の指定がない場合、登録したファイル素材のファイル名の前にITAの管理番号が付与された名前のファイル名で処理されます。</div>
<div class="line">　たとえば、dest=/etc/ とした場合、ファイル名は/etc/10桁の数値_hostsとなります。</div>
</div>
<div class="line-block">
<div class="line"><strong>Playbookの記述</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">copy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src=&#39;{{ CPF_hosts }}&#39; dest=/etc/hosts</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><div class="line-block">
<div class="line">ファイル管理で登録したtool.tgzファイルをファイル埋込変数を使用して作業対象サーバの/usr/local/bin/配下に解凍する場合</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">ファイル管理メニューから下記のようにtool.tgzファイルを登録します。</div>
</div>
<table class="docutils align-left" id="id119">
<caption><span class="caption-text">ファイル管理の登録内容</span><a class="headerlink" href="#id119" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>ファイル埋込変数名</strong></p></th>
<th class="head"><p><strong>ファイル素材</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CPF_tool_tgz</p></td>
<td><p>tool.tgz</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line">下記のようにPlaybookを記述します。</div>
</div>
<div class="line-block">
<div class="line"><strong>Playbookの記述</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">unarchive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ CPF_tool_tgz }} dest=/usr/local/bin</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ul>
</div>
</section>
<section id="general-operations-template-list">
<span id="id60"></span><h4>テンプレート管理<a class="headerlink" href="#general-operations-template-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible共通‣テンプレート管理</span> では、Playbookで定義しているtemplateモジュールやios_configモジュールなどのパラメータで使用するJinja2テンプレートファイルとテンプレート埋込変数のメンテナンス(閲覧/登録/更新/廃止)を行います。</div>
<div class="line">テンプレート管理でテンプレート素材を登録しておくことで、Playbook内で定義しているtemplateモジュールなどで使用するtemplateファイルをテンプレート埋込変数で指定することができます。</div>
</div>
<figure class="align-default" id="id120">
<a class="reference internal image-reference" href="../../../_images/submenu_screen_template_list.png"><img alt="サブメニュー画面（テンプレート管理）" src="../../../_images/submenu_screen_template_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（テンプレート管理）</span><a class="headerlink" href="#id120" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel"> 登録</span> ボタンより、テンプレート管理情報の登録を行います。</div>
</div>
<figure class="align-default" id="id121">
<a class="reference internal image-reference" href="../../../_images/registration_screen_template_list.gif"><img alt="登録画面（テンプレート管理）" src="../../../_images/registration_screen_template_list.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（テンプレート管理）</span><a class="headerlink" href="#id121" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id122">
<caption><span class="caption-text">登録画面項目一覧（テンプレート管理）</span><a class="headerlink" href="#id122" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>テンプレート埋込変数名</p></td>
<td><p>templateモジュールやios_configモジュールなどのパラメータに埋め込む変数名を入力します。</p>
<p>変数名は、「TPF_****」形式で入力します。</p>
<p>****
：半角英数字とアンダースコア（
_
）が利用可能です。(最小値:1バイト、最大値:128バイト)</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-odd"><td><p>テンプレート素材</p></td>
<td><p>モジュールのパラメータで使用するJinja2テンプレートファイルをアップロードします。</p></td>
<td><p>○</p></td>
<td><p>ファイル登録</p></td>
<td><p>テキスト形式
最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-even"><td><p>変数定義</p></td>
<td><p>テンプレート素材で使用している変数を定義します。</p>
<p>具体値は定義のみで使用することはありません。</p>
<p>Ansible-Roleのみで使用するテンプレートで、default変数定義ファイルなどに変数定義をしている場合、変数定義は省略できます。</p>
<p>同名の変数を複数のテンプレートで使用する場合、変数定義を合わせる必要がありのす。変数定義が一致していない場合は登録でエラーとなります。</p>
<p>変数定義はAnsibleの仕様に準拠していますが、ITA独自仕様があります。表5.2-5-1に変数定義の留意事項を記載します。また、変数名の命名規則は表 変数の種類と同様です。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line"><strong>テンプレートの変数定義を読み取るタイミング</strong></div>
<div class="line">内部の処理でテンプレートの変数定義を読み取り、「 <a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」で具体値が登録可能になります。</div>
<div class="line">読み取りのタイミングはリアルタイムではないので、「 <a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」で変数が扱えるまでに <strong>時間がかかる</strong> 場合があります。</div>
<div class="line">詳細は「 <a class="reference internal" href="#general-operations-about-the-maintenance-method"><span class="std std-ref">メンテナンス方法について</span></a> 」に記載していますので、そちらをご参照ください。</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line"><strong>変数定義の留意事項</strong></div>
<div class="line">変数定義の留意事項は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id123">
<caption><span class="caption-text">変数定義の留意事項</span><a class="headerlink" href="#id123" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>種類</strong></p></th>
<th class="head"><p><strong>留意事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>通常変数</p></td>
<td><p>具体値は省略可能です。</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_sample_1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="nt">VAR_sample_2</span><span class="p">:</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>複数具体値変数</p></td>
<td><p>具体値は省略可能です。</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_sample_1</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="nt">VAR_sample_2</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>多段変数</p></td>
<td><p>階層化された変数構造が定義出来ます。</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_sample_1</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">item1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="w">    </span><span class="nt">item2</span><span class="p">:</span>
<span class="nt">VAR_sample_2</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">array</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">item1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="w">        </span><span class="nt">item2</span><span class="p">:</span>
</pre></div>
</div>
<p>同名の変数をdefault変数定義ファイルなどに定義している場合は、変数定義を合わせる必要があります。変数定義が一致していない場合は登録でエラーとなります。</p>
</td>
</tr>
<tr class="row-odd"><td><p>グローバル変数</p></td>
<td><p>具体値は省略可能です。</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">GBL_sample_1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="nt">GBL_sample_2</span><span class="p">:</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>ITA独自変数</p></td>
<td><p>変数の定義は不要です。</p></td>
</tr>
<tr class="row-odd"><td><p>読替変数</p></td>
<td><p>定義出来る変数の種類は以下の3種類です。</p>
<p>・通常変数</p>
<p>・複数具体値変数</p>
<p>・多段変数</p>
<p>各変数定義の留意事項は同様です。</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">LCA_sample_1</span><span class="p">:</span>
<span class="nt">LCA_sample_2</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="nt">LCA_sample_3</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">item1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="w">    </span><span class="nt">item2</span><span class="p">:</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line"><strong>テンプレート埋込変数の使用例</strong></div>
</div>
<div class="line-block">
<div class="line">テンプレート管理で登録したテンプレートをPlaybookに記述する場合、該当のパラメータにテンプレート埋込変数名を記述します。テンプレート埋込変数名を使用しない場合、代入値自動登録設定で登録した変数や該当ファイルのパスを記述します。</div>
<div class="line">※ファイル名にスペースなどが含まれている場合、適切にクォーテーションで囲まないと、作業実行時にエラーになる場合があります。</div>
</div>
<div class="line-block">
<div class="line">Exp) テンプレート管理で登録したhostsファイルをテンプレート埋込変数を使用して作業対象サーバの/etc/配下に設置する場合</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">テンプレート管理メニューから下記のようにhostsファイルを登録します。</div>
</div>
<table class="docutils align-left" id="id124">
<caption><span class="caption-text">テンプレート管理の登録内容</span><a class="headerlink" href="#id124" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>テンプレート埋込変数名</strong></p></th>
<th class="head"><p><strong>テンプレート素材</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>TPF_hosts</p></td>
<td><p>hosts</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line">下記のようにPlaybookを記述します。</div>
<div class="line">※destはファイル名も記述してください。ファイル名の指定がない場合、登録したテンプレート素材のファイル名の前にITAの管理番号が付与された名前のファイル名で処理されます。</div>
<div class="line">　たとえば、dest=/etc/ とした場合、ファイル名は/etc/10桁の数値_hostsとなります。</div>
</div>
<div class="line-block">
<div class="line"><strong>Playbookの記述</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src=&#39;{{ TPF_hosts }}&#39; dest=/etc/hosts</span>
</pre></div>
</div>
</li>
</ol>
</div>
</section>
<section id="general-operations-unmanaged-var-list">
<span id="id61"></span><h4>管理対象外変数リスト<a class="headerlink" href="#general-operations-unmanaged-var-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible共通‣管理対象外変数リスト</span> では、ロールパッケージ管理のデフォルト変数定義やテンプレート管理の変数定義で定義している変数で、代入値自動登録の変数一覧に表示したくない変数のメンテナンス(参照/更新/廃止/復活)を行います。</div>
</div>
<figure class="align-default" id="id125">
<a class="reference internal image-reference" href="../../../_images/unmanaged_var_list.png"><img alt="サブメニュー画面（管理対象外変数リスト）" src="../../../_images/unmanaged_var_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（管理対象外変数リスト）</span><a class="headerlink" href="#id125" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel"> 登録</span> ボタンより、オペレーション情報の登録を行います。</div>
</div>
<figure class="align-default" id="id126">
<a class="reference internal image-reference" href="../../../_images/unmanaged_var_list.gif"><img alt="登録画面（管理対象外変数リスト）" src="../../../_images/unmanaged_var_list.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（管理対象外変数リスト）</span><a class="headerlink" href="#id126" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">管理対象外変数リスト画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id127">
<caption><span class="caption-text">登録画面項目一覧（管理対象外変数リスト）</span><a class="headerlink" href="#id127" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>変数名</p></td>
<td><p>{{#:1 こちらに入る説明の記入をお願い致します。}}</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
</section>
<section id="id62">
<h3>Ansible-LegacyRoleコンソール<a class="headerlink" href="#id62" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible-LegacyRoleコンソールの操作です。</div>
</div>
<section id="movement">
<span id="general-operations-movement-list"></span><h4>Movement一覧<a class="headerlink" href="#movement" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-LegacyRole‣Movement一覧</span> ではMovement名のメンテナンス(閲覧/登録/更新/廃止)を行います。</div>
</div>
<figure class="align-default" id="id128">
<a class="reference internal image-reference" href="../../../_images/submenu_screen_movement_list.png"><img alt="サブメニュー画面（Movement一覧）" src="../../../_images/submenu_screen_movement_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（Movement一覧）</span><a class="headerlink" href="#id128" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel"> 登録</span> ボタンより、Movement情報の登録を行います。</div>
</div>
<figure class="align-default" id="id129">
<a class="reference internal image-reference" href="../../../_images/registration_screen_movement_list.gif"><img alt="登録画面（Movement一覧）" src="../../../_images/registration_screen_movement_list.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（Movement一覧）</span><a class="headerlink" href="#id129" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id130">
<caption><span class="caption-text">登録画面項目一覧（Movement一覧）</span><a class="headerlink" href="#id130" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" colspan="4"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力必須</strong></p></th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="4"><p>Movement名</p></td>
<td><p>Movementの名称を入力します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="4"><p>遅延タイマー</p></td>
<td><p>Movementが指定期間遅延した場合にステータスを遅延として警告表示したい場合に指定期間(1～)を入力します。(単位:分)</p>
<p>未入力の場合は警告表示しません。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td colspan="2" rowspan="6"><p>Ansible利用情報</p></td>
<td colspan="2"><p>ホスト指定形式</p></td>
<td><p>特別にIPアドレスで表現しないホストを指定したい場合に「ホスト名」を選択します。</p>
<p>通常はIPが推奨です。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><p>WinRM接続</p></td>
<td><p>対象ホストがWindowsServerの場合に、「●」を選択します。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td colspan="2"><p>ヘッダーセクション</p></td>
<td><p>ITAが自動生成する親Playbookの先頭からtasksまたはrolesセクションまでのセクションを編集します。</p>
<p>未入力の場合は、以下を適用します。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ansible</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">remote_user</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="c1"># Ansible Automation Controller</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</pre></div>
</div>
<p>※winrm接続の場合は become: yesは適用しません。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長512バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>オプションパラメータ</p></td>
<td><p>Movement固有のオプションパラメータを入力します。</p>
<p>実行エンジンがAnsible Coreの場合はansible-playbookコマンドのオプションパラメータ、実行エンジ
ンがAnsible Core以外の場合はジョブテンプレートのパラメータを入力します。</p>
<p>オプションパラメータの詳細については、「 <a class="reference internal" href="#general-operations-option-parameter-list"><span class="std std-ref">オプションパラメータ一覧</span></a> 」を参照してください。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長512バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>ansible.cfg</p></td>
<td><p>作業実行時に使用するansible.cfgをアップロードします。</p>
<p>未アップロードの場合は、デフォルトが使用されます。</p>
<p>また、ロールパッケージ管理でアップロードされているzipファイルにansible.cfgが含まれている場合は、この項目でアップロードしたansible.cfgで上書きされます。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>ファイル選択</p></td>
<td><p>最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible Automation Controller利用情報</p></td>
<td><p>実行環境</p></td>
<td><p>Ansible Automation Controllerサーバに構築されている実行環境が表示されています。</p>
<p>実行する実行環境を選択します。</p>
<p>未選択の場合は、デフォルト「Default execution environment」が使用されます。</p>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>リスト選択</p></td>
<td></td>
</tr>
<tr class="row-even"><td colspan="4"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">WinRM接続で「●」を選択した場合は接続するホストをすべてWindowsServerとみなします。</div>
</div>
</div>
</li>
</ol>
</section>
<section id="general-operations-role-package-list-ansible-legacy-role-only">
<span id="id63"></span><h4>ロールパッケージ管理<a class="headerlink" href="#general-operations-role-package-list-ansible-legacy-role-only" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">ユーザーが作成したロールパッケージファイルのメンテナンス(閲覧/登録/更新/廃止)を行います。</div>
</div>
<div class="line-block">
<div class="line">ロールパッケージファイルは、「roles」のある階層のディレクトリをzipにて圧縮したものを登録してください。ロールパッケージディレクトリ構成などは「 <span class="xref std std-ref">general_operations_write_role_package_ansible_legacy_role</span> 」を参照してください。</div>
</div>
<figure class="align-default" id="id131">
<a class="reference internal image-reference" href="../../../_images/submenu_screen_role_package_list.png"><img alt="サブメニュー画面（ロールパッケージ管理）" src="../../../_images/submenu_screen_role_package_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（ロールパッケージ管理）</span><a class="headerlink" href="#id131" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel"> 登録</span> ボタンより、ロールパッケージ情報の登録を行います。</div>
</div>
<figure class="align-default" id="id132">
<a class="reference internal image-reference" href="../../../_images/registration_screen_role_package_list.gif"><img alt="登録画面（ロールパッケージ管理）" src="../../../_images/registration_screen_role_package_list.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（ロールパッケージ管理）</span><a class="headerlink" href="#id132" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id133">
<caption><span class="caption-text">登録画面項目一覧（ロールパッケージ管理）</span><a class="headerlink" href="#id133" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ロールパッケージ名</p></td>
<td><p>ITAで管理するロールパッケージ名を入力します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-odd"><td><p>ロールパッケージファイル</p></td>
<td><p>作成したロールパッケージファイル(zip形式)をアップロードします。</p>
<p>アップロードするロールパッケージファイルに含まれるPlaybookファイルは文字コードがUTF-8でBOMなしで作成して下さい。</p>
<p>UTF-8でBOMなし以外のPlaybookファイルが含まれていると登録時にエラーとなります。</p>
<p>詳しくは、「 <span class="xref std std-ref">general_operations_write_role_package_ansible_legacy_role</span> 」を参照下さい。</p>
</td>
<td><p>○</p></td>
<td><p>ファイル選択</p></td>
<td><p>最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-even"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line"><strong>ロールパッケージ内に定義した変数を取り出すタイミング</strong></div>
<div class="line">内部の処理でロールパッケージ内に定義している変数を取り出します。取り出した変数は、「 <a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」で具体値の登録が可能になります。</div>
<div class="line">抜出するタイミングはリアルタイムではありませんので、「 <a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」で変数が扱えるまでに <strong>時間がかかる</strong> 場合があります。</div>
<div class="line">詳細は「 <a class="reference internal" href="#general-operations-about-the-maintenance-method"><span class="std std-ref">メンテナンス方法について</span></a> 」に記載していますので、そちらをご参照ください。</div>
</div>
</div>
</section>
<section id="general-operations-movement-details">
<span id="id64"></span><h4>Movement-ロール紐付<a class="headerlink" href="#general-operations-movement-details" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">Movementで実行するロールパッケージのメンテナンス(閲覧/登録/更新/廃止)を行います。</div>
</div>
<figure class="align-default" id="id134">
<a class="reference internal image-reference" href="../../../_images/submenu_screen_movement_role.png"><img alt="サブメニュー画面（Movement-ロール紐付）" src="../../../_images/submenu_screen_movement_role.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（Movement-ロール紐付）</span><a class="headerlink" href="#id134" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel"> 登録</span> ボタンより、Movement-ロール紐付の登録を行います。</div>
</div>
<figure class="align-default" id="id135">
<a class="reference internal image-reference" href="../../../_images/registration_screen_movement_role.gif"><img alt="登録画面（Movement-ロール紐付）" src="../../../_images/registration_screen_movement_role.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（Movement-ロール紐付）</span><a class="headerlink" href="#id135" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id136">
<caption><span class="caption-text">登録画面項目一覧（Movement-ロール紐付）</span><a class="headerlink" href="#id136" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Movement</p></td>
<td><p>Movement一覧で登録したMovementが表示されます。</p></td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>ロールパッケージ名</p></td>
<td><p>ロールパッケージ管理で登録したロールパッケージが表示されます。実行するロールパッケージを選択します。</p>
<p>同一Movementに複数のロールパッケージは登録出来ません。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>ロール名</p></td>
<td><p>ロールパッケージ名で選択したロールパッケージに含まれているロール名が表示されます。実行するロールパッケージ内のロールを選択します。</p></td>
<td><p>○</p></td>
<td></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>インクルード順序</p></td>
<td><p>ロールの実行順序(1～:一意値)を入力します。</p>
<p>入力されたインクルード順序(昇順)でロールが実行されます。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>半角整数</p></td>
</tr>
<tr class="row-even"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
<section id="general-operations-nested-variable-list-ansible-legacy-role-only">
<span id="id65"></span><h4>変数ネスト管理<a class="headerlink" href="#general-operations-nested-variable-list-ansible-legacy-role-only" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-LegacyRole‣変数ネスト管理</span> では、「 <a class="reference internal" href="#general-operations-role-package-list-ansible-legacy-role-only"><span class="std std-ref">ロールパッケージ管理</span></a> 」で登録したロールパッケージで定義されている多段変数内で繰返配列定義されているメンバー変数の配列の最大繰返数のメンテナンス(閲覧/更新)を行います。</div>
</div>
<figure class="align-default" id="id137">
<a class="reference internal image-reference" href="../../../_images/submenu_screen_nested_variable_list.png"><img alt="サブメニュー画面（変数ネスト管理）" src="../../../_images/submenu_screen_nested_variable_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（変数ネスト管理）</span><a class="headerlink" href="#id137" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">編集</span> ボタンより最大繰返数の更新を行います。</div>
</div>
<figure class="align-default" id="id138">
<a class="reference internal image-reference" href="../../../_images/registration_screen_nested_variable_list.gif"><img alt="登録画面（変数ネスト管理）" src="../../../_images/registration_screen_nested_variable_list.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（変数ネスト管理）</span><a class="headerlink" href="#id138" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id139">
<caption><span class="caption-text">登録画面項目一覧（変数ネスト管理）</span><a class="headerlink" href="#id139" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力</strong></p>
<p><strong>必須</strong></p>
</th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>最大繰返数</p></td>
<td><p>配列の最大繰返数を1～99,999,999の範囲で入力します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>入力値1～99,999,999</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line"><strong>初期登録および繰返数の更新タイミング</strong></div>
<div class="line">内部の処理でロールパッケージ内に定義している多段変数繰返配列で定義されているメンバー変数の繰返数を初期登録します。初期登録後、変数ネスト管理で繰返数を更新することが出来ます。</div>
<div class="line">なお、初期登録および繰返数の更新はリアルタイムではないので、「 <a class="reference internal" href="#general-operations-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」で変数が扱えるまでに <strong>時間がかかる</strong> 場合があります。</div>
<div class="line">詳細は「 <a class="reference internal" href="#general-operations-about-the-maintenance-method"><span class="std std-ref">メンテナンス方法について</span></a> 」に記載していますので、そちらをご参照ください。</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line"><strong>変数名の一意管理</strong></div>
<div class="line">変数名の管理は、全ロールパッケージで一意管理しています。ロールパッケージを跨って同じ変数名を使用している場合、変数ネスト管理で設定した繰返し数は、全ロールパッケージの変数に適用されます。</div>
</div>
</div>
</section>
<section id="general-operations-substitution-value-auto-registration-setting">
<span id="id66"></span><h4>代入値自動登録設定<a class="headerlink" href="#general-operations-substitution-value-auto-registration-setting" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">メニュー作成機能で作成したパラメータシートの項目の設定値とMovementの変数を紐付けます。登録した情報は内部の処理により代入値管理と作業対象ホストに反映されます。</div>
<div class="line"><span class="xref std std-ref">general_operations_substitution_value_auto_registration_setting2</span> に反映ルールを記載しています。</div>
</div>
<figure class="align-default" id="id140">
<a class="reference internal image-reference" href="../../../_images/submenu_screen_substitution_value_auto_registration_setting_role.png"><img alt="サブメニュー画面（代入値自動登録設定）" src="../../../_images/submenu_screen_substitution_value_auto_registration_setting_role.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（代入値自動登録設定）</span><a class="headerlink" href="#id140" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel"> 登録</span> ボタンより代入値自動登録設定を行います。</div>
</div>
<figure class="align-default" id="id141">
<a class="reference internal image-reference" href="../../../_images/registration_screen_substitution_value_auto_registration_setting_role.gif"><img alt="登録画面（代入値自動登録設定）" src="../../../_images/registration_screen_substitution_value_auto_registration_setting_role.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（代入値自動登録設定）</span><a class="headerlink" href="#id141" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id142">
<caption><span class="caption-text">登録画面項目一覧（代入値自動登録設定）</span><a class="headerlink" href="#id142" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" colspan="4"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力必須</strong></p></th>
<th class="head"><p><strong>入力形式</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2" rowspan="2"><p>パラメータシート(From)</p></td>
<td colspan="2"><p>メニューグループ:メニュー:項目</p></td>
<td><p>{{#:1 こちらに入る説明の記入をお願い致します。}}</p></td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><p>代入順序</p></td>
<td><p>{{#:1 こちらに入る説明の記入をお願い致します。}}</p></td>
<td></td>
<td><p>手動入力</p></td>
<td><p>ブランクまたは、正の整数</p></td>
</tr>
<tr class="row-even"><td colspan="4"><p>登録方式</p></td>
<td><p>Value型:項目の設定値を紐付けた変数の具体値とする場合に選択します。</p>
<p>Key型:項目の名称を紐付けた変数の具体値とする場合に選択します。</p>
<p>項目の設定値が空白の場合は紐付け対象外となります。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="4"><p>Movement名</p></td>
<td><p>Movement一覧で登録したMovementが表示されます。</p>
<p>Movementを選択します。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td colspan="2" rowspan="3"><p>IaC変数(To)</p></td>
<td colspan="2"><p>Movement名:変数名</p></td>
<td><p>Movement-ロール紐付で登録した資材で使用している変数が表示されます。</p>
<p>具体値に紐付けたい変数を選択します。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td colspan="2"><p>Movement名:変数名:メンバー変数</p></td>
<td><p>変数名で多段変数を選択した場合に多段変数のメンバー変数が表示されます。</p>
<p>メンバー変数を選択します。</p>
</td>
<td><p>※1</p></td>
<td><p>リスト選択</p></td>
<td></td>
</tr>
<tr class="row-even"><td colspan="2"><p>代入順序</p></td>
<td><p>複数具体値が設定できる変数の場合のみ必須入力になります。</p>
<p>具体値の代入順序（1～）を入力します。入力値に従い昇順で代入されます。具体値が複数ない場合でも代入順序（1～）を入力します。</p>
</td>
<td><p>※2</p></td>
<td><p>手動入力</p></td>
<td><p>ブランクまたは、正の整数</p></td>
</tr>
<tr class="row-odd"><td colspan="4"><p>NULL連携</p></td>
<td><p>パラメータシートの具体値がNULL(空白)の場合に、代入値管理への登録をNULL(空白)の値で行うか設定します。</p>
<p>・「True」の場合、パラメータシートの値がどのような値でも代入値管理への登録が行われます。</p>
<p>・「False」の場合、パラメータシートに値が入っている場合のみ代入値管理への登録が行われます。</p>
<p>・空白の場合、Ansibleインターフェース情報の「NULL連携」の値が適用されます。</p>
</td>
<td><p>※3</p></td>
<td><p>リスト選択</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td colspan="4"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">※1:選択した変数が多段変数の場合のみ必須</div>
<div class="line">※2:選択した変数が複数具体値設定可能な変数の場合のみ必須</div>
<div class="line">※3:任意</div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line"><strong>メンバー変数の選択</strong></div>
<div class="line">多段変数の場合にのみメンバー変数の選択が必要になります。メンバー変数に表示される変数は具体値を必要とする変数のみです。</div>
<div class="line">メンバー変数名の表示は各階層の変数を「.」でスコープします。</div>
<div class="line">繰返配列の場合は「[ ]」で繰返位置(0～)をスコープします。繰返し配列の数は「 <a class="reference internal" href="#general-operations-nested-variable-list-ansible-legacy-role-only"><span class="std std-ref">変数ネスト管理</span></a> 」で設定を行います。</div>
<div class="line">e.g.) 代入値自動登録設定で選択できるメンバー変数と変数ネスト管理で最大繰返数を更新後に選択できるメンバー変数の確認</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">下記のようにロールパッケージの変数定義ファイル(defaults/main.yml)に変数を定義して、 <span class="menuselection">Ansible-LegacyRole‣ロールパッケージ管理</span> でロールパッケージを登録します。</div>
<div class="line"><strong>変数定義ファイルの記述内容</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_aaaa</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alice</span>
<span class="w">    </span><span class="nt">object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">obj1</span>
<span class="w">    </span><span class="nt">directory</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">craete_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dir</span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">craete_pass</span><span class="p">:</span>
<span class="w">        </span><span class="nt">sample</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sample_pass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pass1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">craete_pass</span><span class="p">:</span>
<span class="w">        </span><span class="nt">sample</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sample_pass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pass2</span>
<span class="w">    </span><span class="nt">user</span><span class="p">:</span>
<span class="w">      </span><span class="nt">root</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">craete_users</span><span class="p">:</span>
<span class="w">          </span><span class="nt">prod</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">prod_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user1</span>
<span class="w">          </span><span class="nt">dev</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dev_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user2</span>
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line">1. のように変数を定義してロールパッケージを登録した場合、 <span class="menuselection">Ansible-LegacyRole‣変数ネスト管理</span> には下記のように登録され、 <span class="menuselection">Ansible-LegacyRole‣代入値自動登録設定</span> ではデフォルトで下記のメンバー変数が選択できます。</div>
</div>
<table class="docutils align-left" id="id143">
<caption><span class="caption-text">変数ネスト管理の登録内容</span><a class="headerlink" href="#id143" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>変数名</strong></p></th>
<th class="head"><p><strong>メンバー変数名</strong></p></th>
<th class="head"><p><strong>最大繰返数</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>VAR_aaaa</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>VAR_aaaa</p></td>
<td><p>0.directory</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>VAR_aaaa</p></td>
<td><p>0.password</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>VAR_aaaa</p></td>
<td><p>0.password.sample</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>VAR_aaaa</p></td>
<td><p>0.user.root</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>VAR_aaaa</p></td>
<td><p>0.user.root.dev</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>VAR_aaaa</p></td>
<td><p>0.user.root.prod</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-left" id="id144">
<caption><span class="caption-text">代入値自動登録設定で選択可能なメンバー変数</span><a class="headerlink" href="#id144" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>変数名</strong></p></th>
<th class="head"><p><strong>メンバー変数名</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>VAR_aaaa</p></td>
<td><p>[0].directory[0].create_dir</p></td>
</tr>
<tr class="row-odd"><td><p>VAR_aaaa</p></td>
<td><p>[0].name</p></td>
</tr>
<tr class="row-even"><td><p>VAR_aaaa</p></td>
<td><p>[0].object</p></td>
</tr>
<tr class="row-odd"><td><p>VAR_aaaa</p></td>
<td><p>[0].password[0].create_pass</p></td>
</tr>
<tr class="row-even"><td><p>VAR_aaaa</p></td>
<td><p>[0].password[0].sample[0].sample_pass</p></td>
</tr>
<tr class="row-odd"><td><p>VAR_aaaa</p></td>
<td><p>[0].user.root[0].create_users</p></td>
</tr>
<tr class="row-even"><td><p>VAR_aaaa</p></td>
<td><p>[0].user.root[0].dev[0].dev_user</p></td>
</tr>
<tr class="row-odd"><td><p>VAR_aaaa</p></td>
<td><p>[0].user.root[0].prod[0].prod_user</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-LegacyRole‣変数ネスト管理</span> でメンバー変数「0.user.root.prod」の最大繰返数を初期値&quot;1&quot;から&quot;3&quot;に更新します。</div>
</div>
<table class="docutils align-left" id="id145">
<caption><span class="caption-text">変数ネスト管理の更新内容</span><a class="headerlink" href="#id145" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>変数名</strong></p></th>
<th class="head"><p><strong>メンバー変数名</strong></p></th>
<th class="head"><p><strong>最大繰返数</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>VAR_aaaa</p></td>
<td><p>0.user.root.prod</p></td>
<td><p>3</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line">3. のようにメンバー変数を更新した場合、 <span class="menuselection">Ansible-LegacyRole‣代入値自動登録設定</span> で選択できるメンバー変数も下記のように更新されます。</div>
<div class="line">（メンバー変数 [0].user.root[0].prod[1].prod_user と [0].user.root[0].prod[2].prod_user がプルダウンに追加されました。）</div>
</div>
<table class="docutils align-left" id="id146">
<caption><span class="caption-text">代入値自動登録設定で選択可能なメンバー変数</span><a class="headerlink" href="#id146" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>変数名</strong></p></th>
<th class="head"><p><strong>メンバー変数名</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>VAR_aaaa</p></td>
<td><p>[0].directory[0].create_dir</p></td>
</tr>
<tr class="row-odd"><td><p>VAR_aaaa</p></td>
<td><p>[0].name</p></td>
</tr>
<tr class="row-even"><td><p>VAR_aaaa</p></td>
<td><p>[0].object</p></td>
</tr>
<tr class="row-odd"><td><p>VAR_aaaa</p></td>
<td><p>[0].password[0].create_pass</p></td>
</tr>
<tr class="row-even"><td><p>VAR_aaaa</p></td>
<td><p>[0].password[0].sample[0].sample_pass</p></td>
</tr>
<tr class="row-odd"><td><p>VAR_aaaa</p></td>
<td><p>[0].user.root[0].create_users</p></td>
</tr>
<tr class="row-even"><td><p>VAR_aaaa</p></td>
<td><p>[0].user.root[0].dev[0].dev_user</p></td>
</tr>
<tr class="row-odd"><td><p>VAR_aaaa</p></td>
<td><p>[0].user.root[0].prod[0].prod_user</p></td>
</tr>
<tr class="row-even"><td><p>VAR_aaaa</p></td>
<td><p>[0].user.root[0].prod[1].prod_user</p></td>
</tr>
<tr class="row-odd"><td><p>VAR_aaaa</p></td>
<td><p>[0].user.root[0].prod[2].prod_user</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line"><strong>代入順序の入力</strong></div>
<div class="line">変数名またはメンバー変数名を選択することで、複数具体値変数の場合のみ代入順序が入力可能となります。複数具体値変数の場合に入力してください。</div>
<div class="line">特定の複数具体値変数に対して代入順序が連続していなくても問題ありません。</div>
<div class="line">e.g.)複数具体値変数に代入順序を入力して作業実行する場合</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">下記のようにロールパッケージの変数定義ファイル(defaults/main.yml)に変数を定義して、 <span class="menuselection">Ansible-LegacyRole‣ロールパッケージ管理</span> でロールパッケージを登録します。</div>
<div class="line"><strong>変数定義ファイルの記述内容</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_substitutionA</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user-name</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">group-name</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">meta-name</span>

<span class="nt">VAR_substitutionB</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">login</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">authorized</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">space</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster</span>
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-LegacyRole‣代入値自動登録設定</span> で紐付対象メニューに登録されている項目の設定値とRole内の変数を紐付けします。</div>
</div>
<table class="docutils align-left" id="id147">
<caption><span class="caption-text">紐付対象メニュー(sample-menu)の登録内容</span><a class="headerlink" href="#id147" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p><strong>ホスト名</strong></p></th>
<th class="head" rowspan="2"><p><strong>オペレーション名</strong></p></th>
<th class="head" colspan="4"><p><strong>パラメータ</strong></p></th>
</tr>
<tr class="row-even"><th class="head"><p><strong>項目1</strong></p></th>
<th class="head"><p><strong>項目2</strong></p></th>
<th class="head"><p><strong>項目3</strong></p></th>
<th class="head"><p><strong>項目4</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>test-host</p></td>
<td><p>test-ope</p></td>
<td><p>value1</p></td>
<td><p>value2</p></td>
<td><p>value3</p></td>
<td><p>value4</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-left" id="id148">
<caption><span class="caption-text">代入値自動登録設定の登録内容</span><a class="headerlink" href="#id148" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>メニュー名</strong></p></th>
<th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>変数名</strong></p></th>
<th class="head"><p><strong>代入順序</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>sample-menu</p></td>
<td><p>項目1</p></td>
<td><p>VAR_substitutionA</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>sample-menu</p></td>
<td><p>項目2</p></td>
<td><p>VAR_substitutionA</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>sample-menu</p></td>
<td><p>項目3</p></td>
<td><p>VAR_substitutionA</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>sample-menu</p></td>
<td><p>項目1</p></td>
<td><p>VAR_substitutionB</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>sample-menu</p></td>
<td><p>項目2</p></td>
<td><p>VAR_substitutionB</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>sample-menu</p></td>
<td><p>項目3</p></td>
<td><p>VAR_substitutionB</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>sample-menu</p></td>
<td><p>項目4</p></td>
<td><p>VAR_substitutionB</p></td>
<td><p>3</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line">作業実行時、投入データ(InputData_xxxx.zip)内のホスト変数ファイル(host_vars/test-host)には、代入値自動登録設定で登録した変数が下記のように出力されます。</div>
<div class="line"><strong>ホスト変数ファイルへの出力内容</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_substitutionA</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value3</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value1</span>
<span class="nt">VAR_substitutionB</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value3</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value1</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value4</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value2</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line"><strong>ホスト変数ファイルへの出力</strong></div>
<div class="line">代入値自動登録設定で具体値を登録した変数のみが作業実行時にホスト変数ファイルへ出力されます。</div>
<div class="line">多段変数も同様で具体値を登録しているメンバー変数のみとなります。</div>
<div class="line">e.g.) 代入値自動登録設定で具体値を登録した変数と作業実行時にホスト変数ファイルに出力される変数の確認</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">下記のようにロールパッケージの変数定義ファイル(defaults/main.yml)に変数を定義して、 <span class="menuselection">Ansible-LegacyRole‣ロールパッケージ管理</span> でロールパッケージを登録します。</div>
<div class="line"><strong>変数定義ファイルの記述内容</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_output</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alice</span>
<span class="w">    </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="nt">user</span><span class="p">:</span>
<span class="w">      </span><span class="nt">root</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">craete_users</span><span class="p">:</span>
<span class="w">          </span><span class="nt">prod</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">prod_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user1</span>
<span class="w">          </span><span class="nt">dev</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dev_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user2</span>
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-LegacyRole‣代入値自動登録設定</span> で紐付対象メニューに登録されている項目の設定値とRole内の変数を紐付けします。</div>
</div>
<table class="docutils align-left" id="id149">
<caption><span class="caption-text">紐付対象メニュー(sample-menu)の登録内容</span><a class="headerlink" href="#id149" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p><strong>ホスト名</strong></p></th>
<th class="head" rowspan="2"><p><strong>オペレーション名</strong></p></th>
<th class="head" colspan="2"><p><strong>パラメータ</strong></p></th>
</tr>
<tr class="row-even"><th class="head"><p><strong>項目1</strong></p></th>
<th class="head"><p><strong>項目2</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>test-host</p></td>
<td><p>test-ope</p></td>
<td><p>value1</p></td>
<td><p>value2</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-left" id="id150">
<caption><span class="caption-text">代入値自動登録設定の登録内容</span><a class="headerlink" href="#id150" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>メニュー名</strong></p></th>
<th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>変数名</strong></p></th>
<th class="head"><p><strong>メンバー変数名</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>sample-menu</p></td>
<td><p>項目1</p></td>
<td><p>VAR_output</p></td>
<td><p>[0].name</p></td>
</tr>
<tr class="row-odd"><td><p>sample-menu</p></td>
<td><p>項目2</p></td>
<td><p>VAR_output</p></td>
<td><p>[0].user.root[0].dev[0].dev_user</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line">作業実行時、投入データ(InputData_xxxx.zip)内のホスト変数ファイル(host_vars/test-host)には、代入値自動登録設定で登録した変数が下記のように出力されます。</div>
<div class="line"><strong>ホスト変数ファイルへの出力内容</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_output</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value1</span>
<span class="w">    </span><span class="nt">user</span><span class="p">:</span>
<span class="w">      </span><span class="nt">root</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dev</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dev_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value2</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line"><strong>ファイル埋込変数とテンプレート埋込変数をPlaybookの変数に紐付して使用する例</strong></div>
<div class="line">「Ansible共通:ファイル管理:ファイル埋込変数名」「Ansible共通:テンプレート管理:テンプレート埋込変数名」をパラメータシートの項目として代入値自動登録設定で使用した場合、項目の設定値は選択されている変数名となり、紐付している変数の具体値は '{{ 変数名 }}' として代入値管理に反映されます。</div>
<div class="line">ファイルパスはITAが作業実行時に配置したファイルパスをホスト変数経由でansibleが解釈し処理します。</div>
<div class="line">e.g.) ファイル埋込変数 CPF_test とテンプレート埋込変数 TPF_sample を代入値自動登録設定でPlaybookの変数に紐付して使用する場合</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible共通‣ファイル管理／テンプレート管理</span> で下記のように登録します。</div>
</div>
<table class="docutils align-left" id="id151">
<caption><span class="caption-text">ファイル管理の登録内容</span><a class="headerlink" href="#id151" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>ファイル埋込変数名</strong></p></th>
<th class="head"><p><strong>ファイル素材</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CPF_test</p></td>
<td><p>test_file.txt</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-left" id="id152">
<caption><span class="caption-text">テンプレート管理の登録内容</span><a class="headerlink" href="#id152" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>テンプレート埋込変数名</strong></p></th>
<th class="head"><p><strong>テンプレート素材</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>TPF_sample</p></td>
<td><p>sample.tpl</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line"><span class="menuselection">メニュー作成‣メニュー定義・作成</span> で「Ansible共通:ファイル管理:ファイル埋込変数名」「Ansible共通:テンプレート管理:テンプレート埋込変数名」をパラメータシートの項目としてメニュー作成後、 <span class="menuselection">入力用‣サンプルパラメータシート(メニュー名)</span> で項目の設定値としてファイル埋込変数とテンプレート埋込変数を登録します。</div>
</div>
<figure class="align-default" id="id153">
<a class="reference internal image-reference" href="../../../_images/general_operations_note_1a.png"><img alt="メニュー定義・作成画面" src="../../../_images/general_operations_note_1a.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">メニュー定義・作成画面</span><a class="headerlink" href="#id153" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<table class="docutils align-left" id="id154">
<caption><span class="caption-text">サンプルパラメータシート(メニュー名)の登録内容</span><a class="headerlink" href="#id154" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p><strong>ホスト名</strong></p></th>
<th class="head" rowspan="2"><p><strong>オペレーション名</strong></p></th>
<th class="head" colspan="2"><p><strong>パラメータ</strong></p></th>
</tr>
<tr class="row-even"><th class="head"><p><strong>ファイル管理</strong></p></th>
<th class="head"><p><strong>テンプレート管理</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>test-host</p></td>
<td><p>test-ope</p></td>
<td><p>CPF_test</p></td>
<td><p>TPF_sample</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-LegacyRole‣代入値自動登録設定</span> で2. のパラメータシートに登録した項目の設定値とPlaybookの変数を紐付して <span class="menuselection">Ansible-LegacyRole‣作業実行</span> で作業実行します。</div>
</div>
<table class="docutils align-left" id="id155">
<caption><span class="caption-text">代入値自動登録設定の登録内容</span><a class="headerlink" href="#id155" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>メニュー名</strong></p></th>
<th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>変数名</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>サンプルパラメータシート</p></td>
<td><p>ファイル管理</p></td>
<td><p>VAR_filetest</p></td>
</tr>
<tr class="row-odd"><td><p>サンプルパラメータシート</p></td>
<td><p>テンプレート管理</p></td>
<td><p>VAR_temptest</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-LegacyRole‣作業状態確認</span> の <span class="guilabel">代入値確認</span> ボタンで具体値に '{{ CPF_test }}' '{{ TPF_sample }}' が反映されていることが確認できます。</div>
<div class="line">また、作業実行後、作業対象サーバに1. で登録したファイル素材とテンプレート素材が設置されます。</div>
</div>
<figure class="align-default" id="id156">
<a class="reference internal image-reference" href="../../../_images/general_operations_note_1b.png"><img alt="作業状態確認の代入値確認画面" src="../../../_images/general_operations_note_1b.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">作業状態確認の代入値確認画面</span><a class="headerlink" href="#id156" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
</ol>
</div>
</section>
<section id="general-operations-execution">
<span id="id67"></span><h4>作業実行<a class="headerlink" href="#general-operations-execution" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">作業の実行を指示します。Movement一覧、オペレーション一覧からそれぞれラジオボタンで選択し、 <span class="guilabel">作業実行</span> ボタンを押すと、「 <a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a> 」に遷移し、実行されます。</div>
</div>
<figure class="align-default" id="id157">
<a class="reference internal image-reference" href="../../../_images/execution_screen.gif"><img alt="作業実行画面" src="../../../_images/execution_screen.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">作業実行画面</span><a class="headerlink" href="#id157" title="この画像へのパーマリンク">¶</a></p>
<div class="legend">
</div>
</figcaption>
</figure>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>ドライラン</strong></div>
</div>
<div class="line-block">
<div class="line">「ドライラン」ボタンをクリックすると、実際に対象機器に対して構築作業をせず、ドライランを行うことができます。</div>
<div class="line">ドライランを行った場合の動作は、Ansible-Playbookコマンドの--checkパラメータを指定してroleを実行します。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>予約日時の指定</strong></div>
<div class="line">「予約日時」を入力することで、実行を予約することがきます。</div>
<div class="line">「予約日時」には、未来の日時のみ登録可能です。</div>
</div>
</li>
</ol>
</section>
<section id="general-operations-check-operation-status">
<span id="id68"></span><h4>作業状態確認<a class="headerlink" href="#general-operations-check-operation-status" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">作業の実行状態を監視します。</div>
</div>
<figure class="align-default" id="id158">
<a class="reference internal image-reference" href="../../../_images/submenu_screen_check_operation_status.png"><img alt="サブメニュー画面（作業状態確認）" src="../../../_images/submenu_screen_check_operation_status.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（作業状態確認）</span><a class="headerlink" href="#id158" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>実行状態表示</strong></div>
<div class="line">実行状況に即し、「ステータス」が表示されます。</div>
<div class="line">また、実行ログ、エラーログに実行状況の詳細が表示されます。</div>
<div class="line">「実行種別」には、ドライランの場合は「ドライラン」、それ以外は「通常」が表示されます。</div>
<div class="line">ステータスが想定外エラーで終了した場合、Webコンテンツの登録不備が原因であれば、エラーログにメッセージが表示されます。</div>
<div class="line">また、「 <a class="reference internal" href="#general-operations-interface-information"><span class="std std-ref">インターフェース情報</span></a> 」の登録不備等で、Ansible RestAPIとの通信に失敗した場合にはエラーログにメッセージが表示されません。この場合は、アプリケーションログにエラー情報が記録されます。必要に応じてアプリケーションログを確認ください。</div>
<div class="line">Symphonyから実行した場合に、「呼出元Symphony」には、どのSymphonyから実行されたかを表示します。</div>
<div class="line">Conductorから実行した場合に、「呼出元Conductor」には、どのConductorから実行されたかを表示します。</div>
</div>
<div class="line-block">
<div class="line">Ansible-LegacyRoleドライバから直接実行した場合は空欄になります。</div>
<div class="line">「実行ユーザ」には、作業実行メニューより「実行」ボタンまたは「ドライラン」ボタンを押下した際のログインユーザが表示されます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業対象ホスト確認</strong></div>
<div class="line"><span class="guilabel">作業対象ホスト確認</span> ボタンで「 <a class="reference internal" href="#general-operations-target-host"><span class="std std-ref">作業対象ホスト</span></a> 」が表示され、作業対象のオペレーションとMovementに絞り込んだホストが表示されます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>代入値確認</strong></div>
<div class="line"><span class="guilabel">代入値確認</span> ボタンで「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」が表示され、作業対象のオペレーションとMovementに絞り込んだ代入値が表示されます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>緊急停止/予約取り消し</strong></div>
<div class="line"><span class="guilabel">緊急停止</span> ボタンで構築作業を停止させることができます。</div>
<div class="line">また、実行前の「予約実行」の作業の場合は、 <span class="guilabel">予約取消</span> ボタンが表示されます。 <span class="guilabel">予約取消</span> ボタンで予約実行が取り消せます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>実行ログ表示</strong></div>
</div>
<div class="line-block">
<div class="line">Ansible Automation Controllerで実行した場合、構築対象機器の機器一覧のユーザー・パスワード・インスタンスグルーブなのどの項目値でグループ化された構築対象機器の単位でPlaybookが実行され、ansibleの実行ログが分割されます。</div>
<div class="line">さらに、Movement一覧のオプションパラメータでジョブスライス数を指定するすることによりグループ化された構築対象機器をさらにジョブスライス数で分割しplaybookが実行され、ansibleの実行ログも分割されます。</div>
<div class="line">実行ログが分割された場合、表示ログファイルのプルダウンが表示され、表示したいログファイルを選択する事ができます。</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image62.png"><img alt="../../../_images/image62.png" class="align-center" src="../../../_images/image62.png" style="width: 6.68819in; height: 0.736in;" /></a>
<div class="line-block">
<div class="line">表示ログファイルのプルダウンに表示されるログファイル名は以下の2種類があります。</div>
<div class="line">exec.log:　全ての実行ログをまとめたログファイルです。</div>
<div class="line">exec.log以外: 分割された実行ログファイルです。ファイル命名規則は以下になります。</div>
<div class="line">Ita_&lt;mode名&gt;_executions_jobtpl_&lt;作業番号&gt;_&lt;グループ番号&gt;_&lt;通番&gt;</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>ログ検索</strong></div>
<div class="line">実行ログ、エラーログは、フィルタリングができます。各ログのフィルタのテキストボックスに検索したい文字列を入力し、「該当行のみ表示」のチェックボックスをチェックすることで該当する行だけが表示されます。</div>
<div class="line">実行ログ、エラーログのリフレッシュ表示間隔と最大表示行数を、「 <a class="reference internal" href="#general-operations-interface-information"><span class="std std-ref">インターフェース情報</span></a> 」の「状態監視周期（単位ミリ秒）」と「進行状態表示行数」で設定できます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>投入データ</strong></div>
<div class="line">実行したPlaybookなどをダウンロードすることができます。</div>
<div class="line">投入データの構成は「 <a class="reference internal" href="#general-operations-the-linkage-between-the-input-data-used-during-ansible-execution-and-ita-menu"><span class="std std-ref">Ansible実行時に使用される投入データとITAメニューの紐づけ</span></a> 」を参照して下さい。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>結果データ</strong></div>
<div class="line">実行ログ、エラーログなどをダウンロードすることができます。</div>
</div>
</li>
</ol>
</section>
<section id="general-operations-execution-list">
<span id="id69"></span><h4>作業管理<a class="headerlink" href="#general-operations-execution-list" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">作業の履歴を閲覧できます。</div>
<div class="line">条件を指定し <span class="guilabel">フィルタ</span> ボタンをクリックすると、作業一覧テーブルを表示します。</div>
<div class="line"><span class="guilabel">詳細</span> ボタンで <a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a> に遷移し、実行状態の詳細を見ることができます。</div>
</div>
<figure class="align-default" id="id159">
<a class="reference internal image-reference" href="../../../_images/submenu_screen_execution_list.png"><img alt="サブメニュー画面（作業管理）" src="../../../_images/submenu_screen_execution_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（作業管理）</span><a class="headerlink" href="#id159" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</section>
<section id="general-operations-target-host">
<span id="id70"></span><h4>作業対象ホスト<a class="headerlink" href="#general-operations-target-host" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-LegacyRole‣作業対象ホスト</span> では、オペレーションに紐付くMovementおよびホストを閲覧できます。</div>
</div>
<figure class="align-default" id="id160">
<a class="reference internal image-reference" href="../../../_images/submenu_screen_target_host.png"><img alt="サブメニュー画面（作業対象ホスト）" src="../../../_images/submenu_screen_target_host.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（作業対象ホスト）</span><a class="headerlink" href="#id160" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">閲覧画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id161">
<caption><span class="caption-text">閲覧画面項目一覧（作業対象ホスト）</span><a class="headerlink" href="#id161" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>作業No</p></td>
<td><p>{{#:1 こちらに入る説明の記入をお願い致します。}}</p></td>
</tr>
<tr class="row-odd"><td><p>オペレーション</p></td>
<td><p>オペレーション一覧に登録されているオペレーションが表示されます。</p></td>
</tr>
<tr class="row-even"><td><p>Movement名</p></td>
<td><p>Movement一覧に登録されているMovementが表示されます。</p></td>
</tr>
<tr class="row-odd"><td><p>ホスト名</p></td>
<td><p>機器一覧に登録されているホスト名が表示されます。</p></td>
</tr>
<tr class="row-even"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
<section id="general-operations-substitution-value-list">
<span id="id71"></span><h4>代入値管理<a class="headerlink" href="#general-operations-substitution-value-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">オペレーションに紐付くMovementで利用されるRole内の変数に代入する具体値を閲覧できます。</div>
</div>
<figure class="align-default" id="id162">
<a class="reference internal image-reference" href="../../../_images/submenu_screen_substitution_value_list.png"><img alt="サブメニュー画面（代入値管理）" src="../../../_images/submenu_screen_substitution_value_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（代入値管理）</span><a class="headerlink" href="#id162" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">閲覧画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id163">
<caption><span class="caption-text">閲覧画面項目一覧（代入値管理）</span><a class="headerlink" href="#id163" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p>作業No</p></td>
<td><p>{{#:1 こちらに入る説明の記入をお願い致します。}}</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>オペレーション</p></td>
<td><p>作業対象ホストに登録されているオペレーションが表示されます。</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>Movement名</p></td>
<td><p>作業対象ホストに登録されているデータの中から、選択されたオペレーションに紐づくMovementが表示されます。</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>ホスト名</p></td>
<td><p>作業対象ホストに登録されているデータで選択されたオペレーションとMovementに紐づくホストが表示されます。</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>Movement名:変数名</p></td>
<td><p>Movement-ロール紐付に登録されている資材の中から、選択されたMovementにアタッチしている変数名が表示されます。</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>Movement名:変数名:メンバー変数</p></td>
<td><p>変数名で多段変数を選択した場合に多段変数のメンバー変数が表示されます。</p></td>
</tr>
<tr class="row-even"><td rowspan="3"><p>具体値</p></td>
<td rowspan="2"><p>文字列</p></td>
<td><p>Sensitive設定</p></td>
<td><p>「OFF」または「ON」が表示されます。</p>
<p>Ansibleに渡すホスト変数ファイルには、ansible-vaultで暗号化された内容が設定されます。</p>
</td>
</tr>
<tr class="row-odd"><td><p>値</p></td>
<td><p>オペレーション/Movement/ホストで使用する変数の具体値が表示されます。</p>
<p>代入値自動登録設定でファイル埋込変数とテンプレート埋込変数をPlaybookの変数に紐付した場合、具体値には '{{ CPF_xxxx }}' '{{ TPF_xxxx }}'が表示されます。</p>
</td>
</tr>
<tr class="row-even"><td colspan="2"><p>ファイル</p></td>
<td><p>オペレーション/Movement/ホストで使用する変数にファイルを埋込む場合に、埋込むファイルがアップロードされます。</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>代入順序</p></td>
<td><p>複数具体値が設定できる変数の場合のみ表示されます。</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
</section>
</section>
<section id="id72">
<h2><span class="section-number">1.7. </span>構築コード記述方法<a class="headerlink" href="#id72" title="この見出しへのパーマリンク">¶</a></h2>
<section id="ansible-legacy-role">
<h3>ロールパッケージ（Ansible-Legacy Role）の記述<a class="headerlink" href="#ansible-legacy-role" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">基本書式については <a class="reference external" href="https://docs.ansible.com/ansible/2.9_ja/user_guide/playbooks_best_practices.html#directory-layout">Ansibleベストプラクティス</a> の公式マニュアルを参照してください。</div>
<div class="line">「 <a class="reference internal" href="#general-operations-role-package-list-ansible-legacy-role-only"><span class="std std-ref">ロールパッケージ管理</span></a> 」でアップロードするロールパッケージファイルのZipに含めるべきディレクトリと、ITAでの扱いについて記述します。</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(上位ディレクトリ)
│
├─── site.yml                           ・・・・・・・・・・・・・・・・・・・・・・・・ (1)
│
├─── hosts                              ・・・・・・・・・・・・・・・・・・・・・・・・ (2)
│
├─── group_vars                         ・・・・・・・・・・・・・・・・・・・・・・・・ (3)
│
├─── host_vars                          ・・・・・・・・・・・・・・・・・・・・・・・・ (4)
│
├─── ITA readme                         ・・・・・・・・・・・・・・・・・・・・・・・・ (5)
│
├─── 読替表                             ・・・・・・・・・・・・・・・・・・・・・・・・ (6)
│
└─── roles                              ・・・・・・・・・・・・・・・・・・・・・・・・ (7)
        │
        ├─ [role名①]                              ・・・・・・・・・・・・・・・・・・・・・・・・ (8)
        │     │
        │     ├── readme.md                               ・・・・・・・・・・・・・・・・・・・・・・・・ (9)
        │     │
        │     ├── tasks                                   ・・・・・・・・・・・・・・・・・・・・・・・・ (10)
        │     │      ├── main.yml
        │     │      └── user_files
        │     │      └── user.yml
        │     │
        │     ├── handlers                                ・・・・・・・・・・・・・・・・・・・・・・・・ (11)
        │     │      ├── main.yml
        │     │      └── user_files
        │     │      └── user.yml
        │     │
        │     ├── templates                               ・・・・・・・・・・・・・・・・・・・・・・・・ (12)
        │     │      ├── hosts.j2
        │     │      └── user_files
        │     │      └── user.j2
        │     │
        │     ├── files                                   ・・・・・・・・・・・・・・・・・・・・・・・・ (13)
        │     │      └── sudoers
        │     │
        │     ├── vars                                    ・・・・・・・・・・・・・・・・・・・・・・・・ (14)
        │     │      └─ main.yml
        │     │
        │     ├── defaults                                ・・・・・・・・・・・・・・・・・・・・・・・・ (15)
        │     │      ├── main.yml
        │     │      └── user_files
        │     │              └── user.yml
        │     │
        │     ├── meta                                    ・・・・・・・・・・・・・・・・・・・・・・・・ (16)
        │     │      └── main.yml
        │     │
        │     上記以外のディレクトリやファイルが存在する場合、 ITAは関知しません。
        │
        └─ [role名②] ロールの数に特に制限はありません。
</pre></div>
</div>
<table class="docutils align-left">
<colgroup>
<col style="width: 31.2%" />
<col style="width: 18.8%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><div class="line-block">
<div class="line">含めるべきファイル</div>
<div class="line">〇　：必要</div>
<div class="line">△　：任意</div>
</div>
</th>
<th class="head"><p>ITAでの取り扱い</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>(1)　site.yml　(マスターPlaybook)</p></td>
<td><p>△</p></td>
<td><p>ITAで作成されるため、存在する場合は上書きされます。</p></td>
</tr>
<tr class="row-odd"><td><p>(2)　hosts</p></td>
<td><p>△</p></td>
<td><p>ITAで作成されるため、存在する場合は上書きされます。</p></td>
</tr>
<tr class="row-even"><td><p>(3)　group_vars</p></td>
<td><p>△</p></td>
<td><p>ITAで作成されるため、存在する場合は上書きされます。</p></td>
</tr>
<tr class="row-odd"><td><p>(4)　host_vars</p></td>
<td><p>△</p></td>
<td><p>ITAで作成されるため、存在する場合は上書きされます。</p></td>
</tr>
<tr class="row-even"><td><p>(5)　ITA readme</p></td>
<td><p>△</p></td>
<td><div class="line-block">
<div class="line">ITA readmeはロール毎に定義します。無くてもエラーにはなりません。</div>
<div class="line">ITA readmeは、文字コードがUTF-8のBOMなしで作成して下さい。</div>
<div class="line">詳細については「 <a class="reference internal" href="#general-operations-write-ita-readme-ansible-legacy-role-only"><span class="std std-ref">ITAreadme（Ansible-Legacy Role）の記述</span></a> 」をご確認ください。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>(6)　読替表</p></td>
<td><p>△</p></td>
<td><div class="line-block">
<div class="line">読替表はロール毎に定義します。無くてもエラーにはなりません。</div>
<div class="line">詳細については「 <a class="reference internal" href="#general-operations-write-translation-table-ansible-legacy-role-only"><span class="std std-ref">読替表（Ansible-Legacy Role）の記述</span></a> 」をご確認ください。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>(7)　roles</p></td>
<td><p>〇</p></td>
<td><p>rolesディレクトリが存在しない場合はアップロードでエラーになります。</p></td>
</tr>
<tr class="row-odd"><td><p>(8)　roles/[role 名①]</p></td>
<td><p>〇</p></td>
<td><div class="line-block">
<div class="line">role名ディレクトリが存在しない場合はアップロードでエラーになります。</div>
<div class="line">tasksディレクトリを含むディレクトリをroleとして扱います。</div>
<div class="line">ディレクトリ階層が深くても問題ありません。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>(9)　roles/[role 名①]/readme.md</p></td>
<td><p>△</p></td>
<td><p>ITA は関知しません。</p></td>
</tr>
<tr class="row-odd"><td><p>(10)　roles/[role 名①]/tasks</p></td>
<td><p>〇</p></td>
<td><div class="line-block">
<div class="line">tasksディレクトリは必須です。</div>
<div class="line">playbookファイルは、文字コードがUTF-8のBOMなで作成して下さい。</div>
<div class="line">main.ymlがない場合はアップロードでエラーになります。</div>
<div class="line">main.yml以外のファイルも配置できます。</div>
<div class="line">サブディレクトリにmain.yml以外のファイルを配置できます。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>(11)　roles/[role 名①]/handlers</p></td>
<td><p>△</p></td>
<td><div class="line-block">
<div class="line">handlersディレクトリの有無は関知しません。</div>
<div class="line">playbookファイルは、文字コードがUTF-8のBOMなしで作成して下さい。</div>
<div class="line">main.ymlの有無は関知しません。</div>
<div class="line">main.yml以外のファイルも配置できます。</div>
<div class="line">サブディレクトリにファイルを配置できます。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>(12)　roles/[role 名①]/templates</p></td>
<td><p>△</p></td>
<td><div class="line-block">
<div class="line">templatesディレクトリの有無は関知しません。</div>
<div class="line">サブディレクトリにファイルを配置できます。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>(13)　roles/[role 名①]/files</p></td>
<td><p>△</p></td>
<td><div class="line-block">
<div class="line">filesディレクトリの有無は関知しません。</div>
<div class="line">ファイル及びサブディレクトリの有無は関知しません。</div>
<div class="line">ファイル内容は関知しません。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>(14)　roles/[role 名①]/vars</p></td>
<td><p>△</p></td>
<td><div class="line-block">
<div class="line">varsディレクトリの有無は関知しません。</div>
<div class="line">playbookファイルは、文字コードがUTF-8のBOMなしで作成して下さい。</div>
<div class="line">ファイル及びサブディレクトリの有無は関知しません。</div>
<div class="line">ファイル内容は関知しません。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>(15)　roles/[role 名①]/defaults</p></td>
<td><p>△</p></td>
<td><div class="line-block">
<div class="line">defaultsディレクトリの有無は関知しません。</div>
<div class="line">playbookファイルは、文字コードがUTF-8のBOMなしで作成して下さい。</div>
<div class="line">main.ymlの有無は関知しません。</div>
<div class="line">main.yml以外のファイルも配置できます。</div>
<div class="line">サブディレクトリにmain.yml以外のファイルを配置できます。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>(16)　roles/[role 名①]/meta</p></td>
<td><p>△</p></td>
<td><div class="line-block">
<div class="line">metaディレクトリの有無は関知しません。</div>
<div class="line">playbookファイルは、文字コードがUTF-8のBOMなしで作成して下さい。</div>
<div class="line">ファイル及びサブディレクトリの有無は関知しません。</div>
<div class="line">ファイル内容は関知しません。</div>
</div>
</td>
</tr>
</tbody>
</table>
<section id="id74">
<h4>マスターPlaybook<a class="headerlink" href="#id74" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">ITAで作成するマスターPlaybookはへッダーセクションとrolesセクションで構成されます。</div>
</div>
<section id="id75">
<h5>① へッダーセクション<a class="headerlink" href="#id75" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">ヘッダーセクションは、デフォルト値が決まっていますが、「 <a class="reference internal" href="#general-operations-movement-list"><span class="std std-ref">Movement一覧</span></a> 」のヘッダーセクションで変更することが出来ます。</div>
</div>
<div class="line-block">
<div class="line">▼ヘッダーセクションのデフォルト値について</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">Ansible Coreの場合</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ヘッダーセクションのデフォルト値</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">    </span><span class="nt">remote_user</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
<span class="w">    </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">Ansible Automation Controllerの場合</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ヘッダーセクションのデフォルト値</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">    </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
<span class="w">    </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</pre></div>
</div>
</section>
<section id="roles">
<h5>② rolesセクション<a class="headerlink" href="#roles" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">アップロードさたロールパッケージ内のロールを、「 <a class="reference internal" href="#general-operations-movement-details"><span class="std std-ref">Movement-ロール紐付</span></a> 」のインクルード順序に従いroleで実行します。</div>
</div>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/image_2b_2.png"><img alt="../../../_images/image_2b_2.png" src="../../../_images/image_2b_2.png" style="width: 8.85417in; height: 6.67187in;" /></a>
</figure>
</section>
</section>
<section id="id76">
<h4>変数名の一意管理<a class="headerlink" href="#id76" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">ITAの代入値管理で登録された変数の情報はホスト変数として扱います。変数名はドライバー毎の全ロールパッケージで一意管理します。ロールを跨って同じ変数名を使用しているが変数構造が違う場合は、アップロード時にエラーとなります。</div>
<div class="line">例えば、通常変数と多段変数や多段変数同士で多段構造が違う場合など。</div>
</div>
</section>
<section id="defaults-main-yml-ita">
<h4>デフォルト変数定義ファイル(defaults-&gt;main.yml)のITA独自仕様<a class="headerlink" href="#defaults-main-yml-ita" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">デフォルト変数定義ファイルの記述(変数定義)にはITA独自仕様があります。</div>
<div class="line">詳しくは、別資料「利用手順マニュアル_Ansible-driver_別紙_Ansible利用ガイドライン_追加ルール」を参照してください。</div>
</div>
</section>
<section id="ansible-role-directory-structure">
<h4>Ansible Role Directory Structureにおける所定ディクレトリのサブディレクトリについて注意事項<a class="headerlink" href="#ansible-role-directory-structure" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">Ansible Role Directory Structureにおける所定ディクレトリの下位に当該の所定ディクレトリ名と同名のサブディレクトリ（例えば、filesディレクトリの下位にそれと同名のfilesディレクトリなど）を作成されていると、作業実行時にエラーになります。</div>
</div>
</section>
<section id="id77">
<h4>ロールパッケージ内のロール名をディレクトリ階層にした場合の留意点<a class="headerlink" href="#id77" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">下記のようなディレクトリ階層のロールパッケージを例に説明します。</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>└── roles
├── parent
│     ├── sample_role1
│     │ ├── defaults
│     │ └── tasks
│     └── sample_role2
│            ├── defaults
│            ├── sample_role3
│            │     ├── defaults
│            │     └── tasks
│            ├── sample_role4
│            │     ├── defaults
│            │     └── tasks
│            └── tasks
├── sample_role5
│     └── defaults
└── sample_role6
       ├── defaults
       └── tasks
</pre></div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">ロールとして認識するディレクトリは、tasksディレクトリがあるディレクトリになります。</div>
<div class="line">この例だと、ロールして扱うディレクトリ階層(ロール名)は以下の3個になります。</div>
</div>
<ul class="simple">
<li><p>parent/sample_role1</p></li>
<li><p>parent/sample_role2</p></li>
<li><p>sample_role6</p></li>
</ul>
</li>
<li><div class="line-block">
<div class="line">tasksディレクトリが複数あるディレクトリ階層の除外</div>
<div class="line">parent/sample_role2/sample_role3とparent/sample_role2/sample_role4にもtasksディレクトリがありますが、parent/sample_role2にtasksディレクトリがありロールとして認識していますので、ロールとして扱いません。</div>
</div>
</li>
</ol>
</section>
</section>
<section id="itareadme-ansible-legacy-role">
<span id="general-operations-write-ita-readme-ansible-legacy-role-only"></span><h3>ITAreadme（Ansible-Legacy Role）の記述<a class="headerlink" href="#itareadme-ansible-legacy-role" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Playbook中に直接変数を定義したくない場合など、defaults変数定義ファイルに変数が定義されていない際に、ITA readmeファイルに変数の定義を設定することで、代入値管理機能で変数の値を指定することができます。</div>
</div>
<section id="ita-readme">
<h4>ITA readmeのファイル名の命名規則<a class="headerlink" href="#ita-readme" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">　ita_readme_[ロール名].yml</div>
<div class="line">　e.g.)</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>ロール名</p></th>
<th class="head"><p>作成するファイル名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>mysql</p></td>
<td><p>ita_readme_mysql.yml</p></td>
</tr>
<tr class="row-odd"><td><p>mysql/install</p></td>
<td><p>ita_readme_mysql%install.yml</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">roleのディレクトリ階層が深い場合、ロール名に含まれる / を % に置き換える必要があります。</div>
</div>
</div>
</section>
<section id="id78">
<h4>ITA readmeのフォーマット<a class="headerlink" href="#id78" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">フォーマットはYAML形式となります。</div>
<div class="line">文字コードはUTF-8のBOMなしで作成して下さい。</div>
<div class="line"><br /></div>
<div class="line">ITA readmeファイルと、代入値管理機能の関係を以下の図に示します。</div>
</div>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/image_2b_3.png"><img alt="../../../_images/image_2b_3.png" src="../../../_images/image_2b_3.png" style="width: 8.85417in; height: 6.67187in;" /></a>
</figure>
<div class="line-block">
<div class="line">Playbook中に無い変数をITA readmeファイルで定義した場合、定義した変数を代入値管理機能で値を設定することができます。</div>
<div class="line">また、Playbook中の変数と異なる型をITA readmファイルで定義した場合、代入値管理機能には、上書きした変数の型で値を登録することができます。</div>
<div class="line"><br /></div>
<div class="line">代入値管理機能で設定した値は、各ホスト用に変数定義ファイル(host_vars)に出力され、Ansibleで元のPlaybookと変数定義用ファイルを入力として各ホストに実行されます。</div>
<div class="line">ITA readme ファイルは代入値管理機能に変数情報を与えるためだけに使用され、ITA readme に定義した変数および、変数の値はAnsible実行には影響を与えません。</div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">ITA readmeとdefaults変数定義ファイルで変数定義が重なった場合など、以下のルールで処理されます。</div>
</div>
<table class="docutils align-left" id="id164">
<caption><span class="caption-text">変数採用ルール</span><a class="headerlink" href="#id164" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>defaults変数定義ファイル</strong></p></th>
<th class="head"><p><strong>ITA readme</strong></p></th>
<th class="head"><p><strong>変数定義の採用先</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>定義あり</p></td>
<td><p>定義なし</p></td>
<td><p>デフォルト変数定義ファイル</p></td>
</tr>
<tr class="row-odd"><td><p>定義なし</p></td>
<td><p>定義あり</p></td>
<td><p>ITA readme</p></td>
</tr>
<tr class="row-even"><td><p>定義あり</p></td>
<td><p>定義あり</p></td>
<td><p>ITA readme</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">また、「 <a class="reference internal" href="#general-operations-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」に表示するデフォルト値は以下のルールで処理されます。</div>
</div>
<table class="docutils align-left" id="id165">
<caption><span class="caption-text">デフォルト値表示ルール</span><a class="headerlink" href="#id165" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>defaults変数定義ファイル</strong></p></th>
<th class="head"><p><strong>ITA readme</strong></p></th>
<th class="head"><p><strong>変数定義の採用先</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>あり</p></td>
<td><p>なし</p></td>
<td><p>デフォルト変数定義ファイルを採用。</p></td>
</tr>
<tr class="row-odd"><td><p>なし</p></td>
<td><p>あり</p></td>
<td><p>デフォルト値なしの扱いとなる。</p></td>
</tr>
<tr class="row-even"><td><p>あり</p></td>
<td><p>あり</p></td>
<td><p>デフォルト変数定義ファイルを採用。</p>
<p>ただし、変数定義が一致している場合のみ。変数定義が一致していない場合はデフォルト値なしの扱いとなる。</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">ITA readmeは、作業実行時はロールパッケージから切り離されます。</div>
<div class="line">ITA readmeに記載した変数と具体値は適用されません。</div>
</div>
</div>
</section>
</section>
<section id="general-operations-write-translation-table-ansible-legacy-role-only">
<span id="id79"></span><h3>読替表（Ansible-Legacy Role）の記述<a class="headerlink" href="#general-operations-write-translation-table-ansible-legacy-role-only" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">defaults変数定義ファイルまたはITA readmeに定義されている「VAR_xxx」以外の変数に対して、代入値自動登録設定で具体値を設定できるようにするための設定を行うファイルです。</div>
<div class="line">defaults変数定義ファイルまたはITA readmeに定義されている「VAR_xxx」以外の変数「任意変数」に対して代入値自動登録設定で扱う変数「読替変数」の紐付を定義します。</div>
</div>
<section id="id80">
<h4>読替表のファイル名は以下の命名規則<a class="headerlink" href="#id80" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">　ita_translation-table_[ロール名].txt</div>
<div class="line">　e.g.)</div>
</div>
<table class="docutils align-left" id="id166">
<caption><span class="caption-text"><strong>デフォルト値表示ルール</strong></span><a class="headerlink" href="#id166" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ロール名</p></th>
<th class="head"><p>作成するファイル名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>mysql</p></td>
<td><p>ita_translation-table_mysql.txt</p></td>
</tr>
<tr class="row-odd"><td><p>mysql/install</p></td>
<td><p>ita_translation-table_mysql%install.txt</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">roleのディレクトリ階層が深い場合、ロール名に含まれる / を % に置き換える必要があります。</div>
</div>
</div>
</section>
<section id="id81">
<h4>読替表のフォーマット<a class="headerlink" href="#id81" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">テキスト形式で下記フォーマットとなります。</div>
<div class="line">文字コードはUTF-8のBOMなしで作成して下さい。</div>
<div class="line">ロール内で読替変数と任意変数の組合せは一意である必要があります。</div>
<div class="line">読替変数に関する詳細は「  <span class="xref std std-doc">../basic_console</span> 」を参照してください。</div>
</div>
<a class="reference internal image-reference" href="../../../_images/image65.png"><img alt="../../../_images/image65.png" class="align-center" src="../../../_images/image65.png" style="width: 6.22054in; height: 1.90683in;" /></a>
</section>
<section id="id82">
<h4>注意事項<a class="headerlink" href="#id82" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">読替表を作成する際の注意事項を列挙します。</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>ケース</strong></p></th>
<th class="head"><p>ITA<strong>の動作</strong></p></th>
<th class="head"><p><strong>備考</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>読替表はあるが、defaults変数定義ファイルとITAreadmeがない。(ロール毎)</p></td>
<td><p>読替表を読込まない。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>任意変数にVAR_で始まる変数が定義されている。</p></td>
<td><p>ロールパッケージアップロード時にエラーなります。</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>defaults変数定義ファイルとITAreadmeに定義されていない任意変数を使用している。</p></td>
<td><p>ロールパッケージアップロード時にエラーなります。</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>ロール内で読替変数が重複定義されている</p></td>
<td><p>ロールパッケージアップロード時にエラーなります。</p></td>
<td><p>パッケージA-&gt;ロールA</p>
<p>LCA_A:user_A/LCA_A:user_B</p>
</td>
</tr>
<tr class="row-even"><td><p>ロール内で任意変数が重複定義されている</p></td>
<td><p>ロールパッケージアップロード時にエラーなります。</p></td>
<td><p>パッケージA-&gt;ロールB</p>
<p>LCA_A:user_A/LCA_B:user_A</p>
</td>
</tr>
<tr class="row-odd"><td><p>ロール間で任意変数の構造に差異がある。</p></td>
<td><p>ロールパッケージアップロード時にエラーなります。</p></td>
<td><p>パッケージA-&gt;ロー
ルA/B</p>
<p>LCA_C:user_C</p>
</td>
</tr>
<tr class="row-even"><td><p>ロールパッケージ内で置換変数と任意変数の組合せが一意でない。</p></td>
<td><p>ロールパッケージアップロード時にエラーなります。</p></td>
<td><p>パッケージA</p>
<p>ロールA  LCA_D: user_D</p>
<p>ロールB  LCA_D: user_E</p>
</td>
</tr>
<tr class="row-odd"><td><p>ロールパッケージ間で任意変数の構造に差異がある。</p></td>
<td><p>ロールパッケージアップロード時にエラーなりませんが、読替変数が代入値管理に表示されません。</p></td>
<td><p>パッケージA-&gt;ロールA</p>
<p>LCA_F: user_F</p>
<p>パッケージB-&gt;ロールA</p>
<p>LCA_F: user_F</p>
</td>
</tr>
<tr class="row-even"><td><p>ロールパッケージ間で多段の任意変数を定義している</p></td>
<td><p>多段の構造が一致しているのでエラーにはなりませんが、多段繰返回数の設定は各パッケージで共通の設定となります。</p></td>
<td><p>パッケージA-&gt;ロールB</p>
<p>LCA_H: user_H</p>
<p>パッケージB-&gt;ロールA</p>
<p>LCA_H: user_H</p>
</td>
</tr>
</tbody>
</table>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/image66.png"><img alt="../../../_images/image66.png" src="../../../_images/image66.png" style="width: 4.85417in; height: 3.67187in;" /></a>
</figure>
</section>
</section>
<section id="ita-readme-ansible-legacy-role">
<h3>「ita_readme」と「読替表」の活用例（Ansible-Legacy Role）<a class="headerlink" href="#ita-readme-ansible-legacy-role" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible-Legacy Roleにおける「ita_readme」と「読替表」の活用例について、観点1～9を列挙します。</div>
<div class="line"><br /></div>
<div class="line">前提として、Ansible-Legacy Role（「roles」ディレクトリ）は外部から取得したものとします。</div>
<div class="line">以下は、「ita_readme」と「読替表」を用いてアップロードから結果確認までを表した全体イメージ図です。</div>
</div>
<figure class="align-center" id="id167">
<a class="reference internal image-reference" href="../../../_images/image67.png"><img alt="全体イメージ図" src="../../../_images/image67.png" style="width: 6.49606in; height: 4.84121in;" /></a>
<figcaption>
<p><span class="caption-text">全体イメージ図</span><a class="headerlink" href="#id167" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<div class="line-block">
<div class="line">以降、上記の図をベースに観点1～9について掘り下げていきます。</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>NO.</strong></p></th>
<th class="head"><p><strong>観点</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><ol class="arabic simple">
<li></li>
</ol>
</td>
<td><p>外部から取得したAnsible-Legacy Roleを編集せず利用する</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li></li>
</ol>
</td>
<td><p>「ita_readme」と「読替表」の役割</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="3">
<li></li>
</ol>
</td>
<td><p>「defaults/main.yml」に記載の変数定義およびデフォルト値について</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="4">
<li></li>
</ol>
</td>
<td><p>「host_varsファイル」と「ITAのCMDB」について</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="5">
<li></li>
</ol>
</td>
<td><p>「defaults/main.yml」に追記したい場合の救済処置</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="6">
<li></li>
</ol>
</td>
<td><p>変数名の先頭“VAR_”の有無について</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="7">
<li></li>
</ol>
</td>
<td><p>「ita_readme」と「読替表」の連携活用</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="8">
<li></li>
</ol>
</td>
<td><p>playbookにおけるlength評価への応用</p></td>
</tr>
<tr class="row-even"><td><ol class="arabic simple" start="9">
<li></li>
</ol>
</td>
<td><p>playbookにおけるdefined評価への応用</p></td>
</tr>
</tbody>
</table>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点１：外部から取得したAnsible-Legacy Roleを編集せず利用する</strong></div>
<div class="line">外部(Galaxy等)から取得したAnsible-Legacy Role（「roles」ディレクトリ）は編集を加えずに利用いただくことが可能です。</div>
<div class="line">そのため「ita_readme」や「読替表」を「roles」ディレクトリの外に置いて、Ansible-Legacy Role（「roles」ディレクトリ）内で使われている変数にパラメータを与えることが可能となっております。</div>
</div>
</li>
</ul>
<figure class="align-center" id="id168">
<a class="reference internal image-reference" href="../../../_images/image68.png"><img alt="観点１のイメージ図" src="../../../_images/image68.png" style="width: 6.49606in; height: 4.84593in;" /></a>
<figcaption>
<p><span class="caption-text">観点１のイメージ図</span><a class="headerlink" href="#id168" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点２：「ita_readme」と「読替表」の役割について</strong></div>
<div class="line">「ita_readme」、「読替表」は変数名および変数の型をITAに伝えるための機能です。</div>
<div class="line">言い換えれば、「ita_readme」および「読替表」は変数の具体値（パラメータ）を定義するための機能ではありません（具体値を記載してもITAで認識しません）。</div>
<div class="line"><br /></div>
<div class="line">具体値を与える方法を以降の観点で説明します。</div>
</div>
</li>
</ul>
<figure class="align-center" id="id169">
<a class="reference internal image-reference" href="../../../_images/image69.png"><img alt="観点２のイメージ図" src="../../../_images/image69.png" style="width: 6.49606in; height: 4.84593in;" /></a>
<figcaption>
<p><span class="caption-text">観点２のイメージ図</span><a class="headerlink" href="#id169" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点３：「defaults/main.yml」に記載の変数定義およびデフォルト値について</strong></div>
<div class="line">「roles」配下の「defaults/main.yml」はそのまま変更なくansibleに渡されます。</div>
<div class="line">変数定義およびデフォルト値はhost_varsで定義されない限り有効となります。(例：『VAR_A：aaa』)</div>
</div>
</li>
</ul>
<figure class="align-center" id="id170">
<a class="reference internal image-reference" href="../../../_images/image70.png"><img alt="観点３のイメージ図" src="../../../_images/image70.png" style="width: 6.49606in; height: 4.84593in;" /></a>
<figcaption>
<p><span class="caption-text">観点３のイメージ図</span><a class="headerlink" href="#id170" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点４：「host_varsファイル」と「ITAのCMDB」について</strong></div>
<div class="line">host_varsファイルはITAのCMDB（パラメータシート）から実行ごとに自動作成されます。</div>
</div>
</li>
</ul>
<figure class="align-center" id="id171">
<a class="reference internal image-reference" href="../../../_images/image71.png"><img alt="観点４のイメージ図" src="../../../_images/image71.png" style="width: 6.49606in; height: 4.84121in;" /></a>
<figcaption>
<p><span class="caption-text">観点４のイメージ図</span><a class="headerlink" href="#id171" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点５：「defaults/main.yml」に追記したい場合の救済処置</strong></div>
<div class="line">Ansible-Legacy Role（「roles」ディレクトリ）に変更を加えたい場合、救済処置として「ita_readme」に変数名および型を記述することが可能です。</div>
<div class="line"><br /></div>
<div class="line">既に「defaults/main.yml」に記載がある変数を、改めて「ita_readme」に定義する必要はありません。</div>
<div class="line">もし二つのファイルで同じ変数が定義されている場合は、「ita_readme」側が優位になります。</div>
<div class="line"><br /></div>
<div class="line">※下図のとおり、変数「VAR_H」を「ita_readme」に記述することで変数の追加が可能</div>
</div>
</li>
</ul>
<figure class="align-center" id="id172">
<a class="reference internal image-reference" href="../../../_images/image72.png"><img alt="観点５のイメージ図" src="../../../_images/image72.png" style="width: 6.49606in; height: 4.84593in;" /></a>
<figcaption>
<p><span class="caption-text">観点５のイメージ図</span><a class="headerlink" href="#id172" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点６：変数名の先頭“VAR_”の有無について</strong></div>
<div class="line">「defaults/main.yml」の変数のうち、ITAは“VAR_”という接頭文字から始まるものを変数マスタに管理します。</div>
<div class="line">「defaults/main.yml」の変数のうち、“VAR_”という接頭文字から始まっていないものをITAにて変数管理させる場合は「読替表」を活用します。</div>
<div class="line">「読替表」では“VAR_”という接頭文字から始まっていない変数を“LCA_”という接頭文字から始まる変数名と紐づけることでITAにて変数管理させることが可能となります。</div>
<div class="line"><br /></div>
<div class="line">なお、本機能の応用例として、「defaults/main.yml」の変数（“VAR_”という接頭文字から始まっていない）にITAからパラメータを与えずに実行したい場合は、あえて「読替表」での変数紐づけを避けることも可能です。</div>
<div class="line"><br /></div>
<div class="line">※以下、図の変数名「hoge3」のパターン</div>
<div class="line">※「読替表」には“LCA_”から始まる変数定義のみ有効</div>
</div>
</li>
</ul>
<figure class="align-center" id="id173">
<a class="reference internal image-reference" href="../../../_images/image73.png"><img alt="観点６のイメージ図" src="../../../_images/image73.png" style="width: 6.49606in; height: 4.84121in;" /></a>
<figcaption>
<p><span class="caption-text">観点６のイメージ図</span><a class="headerlink" href="#id173" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点７：「ita_readme」と「読替表」の連携活用</strong></div>
<div class="line">「tasks/main.yml」（playbook本体）において“VAR_”から始まっていない変数が使われており、また、その変数が「default/main.yml」に定義されていない場合、「ita_readme」と「読替表」を連携活用することで、ITAからパラメータを与えることが可能です。</div>
<div class="line">例えば、下図の様に「roles」配下の「tasks/main.yml」に変数「hoge」が使われている場合、以下の手順によってITAに変数を伝えることが可能です。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">「ita_readme」に、変数名「hoge」を追記する</div>
</div>
</li>
<li><div class="line-block">
<div class="line">「読替表」に、変数名「hoge」をITAのCMDB（パラメータシート）で「LCA_xxx」という変数名で扱うことを追記する</div>
</div>
</li>
</ol>
</li>
</ul>
<figure class="align-center" id="id174">
<a class="reference internal image-reference" href="../../../_images/image74.png"><img alt="観点７のイメージ図" src="../../../_images/image74.png" style="width: 6.49606in; height: 4.23387in;" /></a>
<figcaption>
<p><span class="caption-text">観点７のイメージ図</span><a class="headerlink" href="#id174" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点８：playbookにおけるlength評価への応用</strong></div>
<div class="line">変数に対し具体値があるか否かによって、length評価における条件分岐に活用することが可能です。</div>
<div class="line">例えば、「defaults/main.yml」に『VAR_C:[]』がある状態で、変数「VAR_C」に具体値を与えずに実行した場合length＝0となります。</div>
<div class="line">反対に、何らかの具体値を与えて実行した場合length＞0となります。（例：『VAR_X:sss』）</div>
</div>
</li>
</ul>
<figure class="align-center" id="id175">
<a class="reference internal image-reference" href="../../../_images/image75.png"><img alt="観点８のイメージ図" src="../../../_images/image75.png" style="width: 6.49606in; height: 4.84593in;" /></a>
<figcaption>
<p><span class="caption-text">観点８のイメージ図</span><a class="headerlink" href="#id175" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ul>
<li><div class="line-block">
<div class="line"><strong>観点９：playbookにおけるdefined評価への応用</strong></div>
<div class="line">変数に対し具体値を定義しているか否かによって、defined評価による条件分岐に活用することが可能です。</div>
<div class="line">例えば、「defaults/main.yml」で定義のない変数「VAR_G」と「VAR_H」を、「ita_readme」で定義を記述します。「ita_readme」に記述することで、ITAのCMDB（パラメータシート）で取り扱うことが可能となります。</div>
<div class="line"><br /></div>
<div class="line">変数「VAR_G」に具体値を付与せず実行すると、「defaults/main.yml」および「host_vars」に定義されずに動作するためdefined→falseとなります。</div>
<div class="line">反対に、変数「VAR_H」に具体値「kkk」を付与し実行すると、「host_vars」に定義されて動作するためdefined→trueとなります。</div>
</div>
</li>
</ul>
<figure class="align-center" id="id176">
<a class="reference internal image-reference" href="../../../_images/image76.png"><img alt="観点９のイメージ図" src="../../../_images/image76.png" style="width: 6.49606in; height: 4.84593in;" /></a>
<figcaption>
<p><span class="caption-text">観点９のイメージ図</span><a class="headerlink" href="#id176" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</section>
<section id="backyard">
<h3>BackYardコンテンツ<a class="headerlink" href="#backyard" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id83">
<h4>変数自動登録<a class="headerlink" href="#id83" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">変数解析対象の資材をアップロードした場合、アップロードされた資材から変数を取出します。</div>
</div>
<table class="docutils align-left" id="id177">
<caption><span class="caption-text">モード別アップロードした資材の変数の扱い</span><a class="headerlink" href="#id177" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>メニュー</p></th>
<th class="head"><p>Legacy Role</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Playbook素材集</p></td>
<td><p>×</p></td>
</tr>
<tr class="row-odd"><td><p>ロールパッケージ管理</p></td>
<td><p>○</p></td>
</tr>
<tr class="row-even"><td><p>対話ファイル素材集</p></td>
<td><p>×</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">なお、取出すタイミングは 自動プロセスの起動周期 に依存します。</div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">※変数名の一意管理</div>
<div class="line">取出した変数名は、モード毎に全資材で一意管理されます。</div>
<div class="line">デフォルト変数定義ファイルで変数構造を定義しますので、各資材で変数構造が違う場合の留意事項を以下に明記します。</div>
<div class="line"><br /></div>
<div class="line">●単一ロールパッケージ</div>
<div class="line">ロールを跨って同じ変数名を使用しているが変数構造が違う場合。</div>
<div class="line">※通常変数と多段変数や多段変数同士で多段構造が違う場合など</div>
<div class="line">⇒ アップロード時にエラーとなります。</div>
<div class="line"><br /></div>
<div class="line">●全ロールパッケージ</div>
<div class="line">ロールパッケージを跨って同じ変数名を使用しているが変数構造が違う場合。</div>
<div class="line">⇒ アップロード時にエラーとなります。</div>
</div>
</div>
</section>
</section>
<section id="ansibleita">
<h3>Ansible利用ガイドラインITA追加ルール<a class="headerlink" href="#ansibleita" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">ITAを使用して、Ansibleで実行する為のPlaybook作成ガイドラインを記述します。</div>
<div class="line">詳しくは、別資料「利用手順マニュアル_Ansible-driver_別紙_Ansible利用ガイドライン_追加ルール」を参照してください。</div>
</div>
</section>
</section>
<section id="id84">
<h2><span class="section-number">1.8. </span>運用操作<a class="headerlink" href="#id84" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本機能を活用する操作は、クライアントPCのブラウザ画面からのユーザー利用による入力だけでなく、システム運用・保守による操作もあります。用意している運用・保守の操作は次のとおりです。</div>
</div>
<section id="id85">
<h3>メンテナンス<a class="headerlink" href="#id85" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible-driverのプロセスの開始/停止/再起動に必要なファイルは以下となります。</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>対象ファイル名</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>LegacyRole実行監視</p>
<p>未実行作業の実行を行う。</p>
</td>
<td><p>ky_ansible_execute-workflow.service</p></td>
</tr>
<tr class="row-odd"><td><p>legacyRole変数自動登録</p>
<p>アップロードした資材から変数の取出しを行う。</p>
</td>
<td><p>ky_legacy_role_varsautolistup-workflow.service</p></td>
</tr>
<tr class="row-even"><td><p>legacyRole自動登録設定</p>
<p>自動登録設定に設定された情報を代入値
管理と作業対象メニューに反映を行う。</p>
</td>
<td><p>ky_legacy_role_valautostup-workflow.service</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible AutomationControllerデータ同期</p>
<p>Ansible AutomationControllerから各種設定情報の取得を行う。</p>
</td>
<td><p>ky_ansible_towermasterSync-workflow.service</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">対象ファイルは「/usr/lib/systemd/system」に格納されています。</div>
<div class="line">プロセス起動/停止/再起動の方法は次の通りです。</div>
<div class="line">root権限でコマンドを実行してください。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">プロセス起動</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># systemctl start ky_ansible_execute-workflow.service
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line">プロセス停止</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># systemctl stop ky_ansible_execute-workflow.service
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line">プロセス再起動</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># systemctl restart ky_ansible_execute-workflow.service
</pre></div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">各対象ファイル名に置き換えて起動/停止/再起動を行ってください。</div>
</div>
</section>
<section id="general-operations-about-the-maintenance-method">
<span id="id86"></span><h3>メンテナンス方法について<a class="headerlink" href="#general-operations-about-the-maintenance-method" title="この見出しへのパーマリンク">¶</a></h3>
<ol class="arabic">
<li><div class="line-block">
<div class="line">NORMALレベルへの変更</div>
<div class="line">以下のファイルの8行目「DEBUG」を「NORMAL」に書き換えます。</div>
<div class="line">ログレベル設定ファイル： &lt;インストールディレクトリ&gt;/ita-root/confs/backyardconfs/ita_env</div>
</div>
</li>
<li><div class="line-block">
<div class="line">DEBUGレベルへの変更</div>
<div class="line">以下のファイルの8行目「NORMAL」を「DEBUG」に書き換えます。</div>
<div class="line">ログレベル設定ファイル： &lt;インストールディレクトリ&gt;/ita-root/confs/backyardconfs/ita_env</div>
</div>
</li>
<li><div class="line-block">
<div class="line">起動周期の変更</div>
<div class="line">各対象ファイルのExecStartの5番目のパラメータを変更します。（単位:秒）</div>
<div class="line">例外を除き起動周期はデフォルト値の使用をしてください。</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ExecStart=/exastro/ita-root/backyards/common/ky_loopcall-php-procedure.sh /usr/local/bin/php /usr/local/bin/php /exastro/ita-root/backyards/ansible_driver/ky_pioneer_varsautolistup-workflow.php /exastro/ita-root/logs/backyardlogs 10 NORMAL &gt; /dev/null 2&gt;&amp;1
</pre></div>
</div>
<div class="line-block">
<div class="line">書き換え後、<strong>プロセス再起動(restart)後に有効になります。</strong></div>
<div class="line">ログファイルの出力先： <em>&lt;インストールディレクトリ&gt;/ita-root/logs/backyardlogs</em></div>
</div>
</li>
</ol>
</section>
</section>
<section id="id87">
<h2><span class="section-number">1.9. </span>付録<a class="headerlink" href="#id87" title="この見出しへのパーマリンク">¶</a></h2>
<section id="general-operations-the-linkage-between-the-input-data-used-during-ansible-execution-and-ita-menu">
<span id="id88"></span><h3>Ansible実行時に使用される投入データとITAメニューの紐づけ<a class="headerlink" href="#general-operations-the-linkage-between-the-input-data-used-during-ansible-execution-and-ita-menu" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">各ITAメニューより情報を抜出してAnsible実行に必要な投入データを作ります。この際、機器一覧のパスワードや代入値管理でSensitive設定をONした変数の具体値がansible-vaultで暗号化されています。</div>
<div class="line">投入データはZIP形式で「 <a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a> 」よりダウンロードが可能です。</div>
<div class="line">ダウンロードした投入データを所定のディレクトリに解凍することで、Ansibleを直接実行することも可能です。</div>
<div class="line"><br /></div>
<div class="line">各種データとITAメニューの関係性は以下の通りです。</div>
</div>
<section id="id89">
<h4>Ansible-LegacyRole投入データ<a class="headerlink" href="#id89" title="この見出しへのパーマリンク">¶</a></h4>
<table class="docutils align-left" id="id178">
<caption><span class="caption-text">Ansible-LegacyRole投入データ</span><a class="headerlink" href="#id178" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>メニューグループ</p></th>
<th class="head"><p>メニュー</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>ディレクトリ解凍時のパス</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Ansible-LegacyRole</p></td>
<td><p>Playbook素材集</p></td>
<td><p>プレイブック素材</p></td>
<td><p>/child_playbooks</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible 共通</p></td>
<td><p>テンプレート管理</p></td>
<td><p>テンプレート素材</p></td>
<td><p>/template_files</p></td>
</tr>
<tr class="row-even"><td><p>Ansible 共通</p></td>
<td><p>ファイル管理</p></td>
<td><p>ファイル素材</p></td>
<td><p>/copy_files</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-LegacyRole</p></td>
<td><p>代入値管理</p></td>
<td><p>ファイル素材</p></td>
<td><p>/upload_files</p></td>
</tr>
<tr class="row-even"><td><p>Ansible 共通</p></td>
<td><p>グローバル変数管理</p></td>
<td><p>変数名/具体値</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-LegacyRole</p></td>
<td><p>代入値管理</p></td>
<td><p>変数名/具体値(文字列)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-LegacyRole</p></td>
<td><p>代入値管理</p></td>
<td><p>変数名/具体値(ファイル)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-LegacyRole</p></td>
<td><p>template 管理</p></td>
<td><p>テンプレート素材</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-LegacyRole</p></td>
<td><p>ファイル管理</p></td>
<td><p>ファイル変数名</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>プロトコル</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインユーザ ID</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインパスワード</p>
<p>※ansible-vault で暗号化</p>
</td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>ホスト名</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>ssh 認証鍵ファイル</p></td>
<td><p>/ssh_key_files</p></td>
</tr>
<tr class="row-even"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>サーバ証明書</p></td>
<td><p>/winrm_ca_files</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible 共通</p></td>
<td><p>インターフェース情報</p></td>
<td><p>オプションパラメータ</p></td>
<td><p>/AnsibleExecOption.txt</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-LegacyRole</p></td>
<td><p>Movement 一覧</p></td>
<td><p>オプションパラメータ</p></td>
<td><p>/AnsibleExecOption.txt</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインユーザ ID</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインパスワード</p>
<p>※ansible-vault で暗号化</p>
</td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>ホスト名</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>IP アドレス</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>インベントリファイル追加オプション</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>WinRM 接続情報</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>接続オプション</p>
<p>※ansible_ssh_extra_args の値</p>
</td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-LegacyRole</p></td>
<td><p>Playbook 素材集</p></td>
<td><p>プレイブック素材</p></td>
<td><p>/playbook.yml</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-LegacyRole</p></td>
<td><p>Movement-Playbook紐付</p>
<p>（Movement-対話種別紐付、Movement-ロール紐付）</p>
</td>
<td><p>インクルード順序</p></td>
<td><p>/playbook.yml</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">host_vars配下に格納されるデータリレイストレージパス(ITA)とConductor インスタンスデータリレイストレージパス(ANS)は、環境変数HOST_STORAGEPATHより情報を抜出します。</div>
</div>
</div>
</section>
<section id="id90">
<h4>投入データを直接実行する方法<a class="headerlink" href="#id90" title="この見出しへのパーマリンク">¶</a></h4>
<section id="id91">
<h5>① 投入データの解凍先ディレクトリの作成<a class="headerlink" href="#id91" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">以下の2つのディレクトリを作成し、1.のディレクトリに投入データを解凍します。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">/ベースディレクトリ/ドライバパス/作業番号/in</div>
</div>
</li>
<li><div class="line-block">
<div class="line">/ベースディレクトリ/ドライバパス/作業番号/out</div>
<div class="line">ベースディレクトリ　: インターフェース情報=&gt;データリレイストレージパス(Ansible)</div>
<div class="line">ドライバパス　:  Legacy-role: legacy/rl</div>
<div class="line">作業番号:　作業実行時の作業番号を右寄せで不足分は0を埋めた10桁の文字列。</div>
<div class="line">　　　　　 作業番号: 12345 =&gt; 0000012345</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">尚、投入データには、機器一覧にアップロードした秘密鍵ファイルが含まれていません。秘密鍵ファイルを必要といる認証方式の場合、投入データに含まれているインベントリファイル「hosts」を開き、ansible_ssh_private_key_fileに設定されているパスに秘密鍵ファイルをコピーして下さい。</div>
</div>
<div class="line-block">
<div class="line">インベントリファイル「hosts」</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>all:
  children:
    hostgroups:
      hosts:
        target_host_1:
          ansible_ssh_user: keyauth_user
          ansible_ssh_private_key_file: /exastro/data_relay_storage/ansible_driver/legacy/ns/0000000060/in/ssh_key_files/0000000006-keyauth_user_id_rsa
</pre></div>
</div>
</section>
<section id="id92">
<h5>② 投入データを直接実行するコマンド<a class="headerlink" href="#id92" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">Ansible-LegacyRole</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook (オプション) –i hosts --vault-password-file　パスワードファイル site.yml
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">パスワードファイル名は任意です。パスワードファイルに設定するパスワードは、ＩＴＡインストール先/ita-root/confs/commonconfs/ansible_vault_accesskey.txtの内容を、rot13、base64の順でデコードした値を使用して下さい。</div>
</div>
</div>
</section>
</section>
</section>
<section id="id93">
<h3>Ansible実行時に作成される結果データ<a class="headerlink" href="#id93" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">[投入データ]をansibleで実行した結果を[結果データ]としてZIP形式で保存します。</div>
<div class="line">[結果データ]はZIP形式で「 <a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a> 」よりダウンロードが可能です。</div>
</div>
<section id="legacy-role">
<h4>Legacy-Role 結果データに保存されるファイル一覧<a class="headerlink" href="#legacy-role" title="この見出しへのパーマリンク">¶</a></h4>
<table class="docutils align-left" id="id179">
<caption><span class="caption-text">Legacy-Role結果データの保存されるファイル一覧</span><a class="headerlink" href="#id179" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>ファ
イル名</strong></p></th>
<th class="head"><p><strong>記録内容</strong></p></th>
<th class="head"><p>AnsibleCoreの場合</p></th>
<th class="head"><p>AnsibleAutomationControllerの場合</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>result.txt</p></td>
<td><p>Ansibleの実行結果を記録</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>xxx.pid</p></td>
<td><p>Ansible-playbbokコマンドのプロセスIDを記録するファイル。</p>
<p>xxx:Ansible-playbbokコマンドのプロセスID</p>
</td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>error.log</p></td>
<td><p>作業実行時にITAがなにかしらのエラーによりエラーメッセージを出力した場合、または、Ansible-playbbokコマンドがなにかとらのエラーによりエラーメッセージを出力した場合のエラー出力先ファイル。</p>
<p>作業実行確認のエラーログに表示に表示される内容。</p>
</td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>exec.log</p></td>
<td><p>Ansible-playbbokが出力した実行ログを一部加工したログファイル。作業実行確認の実行ログに表示される内容。</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>exec.log.org</p></td>
<td><p>Ansible-playbbokが出力した実行ログ</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>Ita_&lt;mode名&gt;_</p>
<p>executions_jobtpl_</p>
<p>&lt;作業番号&gt;_&lt;グループ番号&gt;</p>
</td>
<td><p>分割された実行ログファイルです。</p>
<p>ファイル名の命名規則は <a class="reference internal" href="#general-operations-check-operation-status"><span class="std std-ref">作業状態確認</span></a> の⑥実行ログ表示を参照下さい。</p>
</td>
<td></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>forced.txt</p></td>
<td><p>緊急停止をした場合の記録ファイル</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>user_files</p></td>
<td><p>実行したplaybookでITA独自変数「__workflowdir__」になにかしらのファイル出力をした場合のファイルが記録されるディレクトリ。</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="general-operations-option-parameter-list">
<span id="id94"></span><h3>オプションパラメータ一覧<a class="headerlink" href="#general-operations-option-parameter-list" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">インターフェース情報とMovement一覧のオプションパラメータについて説明します。</div>
<div class="line">ITAでは、以下の順番でansible-playbookのオプションパラメータを設定するので、単一の値しか許容していないパラメータを複数定義した場合、Movement一覧=&gt;オプションパラメータのパラメータが有効になります。</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">Ansible共通=&gt;インターフェース情報=&gt;オプションパラメータ</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Movement一覧=&gt;オプションパラメータ</div>
</div>
</li>
</ul>
<div class="line-block">
<div class="line">▼実行エンジンがAnsible Coreの場合</div>
<div class="line">　　実行エンジンがAnsible Coreの場合、ansible-playbookコマンドのオプションパラメータを入力します。</div>
<div class="line">　　ansible-playbookコマンドのオプションパラメータの仕様については、以下のコマンドを実行して表示されたヘルプを参照してください。</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook -h
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">▼実行エンジンがAnsible Core以外の場合</div>
<div class="line">　　以下の表 8.3.1は実行エンジンがAnsible Core以外の場合に、指定可能なオプションパラメータです。</div>
<div class="line"><br /></div>
</div>
<table class="docutils align-left" id="id180">
<caption><span class="caption-text">実行エンジンがAnsible Core以外の場合に指定可能なオプションパラメータ一覧</span><a class="headerlink" href="#id180" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>オプションパラメータ</strong></p></th>
<th class="head"><p><strong>指定方法</strong></p></th>
<th class="head"><p><strong>AnsibleAutomationControllerの設定箇所</strong></p></th>
<th class="head"><p><strong>備考</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-v</p>
<p>--verbose</p>
</td>
<td><p>-v</p>
<p>-vv</p>
<p>-vvv</p>
<p>-vvvv</p>
<p>-vvvvv</p>
<p>--verbose</p>
</td>
<td><p>テンプレート
画面の[詳細
]に指定した
vの数を設定</p></td>
<td><p>・vの合計値を適用</p>
<p>・--verboseは、-vと同様</p>
<p>例：--verbose -vvv
の場合、-vvvvと同様</p>
<p>・vを6以上指定した場合
、vは5の指定となる</p>
</td>
</tr>
<tr class="row-odd"><td><p>-f</p>
<p>--forks</p>
</td>
<td><p>-f FORKS</p>
<p>--forks=FORKS</p>
</td>
<td><p>テンプレートの[フォーク]に指定したFORKSが設定される</p></td>
<td><p>・FORKSには数値を指定</p>
<p>・複数定義した場合、最後に定義したパラメータが有効</p>
<p>例：-f 1-forks=10の場合、--forks=10が有効となる</p>
<p>・数値以外が指定された場合、エラーとなる</p>
</td>
</tr>
<tr class="row-even"><td><p>-l</p>
<p>--limit</p>
</td>
<td><p>-l SUBSET</p>
<p>--limit=SUBSET</p>
</td>
<td><p>テンプレートの[制限]に指定したSUBMITが設定される</p></td>
<td><p>・SUBSET:機器一覧にあるホスト名</p>
<p>・複数定義した場合、最後に定義したパラメータが有効</p>
</td>
</tr>
<tr class="row-odd"><td><p>-e</p>
<p>--extra-vars</p>
</td>
<td><p>-e EXTRA_VARS</p>
<p>--extra-vars=EXTRA_VARS</p>
</td>
<td><p>テンプレートの[追加変数]に変数名:具体値の形式で設定される</p></td>
<td><p>・EXTRA_VARS:変数名、具体値をjson形式またはyaml形式</p>
<p>例：json形式の場合
-extra-vars={&quot;VAR_1&quot;:&quot;directory&quot;,&quot;VAR_2&quot;:&quot;0755&quot;}</p>
<p>yaml形式の場合
-extra-vars=VAR_1:directory\nVAR_2:0755</p>
<p>・複数定義した場合、最後に定義したパラメータが有効</p>
</td>
</tr>
<tr class="row-even"><td><p>-t</p>
<p>--tags</p>
</td>
<td><p>-t TAGS</p>
<p>--tags=TAGS</p>
</td>
<td><p>テンプレートの[ジョブタグ]に設定したTAGSが設定される</p></td>
<td><p>・TAGS:タグ名</p>
<p>・複数個のパラメータを許容</p>
</td>
</tr>
<tr class="row-odd"><td><p>-b</p>
<p>--become</p>
</td>
<td><p>-b</p>
<p>--become</p>
</td>
<td><p>テンプレートのオプション[権限昇格の有効化]がチェックされる</p></td>
<td><p>・少なくとも1つ指定すればパラメータが有効</p></td>
</tr>
<tr class="row-even"><td><p>-D</p>
<p>--diff</p>
</td>
<td><p>-D</p>
<p>--diff</p>
</td>
<td><p>テンプレートの[変更]の表示が有効化される</p></td>
<td><p>・少なくとも1つ指定すればパラメータが有効</p></td>
</tr>
<tr class="row-odd"><td><p>--skip-tags</p></td>
<td><p>--skip-tags=SKIP_TAGS</p></td>
<td><p>テンプレートの[スキップタグ]に設定したSKIP_TAGSが設定される</p></td>
<td><p>・SKIP_TAGS:スキップタグ名</p>
<p>・複数個のパラメータを許容</p>
</td>
</tr>
<tr class="row-even"><td><p>--st
art-at-task</p></td>
<td><p>--start-at-task=START_AT_TASK</p></td>
<td><p>※Ansible Automation ControllerのWebUI には--start-at-taskの表示はない。</p></td>
<td><p>・複数定義した場合、最後に定義したパラメータが有効</p></td>
</tr>
<tr class="row-odd"><td><p>-ufc</p>
<p>--use
_fact_cache</p>
</td>
<td><p>-ufc</p>
<p>--use_fact_cache</p>
</td>
<td><p>テンプレートのオプション[ファクトキャッシュの有効化]がチェックされる</p></td>
<td><p>・少なくとも1つ指定すればパラメータが有効</p></td>
</tr>
<tr class="row-even"><td><p>-as</p>
<p>--allow_simultaneous</p>
</td>
<td><p>-as</p>
<p>--allow_simultaneous</p>
</td>
<td><p>テンプレートのオプション[同時実行ジョブの有効化]がチェックされる</p></td>
<td><p>・少なくとも1つ指定すればパラメータが有効</p></td>
</tr>
<tr class="row-odd"><td><p>-jsc</p>
<p>--jobslice_count</p>
</td>
<td><p>-jscジョブスライス数</p>
<p>--job_slice_count=ジョブスライス数</p>
</td>
<td><p>テンプレートの[ジョブスライス数]に指定したジョブスライス数が設定される</p></td>
<td><p>・ジョブスライス数には数値を指定</p>
<p>・複数定義した場合、最後に定義したパラメータが有効</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">※Ansible Automation Controllerのオプションパラメータの仕様については、Ansible Automation Controllerユーザーガイドのジョブテンプレートの説明を参照して下さい。</div>
</div>
</section>
<section id="ansible-automation-controllerita">
<h3>Ansible Automation ControllerでITA独自変数を利用する場合の留意事項<a class="headerlink" href="#ansible-automation-controllerita" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">下記ITA独自変数を利用してファイル出力をするPlyabookを含むMovementをクラスタ構成のAnsible Automation Controllerで作業実行した場合の留意事項について記載します。</div>
<div class="line"><br /></div>
<div class="line">　対象のITA独自変数</div>
<div class="line">　・ __workflowdir__</div>
<div class="line">　・ __symphony_workflowdir__</div>
<div class="line">　・ __conductor_workflowdir__</div>
<div class="line">　・ __movement_status_filepath__</div>
<div class="line">　・ __parameters_dir_for_epc__</div>
<div class="line">　・ __parameters_file_dir_for_epc__</div>
<div class="line">　・ __parameter_dir__</div>
<div class="line">　・ __parameters_file_dir__</div>
<div class="line"><br /></div>
</div>
<section id="ita-1">
<h4>ITA独自変数を利用して作成したファイルの取り扱い {{#:1 こちらの修正をお願い致します。}}<a class="headerlink" href="#ita-1" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">ITA独自変数を利用して作成したファイルの出力先ディレクトリパスはAnsible Automation ControllerのITA作業用ディレクトリ配下「/var/lib/exastro」に設定されます。Movement実行前に結果データをAnsible Automation ControllerのITA作業用ディレクトリ配下「/var/lib/exastro」にファイル転送します。Movement実行でここに作成されたファイルは、Movement実行後に各Ansible Automation Controllerより結果データに上書きモードでファイル転送します。同一ファイル名でファイルを作成している場合、更新したファイルが結果データに正しく反映されない場合があります。</div>
</div>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/image_2b_4.png"><img alt="../../../_images/image_2b_4.png" src="../../../_images/image_2b_4.png" style="width: 7.49606in; height: 5.84593in;" /></a>
</figure>
<ol class="arabic">
<li><div class="line-block">
<div class="line">Movementをconductorから実行している場合、Movement実行前に該当conductorインスタンス配下のファイルをAnsible Automation ControllerのITA作業用ディレクトリ配下にファイル転送</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Movement実行前に該当Movement配下のファイルをAnsible Automation ControllerのITA作業用ディレクトリにファイル転送</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Movementをconductorから実行している場合、Movement実行後にAnsible Automation ControllerのITA作業用ディレクトリの該当Movementで作成したファイルを結果データにファイル転送</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Movement実行後にAnsible Automation ControllerのITA作業用ディレクトリの該当conductorインスタンス配下に作成したファイルを結果データにファイル転送</div>
</div>
</li>
</ol>
</section>
<section id="id95">
<h4>留意事項<a class="headerlink" href="#id95" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">ファイル名はansible「__loginhostname__」を含めるなどして、Movementに紐づいているターゲットホスト毎に同一ファイル名に出力しないように工夫して下さい。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">conductorから実行する場合、複数のMovementで同一ファイル名への出力しないよう工夫して下さい。</div>
</div>
</li>
</ol>
</section>
</section>
<section id="general-operations-data-resources-deleted-when-executing">
<span id="id96"></span><h3>実行時データ削除で削除されるデータリソース<a class="headerlink" href="#general-operations-data-resources-deleted-when-executing" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">インターフェース情報の実行時データ削除で「削除する」を選択した場合に、削除されるデータリソースを以下に列挙します。</div>
</div>
<table class="docutils align-left" id="id181">
<caption><span class="caption-text">実行時データ削除で削除されるデータリソース一覧(Ansible Automation Controller側)</span><a class="headerlink" href="#id181" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>データリソース</p></th>
<th class="head" rowspan="2"><p>リソースタイプ</p></th>
<th class="head" colspan="2"><p>実行エンジン</p></th>
<th class="head" rowspan="2"><p>備考</p></th>
</tr>
<tr class="row-even"><th class="head"><p>AnsibleTower3.x</p></th>
<th class="head"><p>Ansible Automation Controller4.x</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>ITA作業用ディレクトリ
/var/lib/exastro/ita_&lt;区分&gt;_executions_10桁の作業番号</p></td>
<td><p>ディレクトリ</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>SCM管理ディレクトリ</p>
<p>/var/lib/awx/projects/ita_&lt;区分&gt;_executions_10桁の作業番号</p>
</td>
<td><p>ディレクトリ</p></td>
<td><p>〇</p></td>
<td><p>※</p></td>
<td><p>※プロジェクトリソースを削除により削除される</p></td>
</tr>
<tr class="row-odd"><td><p>インベントリリソース名:ita_&lt;区分&gt;_executions_inventory_10桁の作業番号_通番</p></td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>認証情報リソース名:ita_&lt;区分&gt;_executionscredential_10桁の作業番号_通番</p>
<p>ita_&lt;区分&gt;_executions_vault_credential_10桁の作業番号</p>
<p>ita_&lt;区分&gt;_executions_git_credential_10桁の作業番号</p>
</td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>プロジェクトリソース名:ita_&lt;区分&gt;_executions_project_10桁の作業番号</p></td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>ジョブテンプレートリソース名:ita_&lt;区分&gt;_executions_jobtpl_10桁の作業番号_通番</p></td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>ワークフロージョブテンプレートリソース名:ita_&lt;区分&gt;_executions_workflowtpl_10桁の作業番号</p></td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>ジョブリソース名:Job番号—ita_&lt;区分&gt;_execut
ions_workflowtpl_10桁の作業番号</p>
<p>Job番号—ita_&lt;区分&gt;_executions_jobtpl_10桁の作業番号</p>
</td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
</tbody>
</table>
<table class="docutils align-left" id="id182">
<caption><span class="caption-text">実行時データ削除で削除されるデータリソース一覧(ITA側)</span><a class="headerlink" href="#id182" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>データリソース</p></th>
<th class="head" rowspan="2"><p>リソースタイプ</p></th>
<th class="head" colspan="2"><p>実行エンジン</p></th>
<th class="head" rowspan="2"><p>備考</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Ansible
Automation
Controller4.x</p></th>
<th class="head"><p>Ansible</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>Git リポジトリ
ITAインストールディレクトリ/ita-root/repositorys/ansible_driver/&lt;区分&gt;_10桁の作業番号</p></td>
<td><p>Gitリポジトリ</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
<td><p>ディレクトリごと削除</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


</div>


<div id="articleNavigation">
  <ul>
  </ul>
</div>


<div id="pageTopLink">
  <a href="#container"><i>↑</i> Page Top</a>
</div>

</article>
</div>
</main>
</div><!-- End #contents -->
<div id="footer">
  <footer class="divInner">
    <small>Copyright © 2023 NEC Corporation</small>
  </footer>
</div><!-- End #footer -->

<div id="overlay"></div>

</div><!-- End #container -->
  </body>
</html>